# 케어조아 견적 시스템 상세 설계

## 1. 견적 요청 타입

### A. 간편견적 (5분 작성)
**목적**: 빠른 예상 비용 확인 및 여러 시설 견적 동시 요청

**필수 입력 항목**:
- 고객 정보: 이름, 연락처
- 환자 기본: 이름, 나이, 성별, 장기요양등급
- 지역: 시/도, 시/군/구
- 시설: 유형, 병실 선호
- 예산: 최소/최대 (선택)

**결과**: 
- 해당 지역 모든 시설에 자동 발송
- 간단한 예상 비용 즉시 표시

### B. 일반견적 (상세 작성, 10-15분)
**목적**: 정확한 맞춤 견적 및 상세 상담

**추가 입력 항목**:
- 환자 상세: 질환, 거동 상태, 인지 상태, ADL 점수
- 필요 서비스: 의료, 간호, 재활, 물리치료, 작업치료
- 특수 요구사항: 식이 제한, 알레르기, 종교
- 입소 희망일, 입소 기간
- 가족 방문 계획

**결과**:
- 선택한 시설에만 발송 (최대 10개)
- 상세 견적서 및 상담 예약

---

## 2. 시설 유형별 견적 항목

### 🏥 요양병원
**특징**: 의료 중심, 24시간 의사/간호사 상주

**견적 항목**:
1. **기본 비용**
   - 입원료 (병실 유형별)
   - 간병비 (등급별)
   - 식대 (3식 기본)

2. **의료 비용**
   - 진료비 (정기 진찰)
   - 검사비 (혈액, X-ray 등)
   - 약제비
   - 치료비 (물리치료, 주사 등)

3. **부대 비용**
   - 간호 처치비
   - 의료 소모품
   - 세탁비
   - 이미용비

**예상 월 비용**: 200만원 ~ 500만원

---

### 🏠 요양원
**특징**: 생활 중심, 일상 돌봄

**견적 항목**:
1. **기본 비용**
   - 기본료 (등급별)
   - 식사비
   - 간호 관리비

2. **프로그램 비용**
   - 여가 프로그램
   - 인지 활동
   - 신체 활동

3. **부대 비용**
   - 세탁비
   - 이미용비
   - 간식비
   - 생필품

**예상 월 비용**: 100만원 ~ 200만원

---

### 🚶 재가복지센터 (방문 서비스)
**특징**: 집에서 생활하며 서비스 제공

**견적 항목**:
1. **방문요양**
   - 시간당 비용
   - 주당 이용 시간
   - 방문 횟수

2. **방문목욕**
   - 횟수당 비용
   - 월 이용 횟수

3. **방문간호**
   - 시간당 비용
   - 간호 항목

**예상 월 비용**: 30만원 ~ 80만원

---

### 🌞 주야간보호센터
**특징**: 낮 시간 이용, 저녁 귀가

**견적 항목**:
1. **기본 비용**
   - 일일 이용료
   - 식사비 (점심, 간식)

2. **프로그램 비용**
   - 인지 프로그램
   - 물리치료
   - 작업치료

3. **부대 비용**
   - 송영비 (차량 이용)
   - 특별 프로그램비

**예상 월 비용**: 20만원 ~ 50만원

---

## 3. 견적 요청 프로세스

### 고객 측
1. **견적 유형 선택** (간편 / 일반)
2. **시설 유형 선택** (요양병원 / 요양원 / 재가 / 주야간)
3. **정보 입력** (유형별 맞춤 폼)
4. **지역 선택** (시/도 → 시/군/구)
5. **제출** → 해당 지역 시설에 자동 발송

### 시설 측
1. **견적 요청 수신** (알림)
2. **견적서 작성** (시설별 템플릿)
3. **견적서 제출** → 고객에게 발송
4. **1:1 채팅** (고객과 직접 소통)

### 관리자 측
1. **견적 요청 모니터링**
2. **시설 응답률 관리**
3. **고객 만족도 추적**
4. **분쟁 중재**

---

## 4. 데이터베이스 스키마

### quote_requests (견적 요청)
```sql
- id, request_type (simple/detailed)
- customer_*, patient_*
- sido, sigungu, detail_address
- facility_type, care_level, room_type
- budget_min, budget_max
- special_requirements
- services_needed (JSON)
- admission_date, stay_duration
- status, created_at
```

### quote_responses (견적 응답)
```sql
- id, quote_request_id, facility_id
- monthly_cost, admission_fee, deposit
- cost_breakdown (JSON)
- services_provided (JSON)
- contact_*, message
- status, created_at
```

### chat_messages (채팅)
```sql
- id, quote_request_id, facility_id
- sender_type, sender_name, message
- is_read, created_at
```

---

## 5. 비용 계산 로직

### 장기요양등급별 기본료
- 1등급: 180만원
- 2등급: 160만원
- 3등급: 140만원
- 4등급: 120만원
- 5등급: 100만원

### 시설 유형별 가산
- 요양병원: +50만원
- 요양원: +20만원
- 재가복지: -40만원
- 주야간보호: -60만원

### 병실 유형별 가산
- 1인실: +50만원
- 2인실: +20만원
- 3인실: 기본
- 4인실 이상: -10만원

### 지역별 가산
- 서울: +30만원
- 경기: +10만원
- 광역시: +5만원
- 기타: 기본

---

## 6. 시설 필터링 로직

```javascript
// 견적 요청 시 발송 대상 시설 필터링
const targetFacilities = await db.query(`
  SELECT * FROM partners 
  WHERE facility_sido = ? 
    AND facility_sigungu = ?
    AND facility_type = ?
    AND status = 'approved'
  ORDER BY created_at DESC
`)

// 각 시설에 견적 요청 전송
for (const facility of targetFacilities) {
  await sendQuoteRequest(facility.id, quoteRequestId)
  await sendNotification(facility.manager_phone, "새로운 견적 요청")
}
```

---

## 7. 다음 구현 단계

1. ✅ 간편견적 폼 (완료)
2. ✅ 일반견적 폼 (완료)
3. ✅ 시설별 맞춤 항목 (완료)
4. ⏳ 시설 등록 시 주소 저장
5. ⏳ 지역별 필터링 로직
6. ⏳ 시설 견적서 작성 페이지
7. ⏳ 1:1 채팅 시스템
8. ⏳ 관리자 견적 관리
