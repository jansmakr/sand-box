import { Hono } from 'hono'
import { renderer } from './renderer'
import { cors } from 'hono/cors'
import { serveStatic } from 'hono/cloudflare-workers'
import { getCookie, setCookie } from 'hono/cookie'

type Bindings = {
  ADMIN_PASSWORD: string
}

const app = new Hono<{ Bindings: Bindings }>()

const ADMIN_CONFIG = { sessionKey: 'admin_session' }
const dataStore = { 
  partners: [] as any[], 
  familyCare: [] as any[],
  quoteRequests: [] as any[],
  facilities: [] as any[],  // 시설 데이터 캐시
  facilitiesLoaded: false    // 로딩 여부 플래그
}
const sessions = new Set<string>()

function isAdmin(c: any) {
  const sessionId = getCookie(c, ADMIN_CONFIG.sessionKey)
  return sessionId && sessions.has(sessionId)
}

function generateSessionId() {
  return 'session_' + Date.now() + '_' + Math.random().toString(36).substring(2)
}

app.use('/api/*', cors())
app.use('/static/*', serveStatic({ root: './public' }))
app.use(renderer)

// 메인 페이지 (전체 디자인)
app.get('/', (c) => {
  return c.render(
    <div>
      {/* 헤더 */}
      <header class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="flex justify-between items-center h-16">
            <div class="flex items-center">
              <img 
                src="https://page.gensparksite.com/v1/base64_upload/b39dca8586af1dacd6d8417554313896" 
                alt="케어조아 로고"
                class="h-8 w-auto mr-3"
              />
              <h1 class="text-2xl font-bold text-teal-600">케어조아</h1>
            </div>
            <nav class="hidden md:flex space-x-2 lg:space-x-3 text-sm">
              <a href="#partner-section" class="bg-red-600 text-white hover:bg-red-700 px-3 py-2 rounded-lg">
                <i class="fas fa-hospital mr-1"></i>상급병원담당자
              </a>
              <a href="#partner-section" class="bg-blue-600 text-white hover:bg-blue-700 px-3 py-2 rounded-lg">
                <i class="fas fa-building mr-1"></i>정부복지담당자
              </a>
              <a href="/family-care-register" class="bg-green-600 text-white hover:bg-green-700 px-3 py-2 rounded-lg">
                <i class="fas fa-heart mr-1"></i>가족간병등록
              </a>
              <a href="#partner-section" class="bg-gray-600 text-white hover:bg-gray-700 px-3 py-2 rounded-lg">
                <i class="fas fa-handshake mr-1"></i>입점신청
              </a>
              <a href="/admin" class="bg-gray-900 text-white hover:bg-black px-3 py-2 rounded-lg">
                <i class="fas fa-shield-alt mr-1"></i>관리자
              </a>
            </nav>
          </div>
        </div>
      </header>

      {/* 메인 섹션 */}
      <section class="relative bg-white">
        <div class="bg-gray-50 border-b border-gray-100 py-3 px-4">
          <div class="max-w-6xl mx-auto flex items-center justify-center">
            <div class="flex items-center text-sm text-gray-600">
              <div class="w-2 h-2 bg-orange-400 rounded-full mr-2"></div>
              <span class="font-medium">🏆 특허기반 실시간 요양 견적 및 상담 플랫폼</span>
            </div>
          </div>
        </div>

        <div class="max-w-6xl mx-auto px-4 py-8 md:py-16">
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-16 items-center">
            <div class="space-y-6 md:space-y-8">
              <div>
                <h1 class="text-3xl md:text-5xl lg:text-6xl font-bold text-gray-900 mb-4 md:mb-6 leading-tight">
                  이젠 찾지 말고<br />
                  <span class="text-red-600">고르세요</span><br />
                  <span class="text-blue-600">케어조아</span>
                </h1>
                <p class="text-lg md:text-xl text-gray-600 mb-6 md:mb-8">
                  희망하는 지역의, 희망하는 시설만! 입력하면<br />
                  그 지역 <strong class="text-blue-600">모든 시설의 정보를</strong> 실시간으로 받아볼 수 있어요
                </p>
                
                <div class="bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200 rounded-xl p-4 mb-6">
                  <div class="flex items-center justify-center text-sm md:text-base">
                    <i class="fas fa-certificate text-blue-600 mr-2"></i>
                    <span class="text-blue-800 font-semibold">특허기반 실시간 요양 견적 및 상담 플랫폼</span>
                    <i class="fas fa-check-circle text-green-600 ml-2"></i>
                  </div>
                </div>
              </div>

              {/* 특허기반 실시간 요양견적 및 상담 플랫폼 안내 */}
              <div class="bg-gradient-to-r from-blue-50 to-teal-50 border-2 border-blue-200 rounded-2xl p-6 mb-6 shadow-lg">
                <div class="flex items-center justify-center text-center">
                  <div>
                    <div class="flex items-center justify-center mb-2">
                      <i class="fas fa-certificate text-blue-600 text-2xl mr-2"></i>
                      <span class="text-lg font-bold text-blue-800">특허기반 실시간 요양견적 및 상담 플랫폼</span>
                    </div>
                    <p class="text-sm text-gray-600">희망하는 지역의 모든 시설 정보를 실시간으로 받아볼 수 있어요</p>
                  </div>
                </div>
              </div>

              {/* 주요 액션 버튼 그리드 (2x2) */}
              <div class="grid grid-cols-2 gap-3 md:gap-4 mb-8">
                {/* 1. Android 앱 다운로드 */}
                <a href="https://play.google.com/store/apps/details?id=app.netlify.std_care_joa.twa" 
                   target="_blank" rel="noopener noreferrer"
                   class="flex flex-col items-center justify-center bg-gradient-to-br from-blue-500 to-blue-600 text-white py-6 px-4 rounded-2xl shadow-lg hover:from-blue-600 hover:to-blue-700 transition-all duration-300 transform hover:scale-105 min-h-[120px]">
                  <div class="bg-white bg-opacity-20 rounded-xl p-3 mb-3">
                    <i class="fas fa-mobile-alt text-3xl"></i>
                  </div>
                  <span class="font-bold text-center">Android<br/>앱 다운로드</span>
                </a>

                {/* 2. 실시간 견적 */}
                <a href="/quote-request"
                   class="flex flex-col items-center justify-center bg-gradient-to-br from-amber-100 to-orange-100 text-gray-800 border-2 border-orange-200 py-6 px-4 rounded-2xl shadow-lg hover:from-amber-200 hover:to-orange-200 transition-all duration-300 transform hover:scale-105 min-h-[120px]">
                  <div class="bg-orange-200 rounded-xl p-3 mb-3">
                    <i class="fas fa-clipboard text-3xl text-orange-600"></i>
                  </div>
                  <span class="font-bold text-center">실시간 견적<br/>상담 신청</span>
                </a>

                {/* 3. 지역별 전화상담 */}
                <a href="/regional-consultation"
                   class="flex flex-col items-center justify-center bg-gradient-to-br from-green-500 to-emerald-600 text-white py-6 px-4 rounded-2xl shadow-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 transform hover:scale-105 min-h-[120px]">
                  <div class="bg-white bg-opacity-20 rounded-xl p-3 mb-3">
                    <i class="fas fa-phone-alt text-3xl"></i>
                  </div>
                  <span class="font-bold text-center">지역별<br/>전화상담</span>
                </a>

                {/* 4. 전국 시설 찾기 */}
                <a href="/facilities"
                   class="flex flex-col items-center justify-center bg-gradient-to-br from-purple-500 to-pink-600 text-white py-6 px-4 rounded-2xl shadow-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 transform hover:scale-105 min-h-[120px]">
                  <div class="bg-white bg-opacity-20 rounded-xl p-3 mb-3">
                    <i class="fas fa-search text-3xl"></i>
                  </div>
                  <span class="font-bold text-center">전국<br/>시설 찾기</span>
                </a>
              </div>

              <div class="flex flex-col sm:flex-row items-start sm:items-center gap-4 sm:gap-6 text-sm md:text-base text-gray-600">
                <div class="flex items-center">
                  <i class="fas fa-users text-blue-500 mr-2"></i>
                  <span class="font-medium">월 10만+ 이용자</span>
                </div>
                <div class="flex items-center">
                  <i class="fas fa-building text-blue-500 mr-2"></i>
                  <span class="font-medium">3,000+ 등록 시설</span>
                </div>
                <div class="flex items-center">
                  <i class="fas fa-star text-yellow-500 mr-2"></i>
                  <span class="font-medium">평균 4.5점 우수</span>
                </div>
              </div>
            </div>

            <div class="relative flex justify-center">
              <img 
                src="https://page.gensparksite.com/v1/base64_upload/ede67a258a8e3e3dd08f322c99dbeda8" 
                alt="케어조아 앱"
                class="w-64 md:w-80 rounded-3xl shadow-2xl"
              />
            </div>
          </div>
        </div>
      </section>

      {/* 모바일 하단 네비게이션 */}
      <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-1 py-2 z-50 md:hidden">
        <div class="flex justify-around items-center">
          <a href="#partner-section" class="flex flex-col items-center py-2 bg-red-600 text-white rounded-lg px-1.5 shadow-md">
            <i class="fas fa-hospital text-base mb-1"></i>
            <span class="text-[10px] font-medium">상급병원</span>
          </a>
          <a href="#partner-section" class="flex flex-col items-center py-2 bg-blue-600 text-white rounded-lg px-1.5 shadow-md">
            <i class="fas fa-building text-base mb-1"></i>
            <span class="text-[10px] font-medium">정부복지</span>
          </a>
          <a href="/family-care-register" class="flex flex-col items-center py-2 bg-green-600 text-white rounded-lg px-1.5 shadow-md">
            <i class="fas fa-heart text-base mb-1"></i>
            <span class="text-[10px] font-medium">가족간병</span>
          </a>
          <a href="#partner-section" class="flex flex-col items-center py-2 bg-gray-600 text-white rounded-lg px-1.5 shadow-md">
            <i class="fas fa-handshake text-base mb-1"></i>
            <span class="text-[10px] font-medium">입점신청</span>
          </a>
          <a href="/admin" class="flex flex-col items-center py-2 bg-gray-900 text-white rounded-lg px-1.5 shadow-md">
            <i class="fas fa-shield-alt text-base mb-1"></i>
            <span class="text-[10px] font-medium">관리자</span>
          </a>
        </div>
      </div>

      {/* 서비스 특징 */}
      <section class="py-20">
        <div class="max-w-7xl mx-auto px-4">
          <div class="text-center mb-16">
            <h3 class="text-3xl font-bold text-gray-900 mb-4">
              <i class="fas fa-certificate text-blue-600 mr-3"></i>케어조아만의 특별함
            </h3>
          </div>
          
          <div class="grid md:grid-cols-4 gap-6">
            <div class="text-center p-6 bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl">
              <div class="w-16 h-16 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-calculator text-2xl text-white"></i>
              </div>
              <h4 class="text-xl font-bold mb-2">실시간 견적</h4>
              <p class="text-gray-600 text-sm">간단한 정보 입력으로 맞춤형 견적을 즉시 확인</p>
            </div>
            
            <div class="text-center p-6 bg-gradient-to-br from-green-50 to-green-100 rounded-xl">
              <div class="w-16 h-16 bg-gradient-to-r from-green-500 to-green-600 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-shield-check text-2xl text-white"></i>
              </div>
              <h4 class="text-xl font-bold mb-2">검증된 시설</h4>
              <p class="text-gray-600 text-sm">정부 인증 및 전문가 방문을 통해 검증</p>
            </div>
            
            <div class="text-center p-6 bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl">
              <div class="w-16 h-16 bg-gradient-to-r from-purple-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-user-md text-2xl text-white"></i>
              </div>
              <h4 class="text-xl font-bold mb-2">전문 상담</h4>
              <p class="text-gray-600 text-sm">자격을 보유한 전문 상담사가 24시간 상담</p>
            </div>
            
            <div class="text-center p-6 bg-gradient-to-br from-orange-50 to-orange-100 rounded-xl">
              <div class="w-16 h-16 bg-gradient-to-r from-orange-500 to-orange-600 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-heart text-2xl text-white"></i>
              </div>
              <h4 class="text-xl font-bold mb-2">가족 같은 마음</h4>
              <p class="text-gray-600 text-sm">믿을 수 있는 곳을 찾기까지 끝까지 함께</p>
            </div>
          </div>
        </div>
      </section>

      {/* 3단계 프로세스 */}
      <section class="py-20 bg-gray-50">
        <div class="max-w-7xl mx-auto px-4">
          <div class="text-center mb-16">
            <h3 class="text-3xl font-bold text-gray-900 mb-4">
              간단한 3단계로 <span class="text-teal-600">완료!</span>
            </h3>
          </div>
          
          <div class="grid md:grid-cols-3 gap-8">
            <div class="text-center relative">
              <div class="w-20 h-20 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-6">
                <span class="text-2xl font-bold text-white">1</span>
              </div>
              <h4 class="text-xl font-bold mb-4">정보 입력</h4>
              <p class="text-gray-600">어르신의 기본 정보와 필요한 서비스를 입력</p>
            </div>
            
            <div class="text-center relative">
              <div class="w-20 h-20 bg-gradient-to-r from-green-500 to-green-600 rounded-full flex items-center justify-center mx-auto mb-6">
                <span class="text-2xl font-bold text-white">2</span>
              </div>
              <h4 class="text-xl font-bold mb-4">견적 비교</h4>
              <p class="text-gray-600">실시간으로 매칭된 시설들을 비교</p>
            </div>
            
            <div class="text-center">
              <div class="w-20 h-20 bg-gradient-to-r from-purple-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-6">
                <span class="text-2xl font-bold text-white">3</span>
              </div>
              <h4 class="text-xl font-bold mb-4">전문 상담</h4>
              <p class="text-gray-600">전문 상담사와 1:1 맞춤 상담</p>
            </div>
          </div>
        </div>
      </section>

      {/* 파트너 입점 섹션 */}
      <section id="partner-section" class="py-20 bg-gradient-to-br from-teal-50 to-emerald-50">
        <div class="max-w-7xl mx-auto px-4">
          <div class="text-center mb-12">
            <h3 class="text-3xl font-bold text-gray-900 mb-4">
              <i class="fas fa-handshake text-teal-600 mr-3"></i>파트너 입점 및 등록 신청
            </h3>
            <p class="text-lg text-gray-600">케어조아와 함께 더 많은 고객을 만나보세요</p>
          </div>
          
          <div class="bg-white p-8 rounded-2xl shadow-lg max-w-4xl mx-auto">
            <form id="partnerForm" class="space-y-6">
              <div class="grid md:grid-cols-2 gap-6">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    <i class="fas fa-building mr-1 text-blue-500"></i>시설명*
                  </label>
                  <input type="text" id="facilityName" required 
                    class="w-full p-3 border rounded-lg"
                    placeholder="시설/서비스명" />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    <i class="fas fa-tag mr-1 text-purple-500"></i>시설 유형*
                  </label>
                  <select id="facilityType" required class="w-full p-3 border rounded-lg">
                    <option value="">선택하세요</option>
                    <option value="상급종합병원">상급종합병원</option>
                    <option value="주민센터사회복지">주민센터사회복지</option>
                    <option value="요양원">요양원</option>
                    <option value="요양병원">요양병원</option>
                    <option value="주간보호센터">주간보호센터</option>
                    <option value="그룹홈">그룹홈</option>
                    <option value="재가복지센터">재가복지센터</option>
                    <option value="한의사왕진서비스">한의사왕진서비스</option>
                    <option value="기타">기타</option>
                  </select>
                </div>
              </div>
              
              {/* 주소 필드 추가 */}
              <div class="space-y-4">
                <label class="block text-sm font-medium text-gray-700">
                  <i class="fas fa-map-marker-alt mr-1 text-red-500"></i>시설 주소*
                </label>
                <div class="grid md:grid-cols-2 gap-4">
                  <div>
                    <select id="facilityS ido" required class="w-full p-3 border rounded-lg">
                      <option value="">시/도 선택</option>
                      <option value="서울특별시">서울특별시</option>
                      <option value="부산광역시">부산광역시</option>
                      <option value="대구광역시">대구광역시</option>
                      <option value="인천광역시">인천광역시</option>
                      <option value="광주광역시">광주광역시</option>
                      <option value="대전광역시">대전광역시</option>
                      <option value="울산광역시">울산광역시</option>
                      <option value="세종특별자치시">세종특별자치시</option>
                      <option value="경기도">경기도</option>
                      <option value="강원도">강원도</option>
                      <option value="충청북도">충청북도</option>
                      <option value="충청남도">충청남도</option>
                      <option value="전라북도">전라북도</option>
                      <option value="전라남도">전라남도</option>
                      <option value="경상북도">경상북도</option>
                      <option value="경상남도">경상남도</option>
                      <option value="제주특별자치도">제주특별자치도</option>
                    </select>
                  </div>
                  <div>
                    <select id="facilitySigungu" required class="w-full p-3 border rounded-lg">
                      <option value="">시/군/구 선택</option>
                    </select>
                  </div>
                </div>
                <div>
                  <input type="text" id="facilityDetailAddress" required 
                    class="w-full p-3 border rounded-lg" 
                    placeholder="상세주소 입력 (예: 강남대로 123, 3층)" />
                </div>
              </div>

              <div class="grid md:grid-cols-2 gap-6">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    <i class="fas fa-user mr-1 text-green-500"></i>담당자명*
                  </label>
                  <input type="text" id="managerName" required class="w-full p-3 border rounded-lg" />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    <i class="fas fa-phone mr-1 text-purple-500"></i>연락처*
                  </label>
                  <input type="tel" id="managerPhone" required class="w-full p-3 border rounded-lg" placeholder="010-0000-0000" />
                </div>
              </div>
              
              <div class="text-center pt-6">
                <button type="submit" class="bg-gradient-to-r from-teal-600 to-emerald-600 text-white px-12 py-4 rounded-lg hover:from-teal-700 hover:to-emerald-700 transform hover:scale-105 font-bold">
                  <i class="fas fa-handshake mr-2"></i>파트너 등록 신청
                </button>
              </div>
            </form>
          </div>
        </div>
      </section>

      {/* 견적 테스트 섹션 */}
      <section class="py-16 bg-gradient-to-br from-yellow-50 to-orange-50 border-t-4 border-yellow-400">
        <div class="max-w-7xl mx-auto px-4">
          <div class="text-center mb-8">
            <div class="inline-block bg-yellow-100 text-yellow-800 px-4 py-2 rounded-full text-sm font-semibold mb-4">
              <i class="fas fa-flask mr-2"></i>테스트 버전
            </div>
            <h3 class="text-3xl font-bold text-gray-900 mb-4">
              <i class="fas fa-vial text-yellow-600 mr-3"></i>견적 테스트
            </h3>
            <p class="text-lg text-gray-600">새로운 견적 시스템을 테스트해보세요 (개발 중)</p>
          </div>
          
          <div class="grid md:grid-cols-3 gap-6 max-w-5xl mx-auto">
            {/* 간편견적 테스트 */}
            <div class="bg-white rounded-2xl shadow-lg p-6 hover:shadow-xl transition-all duration-300 border-2 border-blue-200">
              <div class="text-center">
                <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                  <i class="fas fa-bolt text-3xl text-blue-600"></i>
                </div>
                <h4 class="text-xl font-bold text-gray-900 mb-2">간편견적</h4>
                <p class="text-sm text-gray-600 mb-6">5분 이내 빠른 신청</p>
                <a href="/quote-simple" 
                   class="block bg-blue-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-blue-700 transition-colors">
                  <i class="fas fa-arrow-right mr-2"></i>테스트 시작
                </a>
              </div>
            </div>

            {/* 상세견적 테스트 */}
            <div class="bg-white rounded-2xl shadow-lg p-6 hover:shadow-xl transition-all duration-300 border-2 border-green-200">
              <div class="text-center">
                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                  <i class="fas fa-file-alt text-3xl text-green-600"></i>
                </div>
                <h4 class="text-xl font-bold text-gray-900 mb-2">상세견적</h4>
                <p class="text-sm text-gray-600 mb-6">3가지 견적 방식</p>
                <a href="/quote-request" 
                   class="block bg-green-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-green-700 transition-colors">
                  <i class="fas fa-arrow-right mr-2"></i>테스트 시작
                </a>
              </div>
            </div>

            {/* 관리자 테스트 */}
            <div class="bg-white rounded-2xl shadow-lg p-6 hover:shadow-xl transition-all duration-300 border-2 border-purple-200">
              <div class="text-center">
                <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                  <i class="fas fa-shield-alt text-3xl text-purple-600"></i>
                </div>
                <h4 class="text-xl font-bold text-gray-900 mb-2">관리자</h4>
                <p class="text-sm text-gray-600 mb-6">승인/거부 시스템</p>
                <a href="/admin" 
                   class="block bg-purple-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-purple-700 transition-colors">
                  <i class="fas fa-arrow-right mr-2"></i>테스트 시작
                </a>
              </div>
            </div>
          </div>

          {/* 테스트 안내 */}
          <div class="mt-8 bg-yellow-100 border-l-4 border-yellow-500 p-4 rounded max-w-3xl mx-auto">
            <div class="flex">
              <div class="flex-shrink-0">
                <i class="fas fa-info-circle text-yellow-600 text-xl"></i>
              </div>
              <div class="ml-3">
                <p class="text-sm text-yellow-800">
                  <strong class="font-semibold">테스트 기능:</strong> 견적 신청, 파트너 승인/거부, 지역 필터링이 구현되었습니다.
                  테스트 완료 후 메인 버튼으로 교체 예정입니다.
                </p>
              </div>
            </div>
          </div>

          {/* 테스트 통계 (선택사항) */}
          <div class="mt-8 grid grid-cols-3 gap-4 max-w-2xl mx-auto">
            <div class="bg-white rounded-lg p-4 text-center shadow">
              <div class="text-2xl font-bold text-blue-600">NEW</div>
              <div class="text-xs text-gray-600 mt-1">간편견적</div>
            </div>
            <div class="bg-white rounded-lg p-4 text-center shadow">
              <div class="text-2xl font-bold text-green-600">NEW</div>
              <div class="text-xs text-gray-600 mt-1">승인시스템</div>
            </div>
            <div class="bg-white rounded-lg p-4 text-center shadow">
              <div class="text-2xl font-bold text-purple-600">NEW</div>
              <div class="text-xs text-gray-600 mt-1">지역필터</div>
            </div>
          </div>
        </div>
      </section>

      {/* 푸터 */}
      <footer class="bg-gray-900 text-white py-12">
        <div class="max-w-7xl mx-auto px-4">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
            <div>
              <h4 class="text-lg font-bold mb-4 flex items-center">
                <i class="fas fa-heart mr-2 text-teal-400"></i>케어조아
              </h4>
              <p class="text-gray-400 text-sm">내 집처럼 편안한 곳, 내 가족처럼 믿을 수 있는 곳</p>
            </div>
            
            <div>
              <h5 class="font-semibold mb-4">서비스</h5>
              <ul class="space-y-2 text-sm text-gray-400">
                <li>실시간 견적</li>
                <li>시설 검색</li>
                <li>전문 상담</li>
                <li>파트너 등록</li>
              </ul>
            </div>
            
            <div>
              <h5 class="font-semibold mb-4">고객지원</h5>
              <ul class="space-y-3 text-sm text-gray-400">
                <li class="flex items-center">
                  <i class="fas fa-phone mr-2 text-teal-400"></i>
                  <a href="tel:0507-1310-5873">0507-1310-5873</a>
                </li>
                <li>
                  <a href="https://open.kakao.com/o/siR7YBUh" target="_blank" class="flex items-center">
                    <i class="fas fa-comment-dots mr-2 text-yellow-400"></i>카카오톡 상담
                  </a>
                </li>
                <li class="flex items-center">
                  <i class="fas fa-envelope mr-2 text-blue-400"></i>utuber@kakao.com
                </li>
              </ul>
            </div>
            
            <div>
              <h5 class="font-semibold mb-4">앱 다운로드</h5>
              <div class="space-y-3">
                <a href="https://play.google.com/store/apps/details?id=app.netlify.std_care_joa.twa" target="_blank" class="flex items-center text-sm text-gray-400">
                  <i class="fab fa-android mr-2 text-green-400"></i>안드로이드 앱
                </a>
                <a href="https://www.carejoa.com" target="_blank" class="flex items-center text-sm text-gray-400">
                  <i class="fas fa-globe mr-2 text-blue-400"></i>웹 서비스
                </a>
              </div>
            </div>
          </div>
          
          <div class="border-t border-gray-800 mt-8 pt-8 text-center">
            <p class="text-sm text-blue-400 font-medium mb-3">
              <i class="fas fa-certificate mr-1"></i>특허기반 실시간 요양 견적 및 상담 플랫폼
            </p>
            <p class="text-xs text-gray-400">© 2024 케어조아. All rights reserved.</p>
          </div>
        </div>
      </footer>

      <script dangerouslySetInnerHTML={{
        __html: `
        // 시도별 시군구 데이터
        const sigunguData = {
          '서울특별시': ['강남구', '강동구', '강북구', '강서구', '관악구', '광진구', '구로구', '금천구', '노원구', '도봉구', '동대문구', '동작구', '마포구', '서대문구', '서초구', '성동구', '성북구', '송파구', '양천구', '영등포구', '용산구', '은평구', '종로구', '중구', '중랑구'],
          '부산광역시': ['강서구', '금정구', '기장군', '남구', '동구', '동래구', '부산진구', '북구', '사상구', '사하구', '서구', '수영구', '연제구', '영도구', '중구', '해운대구'],
          '대구광역시': ['남구', '달서구', '달성군', '동구', '북구', '서구', '수성구', '중구'],
          '인천광역시': ['강화군', '계양구', '남동구', '동구', '미추홀구', '부평구', '서구', '연수구', '옹진군', '중구'],
          '광주광역시': ['광산구', '남구', '동구', '북구', '서구'],
          '대전광역시': ['대덕구', '동구', '서구', '유성구', '중구'],
          '울산광역시': ['남구', '동구', '북구', '울주군', '중구'],
          '세종특별자치시': ['세종시'],
          '경기도': ['가평군', '고양시', '과천시', '광명시', '광주시', '구리시', '군포시', '김포시', '남양주시', '동두천시', '부천시', '성남시', '수원시', '시흥시', '안산시', '안성시', '안양시', '양주시', '양평군', '여주시', '연천군', '오산시', '용인시', '의왕시', '의정부시', '이천시', '파주시', '평택시', '포천시', '하남시', '화성시'],
          '강원도': ['강릉시', '고성군', '동해시', '삼척시', '속초시', '양구군', '양양군', '영월군', '원주시', '인제군', '정선군', '철원군', '춘천시', '태백시', '평창군', '홍천군', '화천군', '횡성군'],
          '충청북도': ['괴산군', '단양군', '보은군', '영동군', '옥천군', '음성군', '제천시', '증평군', '진천군', '청주시', '충주시'],
          '충청남도': ['계룡시', '공주시', '금산군', '논산시', '당진시', '보령시', '부여군', '서산시', '서천군', '아산시', '예산군', '천안시', '청양군', '태안군', '홍성군'],
          '전라북도': ['고창군', '군산시', '김제시', '남원시', '무주군', '부안군', '순창군', '완주군', '익산시', '임실군', '장수군', '전주시', '정읍시', '진안군'],
          '전라남도': ['강진군', '고흥군', '곡성군', '광양시', '구례군', '나주시', '담양군', '목포시', '무안군', '보성군', '순천시', '신안군', '여수시', '영광군', '영암군', '완도군', '장성군', '장흥군', '진도군', '함평군', '해남군', '화순군'],
          '경상북도': ['경산시', '경주시', '고령군', '구미시', '군위군', '김천시', '문경시', '봉화군', '상주시', '성주군', '안동시', '영덕군', '영양군', '영주시', '영천시', '예천군', '울릉군', '울진군', '의성군', '청도군', '청송군', '칠곡군', '포항시'],
          '경상남도': ['거제시', '거창군', '고성군', '김해시', '남해군', '밀양시', '사천시', '산청군', '양산시', '의령군', '진주시', '창녕군', '창원시', '통영시', '하동군', '함안군', '함양군', '합천군'],
          '제주특별자치도': ['서귀포시', '제주시']
        };

        // 시도 변경 시 시군구 업데이트
        document.getElementById('facilitySido').addEventListener('change', function() {
          const sido = this.value;
          const sigunguSelect = document.getElementById('facilitySigungu');
          
          sigunguSelect.innerHTML = '<option value="">시/군/구 선택</option>';
          
          if (sido && sigunguData[sido]) {
            sigunguData[sido].forEach(sigungu => {
              const option = document.createElement('option');
              option.value = sigungu;
              option.textContent = sigungu;
              sigunguSelect.appendChild(option);
            });
          }
        });

        // 파트너 폼 제출
        document.getElementById('partnerForm').addEventListener('submit', async (e) => {
          e.preventDefault();
          const data = {
            facilityName: document.getElementById('facilityName').value,
            facilityType: document.getElementById('facilityType').value,
            facilitySido: document.getElementById('facilitySido').value,
            facilitySigungu: document.getElementById('facilitySigungu').value,
            facilityDetailAddress: document.getElementById('facilityDetailAddress').value,
            managerName: document.getElementById('managerName').value,
            managerPhone: document.getElementById('managerPhone').value,
          };
          
          try {
            const response = await axios.post('/api/partner', data);
            alert(response.data.message);
            e.target.reset();
          } catch (error) {
            alert('신청 중 오류가 발생했습니다.');
          }
        });
        `
      }} />
    </div>
  )
})

// 가족 간병 등록 페이지
app.get('/family-care-register', (c) => {
  return c.render(
    <div>
      <header class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="flex justify-between items-center h-16">
            <a href="/" class="flex items-center">
              <img 
                src="https://page.gensparksite.com/v1/base64_upload/b39dca8586af1dacd6d8417554313896" 
                alt="케어조아 로고"
                class="h-8 w-auto mr-3"
              />
              <h1 class="text-2xl font-bold text-teal-600">케어조아</h1>
            </a>
            <a href="/" class="text-gray-600 hover:text-gray-900">
              <i class="fas fa-home mr-1"></i>홈으로
            </a>
          </div>
        </div>
      </header>

      <section class="py-16 bg-gradient-to-br from-green-50 to-emerald-50 min-h-screen">
        <div class="max-w-4xl mx-auto px-4">
          <div class="text-center mb-12">
            <h2 class="text-4xl font-bold text-gray-900 mb-4">
              <i class="fas fa-heart text-green-600 mr-3"></i>가족 간병 등록
            </h2>
            <p class="text-lg text-gray-600">우리 가족을 위한 최적의 간병 서비스를 찾아드립니다</p>
          </div>

          <div class="bg-white p-8 rounded-2xl shadow-lg">
            <form id="familyCareForm" class="space-y-6">
              <div class="grid md:grid-cols-2 gap-6">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    <i class="fas fa-user mr-1 text-blue-500"></i>보호자 이름*
                  </label>
                  <input type="text" id="guardianName" required class="w-full p-3 border rounded-lg" />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    <i class="fas fa-phone mr-1 text-green-500"></i>연락처*
                  </label>
                  <input type="tel" id="guardianPhone" required class="w-full p-3 border rounded-lg" placeholder="010-0000-0000" />
                </div>
              </div>

              <div class="grid md:grid-cols-2 gap-6">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    <i class="fas fa-user-injured mr-1 text-purple-500"></i>환자 이름*
                  </label>
                  <input type="text" id="patientName" required class="w-full p-3 border rounded-lg" />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    <i class="fas fa-calendar mr-1 text-orange-500"></i>환자 나이*
                  </label>
                  <input type="number" id="patientAge" required class="w-full p-3 border rounded-lg" placeholder="예: 75" />
                </div>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  <i class="fas fa-map-marker-alt mr-1 text-red-500"></i>지역*
                </label>
                <input type="text" id="region" required class="w-full p-3 border rounded-lg" placeholder="예: 서울시 강남구" />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  <i class="fas fa-notes-medical mr-1 text-teal-500"></i>상세 요청사항
                </label>
                <textarea id="requirements" rows="4" class="w-full p-3 border rounded-lg" placeholder="필요한 간병 서비스나 특별한 요구사항을 적어주세요"></textarea>
              </div>

              <div class="text-center pt-6">
                <button type="submit" class="bg-gradient-to-r from-green-600 to-emerald-600 text-white px-12 py-4 rounded-lg hover:from-green-700 hover:to-emerald-700 transform hover:scale-105 font-bold">
                  <i class="fas fa-heart mr-2"></i>가족 간병 등록 신청
                </button>
              </div>
            </form>
          </div>
        </div>
      </section>

      <script dangerouslySetInnerHTML={{
        __html: `
        document.getElementById('familyCareForm').addEventListener('submit', async (e) => {
          e.preventDefault();
          const data = {
            guardianName: document.getElementById('guardianName').value,
            guardianPhone: document.getElementById('guardianPhone').value,
            patientName: document.getElementById('patientName').value,
            patientAge: document.getElementById('patientAge').value,
            region: document.getElementById('region').value,
            requirements: document.getElementById('requirements').value,
          };
          
          try {
            const response = await axios.post('/api/family-care', data);
            alert(response.data.message);
            window.location.href = '/';
          } catch (error) {
            alert('등록 중 오류가 발생했습니다.');
          }
        });
        `
      }} />
    </div>
  )
})

// 전국 시설 찾기 페이지
app.get('/facilities', (c) => {
  return c.render(
    <div>
      <header class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="flex justify-between items-center h-16">
            <a href="/" class="flex items-center">
              <img 
                src="https://page.gensparksite.com/v1/base64_upload/b39dca8586af1dacd6d8417554313896" 
                alt="케어조아 로고"
                class="h-8 w-auto mr-3"
              />
              <h1 class="text-2xl font-bold text-teal-600">케어조아</h1>
            </a>
            <a href="/" class="text-gray-600 hover:text-gray-900">
              <i class="fas fa-home mr-1"></i>홈으로
            </a>
          </div>
        </div>
      </header>

      <section class="py-8 bg-gray-50 min-h-screen">
        <div class="max-w-7xl mx-auto px-4">
          {/* 페이지 헤더 */}
          <div class="mb-6">
            <h2 class="text-3xl font-bold text-gray-900 mb-2 flex items-center">
              <i class="fas fa-search text-purple-600 mr-3"></i>
              전국 시설 찾기
            </h2>
            <p class="text-gray-600">전국 요양시설을 검색하고 비교하세요</p>
          </div>

          {/* 검색 필터 */}
          <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  <i class="fas fa-map-marker-alt text-red-500 mr-1"></i>시/도
                </label>
                <select id="filterSido" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200">
                  <option value="">전체 시/도</option>
                  <option value="서울특별시">서울특별시</option>
                  <option value="부산광역시">부산광역시</option>
                  <option value="대구광역시">대구광역시</option>
                  <option value="인천광역시">인천광역시</option>
                  <option value="광주광역시">광주광역시</option>
                  <option value="대전광역시">대전광역시</option>
                  <option value="울산광역시">울산광역시</option>
                  <option value="세종특별자치시">세종특별자치시</option>
                  <option value="경기도">경기도</option>
                  <option value="강원도">강원도</option>
                  <option value="충청북도">충청북도</option>
                  <option value="충청남도">충청남도</option>
                  <option value="전라북도">전라북도</option>
                  <option value="전라남도">전라남도</option>
                  <option value="경상북도">경상북도</option>
                  <option value="경상남도">경상남도</option>
                  <option value="제주특별자치도">제주특별자치도</option>
                </select>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  <i class="fas fa-map-pin text-blue-500 mr-1"></i>시/군/구
                </label>
                <select id="filterSigungu" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200">
                  <option value="">전체 시/군/구</option>
                </select>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  <i class="fas fa-building text-green-500 mr-1"></i>시설 유형
                </label>
                <select id="filterType" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200">
                  <option value="">전체 유형</option>
                  <option value="요양병원">요양병원</option>
                  <option value="요양원">요양원</option>
                  <option value="주야간보호">주야간보호</option>
                  <option value="재가복지센터">재가복지센터</option>
                </select>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  <i class="fas fa-search text-gray-500 mr-1"></i>시설명 검색
                </label>
                <input 
                  type="text" 
                  id="filterKeyword" 
                  placeholder="시설명 입력"
                  class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200"
                />
              </div>
            </div>

            <div class="mt-4 flex justify-between items-center">
              <div class="text-sm text-gray-600">
                <span id="resultCount" class="font-bold text-purple-600">0</span>개의 시설이 검색되었습니다
              </div>
              <button 
                id="resetFilters"
                class="px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors"
              >
                <i class="fas fa-redo mr-2"></i>필터 초기화
              </button>
            </div>
          </div>

          {/* 시설 목록 */}
          <div id="facilitiesList" class="space-y-4">
            {/* 시설 카드들이 동적으로 삽입됩니다 */}
          </div>

          {/* 로딩 표시 */}
          <div id="loadingSpinner" class="text-center py-12">
            <i class="fas fa-spinner fa-spin text-4xl text-purple-600"></i>
            <p class="text-gray-600 mt-4">시설 데이터를 불러오는 중...</p>
          </div>

          {/* 결과 없음 메시지 */}
          <div id="noResults" class="hidden bg-white rounded-xl shadow-lg p-12 text-center">
            <i class="fas fa-search text-6xl text-gray-300 mb-4"></i>
            <h3 class="text-2xl font-bold text-gray-700 mb-2">검색 결과가 없습니다</h3>
            <p class="text-gray-500">다른 조건으로 검색해 주세요</p>
          </div>
        </div>
      </section>

      {/* JavaScript for Facilities Search */}
      <script dangerouslySetInnerHTML={{__html: `
        let allFacilities = [];
        let filteredFacilities = [];

        // 시도별 시군구 데이터
        const sigunguData = {
          '서울특별시': ['강남구', '강동구', '강북구', '강서구', '관악구', '광진구', '구로구', '금천구', '노원구', '도봉구', '동대문구', '동작구', '마포구', '서대문구', '서초구', '성동구', '성북구', '송파구', '양천구', '영등포구', '용산구', '은평구', '종로구', '중구', '중랑구'],
          '부산광역시': ['강서구', '금정구', '기장군', '남구', '동구', '동래구', '부산진구', '북구', '사상구', '사하구', '서구', '수영구', '연제구', '영도구', '중구', '해운대구'],
          '대구광역시': ['남구', '달서구', '달성군', '동구', '북구', '서구', '수성구', '중구'],
          '인천광역시': ['강화군', '계양구', '남동구', '동구', '미추홀구', '부평구', '서구', '연수구', '옹진군', '중구'],
          '광주광역시': ['광산구', '남구', '동구', '북구', '서구'],
          '대전광역시': ['대덕구', '동구', '서구', '유성구', '중구'],
          '울산광역시': ['남구', '동구', '북구', '울주군', '중구'],
          '세종특별자치시': ['세종시'],
          '경기도': ['가평군', '고양시', '과천시', '광명시', '광주시', '구리시', '군포시', '김포시', '남양주시', '동두천시', '부천시', '성남시', '수원시', '시흥시', '안산시', '안성시', '안양시', '양주시', '양평군', '여주시', '연천군', '오산시', '용인시', '의왕시', '의정부시', '이천시', '파주시', '평택시', '포천시', '하남시', '화성시'],
          '강원도': ['강릉시', '고성군', '동해시', '삼척시', '속초시', '양구군', '양양군', '영월군', '원주시', '인제군', '정선군', '철원군', '춘천시', '태백시', '평창군', '홍천군', '화천군', '횡성군'],
          '충청북도': ['괴산군', '단양군', '보은군', '영동군', '옥천군', '음성군', '제천시', '증평군', '진천군', '청주시', '충주시'],
          '충청남도': ['계룡시', '공주시', '금산군', '논산시', '당진시', '보령시', '부여군', '서산시', '서천군', '아산시', '예산군', '천안시', '청양군', '태안군', '홍성군'],
          '전라북도': ['고창군', '군산시', '김제시', '남원시', '무주군', '부안군', '순창군', '완주군', '익산시', '임실군', '장수군', '전주시', '정읍시', '진안군'],
          '전라남도': ['강진군', '고흥군', '곡성군', '광양시', '구례군', '나주시', '담양군', '목포시', '무안군', '보성군', '순천시', '신안군', '여수시', '영광군', '영암군', '완도군', '장성군', '장흥군', '진도군', '함평군', '해남군', '화순군'],
          '경상북도': ['경산시', '경주시', '고령군', '구미시', '군위군', '김천시', '문경시', '봉화군', '상주시', '성주군', '안동시', '영덕군', '영양군', '영주시', '영천시', '예천군', '울릉군', '울진군', '의성군', '청도군', '청송군', '칠곡군', '포항시'],
          '경상남도': ['거제시', '거창군', '고성군', '김해시', '남해군', '밀양시', '사천시', '산청군', '양산시', '의령군', '진주시', '창녕군', '창원시', '통영시', '하동군', '함안군', '함양군', '합천군'],
          '제주특별자치도': ['서귀포시', '제주시']
        };

        // 페이지 로드 시 시설 데이터 불러오기
        async function loadFacilities() {
          try {
            const response = await fetch('/static/facilities.json');
            allFacilities = await response.json();
            filteredFacilities = [...allFacilities];
            
            document.getElementById('loadingSpinner').style.display = 'none';
            displayFacilities();
          } catch (error) {
            console.error('시설 데이터 로딩 오류:', error);
            document.getElementById('loadingSpinner').innerHTML = \`
              <i class="fas fa-exclamation-circle text-4xl text-red-600"></i>
              <p class="text-gray-600 mt-4">데이터를 불러오는데 실패했습니다</p>
            \`;
          }
        }

        // 시설 목록 표시
        function displayFacilities() {
          const listEl = document.getElementById('facilitiesList');
          const countEl = document.getElementById('resultCount');
          const noResultsEl = document.getElementById('noResults');
          
          countEl.textContent = filteredFacilities.length;
          
          if (filteredFacilities.length === 0) {
            listEl.style.display = 'none';
            noResultsEl.classList.remove('hidden');
            return;
          }
          
          listEl.style.display = 'block';
          noResultsEl.classList.add('hidden');
          
          // 최대 100개만 표시
          const displayItems = filteredFacilities.slice(0, 100);
          
          listEl.innerHTML = displayItems.map((facility, index) => \`
            <div class="bg-white rounded-xl shadow-md hover:shadow-lg transition-all duration-300 p-6">
              <div class="flex justify-between items-start">
                <div class="flex-1">
                  <div class="flex items-center gap-3 mb-3">
                    <h3 class="text-xl font-bold text-gray-900">\${facility.name}</h3>
                    <span class="inline-block px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-sm font-semibold">
                      \${facility.type}
                    </span>
                  </div>
                  
                  <div class="space-y-2 text-gray-600">
                    <div class="flex items-center">
                      <i class="fas fa-map-marker-alt text-red-500 mr-2 w-5"></i>
                      <span class="text-sm">\${facility.address}</span>
                    </div>
                    <div class="flex items-center">
                      <i class="fas fa-map-pin text-blue-500 mr-2 w-5"></i>
                      <span class="text-sm font-medium">\${facility.sido} \${facility.sigungu}</span>
                    </div>
                  </div>
                </div>
                
                <div class="text-right">
                  <div class="text-sm text-gray-500 mb-2">ID: \${facility.id}</div>
                </div>
              </div>
              
              <div class="mt-4 pt-4 border-t flex gap-2">
                <button 
                  onclick="showOnMap(\${facility.lat}, \${facility.lng}, '\${facility.name}')"
                  class="flex-1 bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 transition-colors text-sm font-medium"
                >
                  <i class="fas fa-map-marked-alt mr-2"></i>지도에서 보기
                </button>
                <a 
                  href="tel:0507-1310-5873"
                  class="flex-1 bg-green-500 text-white py-2 px-4 rounded-lg hover:bg-green-600 transition-colors text-sm font-medium text-center"
                >
                  <i class="fas fa-phone mr-2"></i>상담하기
                </a>
              </div>
            </div>
          \`).join('');
          
          if (filteredFacilities.length > 100) {
            listEl.innerHTML += \`
              <div class="bg-yellow-50 border-2 border-yellow-300 rounded-xl p-6 text-center">
                <i class="fas fa-info-circle text-yellow-600 text-2xl mb-2"></i>
                <p class="text-gray-700">
                  총 <strong class="text-yellow-700">\${filteredFacilities.length}</strong>개 중 
                  <strong class="text-yellow-700">100</strong>개만 표시됩니다. 
                  더 정확한 검색을 위해 필터를 사용해주세요.
                </p>
              </div>
            \`;
          }
        }

        // 지도 표시 (간단한 알림으로 대체)
        function showOnMap(lat, lng, name) {
          alert(\`\${name}\\n위도: \${lat}\\n경도: \${lng}\\n\\n지도 기능은 곧 추가될 예정입니다.\`);
        }

        // 필터 적용
        function applyFilters() {
          const sido = document.getElementById('filterSido').value;
          const sigungu = document.getElementById('filterSigungu').value;
          const type = document.getElementById('filterType').value;
          const keyword = document.getElementById('filterKeyword').value.toLowerCase();
          
          filteredFacilities = allFacilities.filter(facility => {
            if (sido && facility.sido !== sido) return false;
            if (sigungu && facility.sigungu !== sigungu) return false;
            if (type && facility.type !== type) return false;
            if (keyword && !facility.name.toLowerCase().includes(keyword) && !facility.address.toLowerCase().includes(keyword)) return false;
            return true;
          });
          
          displayFacilities();
        }

        // 시도 변경 시 시군구 업데이트
        document.getElementById('filterSido').addEventListener('change', function() {
          const sido = this.value;
          const sigunguSelect = document.getElementById('filterSigungu');
          
          sigunguSelect.innerHTML = '<option value="">전체 시/군/구</option>';
          
          if (sido && sigunguData[sido]) {
            sigunguData[sido].forEach(sigungu => {
              const option = document.createElement('option');
              option.value = sigungu;
              option.textContent = sigungu;
              sigunguSelect.appendChild(option);
            });
          }
          
          applyFilters();
        });

        // 필터 변경 이벤트
        document.getElementById('filterSigungu').addEventListener('change', applyFilters);
        document.getElementById('filterType').addEventListener('change', applyFilters);
        document.getElementById('filterKeyword').addEventListener('input', applyFilters);

        // 필터 초기화
        document.getElementById('resetFilters').addEventListener('click', function() {
          document.getElementById('filterSido').value = '';
          document.getElementById('filterSigungu').innerHTML = '<option value="">전체 시/군/구</option>';
          document.getElementById('filterType').value = '';
          document.getElementById('filterKeyword').value = '';
          filteredFacilities = [...allFacilities];
          displayFacilities();
        });

        // 페이지 로드 시 실행
        loadFacilities();
      `}} />
    </div>
  )
})

// 지역별 전화상담 페이지
app.get('/regional-consultation', (c) => {
  return c.render(
    <div>
      <header class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="flex justify-between items-center h-16">
            <a href="/" class="flex items-center">
              <img 
                src="https://page.gensparksite.com/v1/base64_upload/b39dca8586af1dacd6d8417554313896" 
                alt="케어조아 로고"
                class="h-8 w-auto mr-3"
              />
              <h1 class="text-2xl font-bold text-teal-600">케어조아</h1>
            </a>
            <a href="/" class="text-gray-600 hover:text-gray-900">
              <i class="fas fa-home mr-1"></i>홈으로
            </a>
          </div>
        </div>
      </header>

      <section class="py-16 bg-gradient-to-br from-green-50 to-emerald-50 min-h-screen">
        <div class="max-w-6xl mx-auto px-4">
          {/* 페이지 헤더 */}
          <div class="text-center mb-12">
            <div class="inline-block bg-green-100 text-green-800 px-4 py-2 rounded-full text-sm font-semibold mb-4">
              <i class="fas fa-phone-alt mr-2"></i>전문 상담사 연결
            </div>
            <h2 class="text-4xl font-bold text-gray-900 mb-4">
              지역별 전화상담
            </h2>
            <p class="text-lg text-gray-600">희망하는 지역을 선택하시면 해당 지역 전문 상담사와 바로 연결됩니다</p>
          </div>

          {/* 지역 선택 폼 */}
          <div class="bg-white p-8 rounded-2xl shadow-lg mb-8">
            <div class="grid md:grid-cols-2 gap-6 mb-6">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  <i class="fas fa-map-marker-alt mr-1 text-red-500"></i>시/도 선택*
                </label>
                <select id="consultSido" required class="w-full p-4 border-2 border-gray-300 rounded-xl focus:border-green-500 focus:ring-2 focus:ring-green-200 transition-all">
                  <option value="">시/도를 선택하세요</option>
                  <option value="서울특별시">서울특별시</option>
                  <option value="부산광역시">부산광역시</option>
                  <option value="대구광역시">대구광역시</option>
                  <option value="인천광역시">인천광역시</option>
                  <option value="광주광역시">광주광역시</option>
                  <option value="대전광역시">대전광역시</option>
                  <option value="울산광역시">울산광역시</option>
                  <option value="세종특별자치시">세종특별자치시</option>
                  <option value="경기도">경기도</option>
                  <option value="강원도">강원도</option>
                  <option value="충청북도">충청북도</option>
                  <option value="충청남도">충청남도</option>
                  <option value="전라북도">전라북도</option>
                  <option value="전라남도">전라남도</option>
                  <option value="경상북도">경상북도</option>
                  <option value="경상남도">경상남도</option>
                  <option value="제주특별자치도">제주특별자치도</option>
                </select>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  <i class="fas fa-map-pin mr-1 text-blue-500"></i>시/군/구 선택*
                </label>
                <select id="consultSigungu" required class="w-full p-4 border-2 border-gray-300 rounded-xl focus:border-green-500 focus:ring-2 focus:ring-green-200 transition-all">
                  <option value="">먼저 시/도를 선택하세요</option>
                </select>
              </div>
            </div>

            <div class="text-center">
              <button 
                id="searchConsultBtn"
                class="bg-gradient-to-r from-green-500 to-emerald-600 text-white px-12 py-4 rounded-xl hover:from-green-600 hover:to-emerald-700 transform hover:scale-105 font-bold text-lg shadow-lg transition-all duration-300"
              >
                <i class="fas fa-search mr-2"></i>상담센터 찾기
              </button>
            </div>
          </div>

          {/* 상담센터 결과 표시 영역 */}
          <div id="consultResults" class="hidden">
            <div class="bg-gradient-to-r from-blue-50 to-green-50 border-2 border-green-200 rounded-2xl p-6 mb-6">
              <div class="flex items-center justify-center text-center">
                <i class="fas fa-info-circle text-green-600 text-2xl mr-3"></i>
                <p class="text-gray-700">
                  선택하신 <strong id="selectedRegion" class="text-green-700"></strong> 지역의 상담센터를 안내해 드립니다
                </p>
              </div>
            </div>

            <div id="consultCentersList" class="grid md:grid-cols-2 gap-6">
              {/* 상담센터 카드들이 동적으로 삽입됩니다 */}
            </div>
          </div>

          {/* 대표 상담 안내 */}
          <div class="bg-gradient-to-r from-yellow-50 to-orange-50 border-2 border-yellow-300 rounded-2xl p-8 text-center shadow-lg">
            <div class="flex items-center justify-center mb-4">
              <i class="fas fa-headset text-yellow-600 text-4xl mr-3"></i>
              <h3 class="text-2xl font-bold text-gray-800">24시간 대표 상담</h3>
            </div>
            <p class="text-gray-600 mb-6">지역 상담센터 외에도 케어조아 대표 상담사가 24시간 대기하고 있습니다</p>
            <a href="tel:0507-1310-5873" class="inline-flex items-center bg-gradient-to-r from-yellow-500 to-orange-500 text-white px-8 py-4 rounded-xl hover:from-yellow-600 hover:to-orange-600 transform hover:scale-105 font-bold text-xl shadow-lg transition-all duration-300">
              <i class="fas fa-phone-alt mr-3"></i>0507-1310-5873
            </a>
            <p class="text-sm text-gray-500 mt-4">
              <i class="fas fa-clock mr-1"></i>운영시간: 24시간 365일 | 상담료: 무료
            </p>
          </div>
        </div>
      </section>

      {/* JavaScript for Regional Consultation */}
      <script dangerouslySetInnerHTML={{__html: `
        // 시도별 시군구 데이터 (동일한 데이터)
        const sigunguData = {
          '서울특별시': ['강남구', '강동구', '강북구', '강서구', '관악구', '광진구', '구로구', '금천구', '노원구', '도봉구', '동대문구', '동작구', '마포구', '서대문구', '서초구', '성동구', '성북구', '송파구', '양천구', '영등포구', '용산구', '은평구', '종로구', '중구', '중랑구'],
          '부산광역시': ['강서구', '금정구', '기장군', '남구', '동구', '동래구', '부산진구', '북구', '사상구', '사하구', '서구', '수영구', '연제구', '영도구', '중구', '해운대구'],
          '대구광역시': ['남구', '달서구', '달성군', '동구', '북구', '서구', '수성구', '중구'],
          '인천광역시': ['강화군', '계양구', '남동구', '동구', '미추홀구', '부평구', '서구', '연수구', '옹진군', '중구'],
          '광주광역시': ['광산구', '남구', '동구', '북구', '서구'],
          '대전광역시': ['대덕구', '동구', '서구', '유성구', '중구'],
          '울산광역시': ['남구', '동구', '북구', '울주군', '중구'],
          '세종특별자치시': ['세종시'],
          '경기도': ['가평군', '고양시', '과천시', '광명시', '광주시', '구리시', '군포시', '김포시', '남양주시', '동두천시', '부천시', '성남시', '수원시', '시흥시', '안산시', '안성시', '안양시', '양주시', '양평군', '여주시', '연천군', '오산시', '용인시', '의왕시', '의정부시', '이천시', '파주시', '평택시', '포천시', '하남시', '화성시'],
          '강원도': ['강릉시', '고성군', '동해시', '삼척시', '속초시', '양구군', '양양군', '영월군', '원주시', '인제군', '정선군', '철원군', '춘천시', '태백시', '평창군', '홍천군', '화천군', '횡성군'],
          '충청북도': ['괴산군', '단양군', '보은군', '영동군', '옥천군', '음성군', '제천시', '증평군', '진천군', '청주시', '충주시'],
          '충청남도': ['계룡시', '공주시', '금산군', '논산시', '당진시', '보령시', '부여군', '서산시', '서천군', '아산시', '예산군', '천안시', '청양군', '태안군', '홍성군'],
          '전라북도': ['고창군', '군산시', '김제시', '남원시', '무주군', '부안군', '순창군', '완주군', '익산시', '임실군', '장수군', '전주시', '정읍시', '진안군'],
          '전라남도': ['강진군', '고흥군', '곡성군', '광양시', '구례군', '나주시', '담양군', '목포시', '무안군', '보성군', '순천시', '신안군', '여수시', '영광군', '영암군', '완도군', '장성군', '장흥군', '진도군', '함평군', '해남군', '화순군'],
          '경상북도': ['경산시', '경주시', '고령군', '구미시', '군위군', '김천시', '문경시', '봉화군', '상주시', '성주군', '안동시', '영덕군', '영양군', '영주시', '영천시', '예천군', '울릉군', '울진군', '의성군', '청도군', '청송군', '칠곡군', '포항시'],
          '경상남도': ['거제시', '거창군', '고성군', '김해시', '남해군', '밀양시', '사천시', '산청군', '양산시', '의령군', '진주시', '창녕군', '창원시', '통영시', '하동군', '함안군', '함양군', '합천군'],
          '제주특별자치도': ['서귀포시', '제주시']
        };

        // 시도 변경 시 시군구 업데이트
        document.getElementById('consultSido').addEventListener('change', function() {
          const sido = this.value;
          const sigunguSelect = document.getElementById('consultSigungu');
          
          sigunguSelect.innerHTML = '<option value="">시/군/구 선택</option>';
          
          if (sido && sigunguData[sido]) {
            sigunguData[sido].forEach(sigungu => {
              const option = document.createElement('option');
              option.value = sigungu;
              option.textContent = sigungu;
              sigunguSelect.appendChild(option);
            });
          }
        });

        // 상담센터 찾기 버튼 클릭
        document.getElementById('searchConsultBtn').addEventListener('click', async function() {
          const sido = document.getElementById('consultSido').value;
          const sigungu = document.getElementById('consultSigungu').value;
          
          if (!sido || !sigungu) {
            alert('시/도와 시/군/구를 모두 선택해주세요.');
            return;
          }

          try {
            const response = await axios.get('/api/regional-centers', {
              params: { sido, sigungu }
            });

            // 선택한 지역 표시
            document.getElementById('selectedRegion').textContent = sido + ' ' + sigungu;
            
            // 결과 영역 표시
            document.getElementById('consultResults').classList.remove('hidden');
            
            // 상담센터 목록 생성
            const centersList = document.getElementById('consultCentersList');
            
            if (response.data.centers && response.data.centers.length > 0) {
              centersList.innerHTML = response.data.centers.map(center => \`
                <div class="bg-white rounded-2xl shadow-lg p-6 border-2 border-green-200 hover:border-green-400 transition-all duration-300 transform hover:scale-105">
                  <div class="flex items-start justify-between mb-4">
                    <div>
                      <h4 class="text-xl font-bold text-gray-900 mb-2">\${center.facilityName}</h4>
                      <span class="inline-block bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm font-semibold">
                        \${center.facilityType}
                      </span>
                    </div>
                    <i class="fas fa-hospital text-green-500 text-3xl"></i>
                  </div>
                  
                  <div class="space-y-3 mb-6">
                    <div class="flex items-center text-gray-600">
                      <i class="fas fa-map-marker-alt text-red-500 mr-2 w-5"></i>
                      <span class="text-sm">\${center.facilitySido} \${center.facilitySigungu}</span>
                    </div>
                    <div class="flex items-center text-gray-600">
                      <i class="fas fa-user text-blue-500 mr-2 w-5"></i>
                      <span class="text-sm">담당자: \${center.managerName}</span>
                    </div>
                    <div class="flex items-center text-gray-900 font-semibold">
                      <i class="fas fa-phone text-green-500 mr-2 w-5"></i>
                      <span>\${center.managerPhone}</span>
                    </div>
                  </div>
                  
                  <a href="tel:\${center.managerPhone}" 
                     class="block w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white py-3 rounded-xl hover:from-green-600 hover:to-emerald-700 text-center font-bold transition-all duration-300">
                    <i class="fas fa-phone-alt mr-2"></i>전화 상담하기
                  </a>
                </div>
              \`).join('');
            } else {
              centersList.innerHTML = \`
                <div class="col-span-2 bg-yellow-50 border-2 border-yellow-300 rounded-2xl p-8 text-center">
                  <i class="fas fa-info-circle text-yellow-600 text-4xl mb-4"></i>
                  <h4 class="text-xl font-bold text-gray-800 mb-3">해당 지역 상담센터 준비 중</h4>
                  <p class="text-gray-600 mb-6">선택하신 지역의 전문 상담센터를 준비 중입니다.<br/>케어조아 대표 상담센터로 연결해 드리겠습니다.</p>
                  <a href="tel:0507-1310-5873" 
                     class="inline-flex items-center bg-gradient-to-r from-yellow-500 to-orange-500 text-white px-8 py-3 rounded-xl hover:from-yellow-600 hover:to-orange-600 font-bold transition-all duration-300">
                    <i class="fas fa-phone-alt mr-2"></i>0507-1310-5873
                  </a>
                </div>
              \`;
            }

            // 결과 영역으로 스크롤
            document.getElementById('consultResults').scrollIntoView({ behavior: 'smooth', block: 'start' });
          } catch (error) {
            console.error('상담센터 검색 오류:', error);
            alert('상담센터 정보를 불러오는데 실패했습니다. 대표번호(0507-1310-5873)로 연락해 주세요.');
          }
        });
      `}} />
    </div>
  )
})

// 관리자 로그인 페이지
app.get('/admin', (c) => {
  if (isAdmin(c)) {
    return c.redirect('/admin/dashboard')
  }
  
  return c.render(
    <div class="min-h-screen flex items-center justify-center bg-gradient-to-br from-gray-900 to-gray-800">
      <div class="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-md">
        <div class="text-center mb-8">
          <div class="w-20 h-20 bg-gradient-to-r from-gray-800 to-gray-900 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-shield-alt text-3xl text-white"></i>
          </div>
          <h2 class="text-3xl font-bold text-gray-900">관리자 로그인</h2>
          <p class="text-gray-600 mt-2">케어조아 관리 시스템</p>
        </div>

        <form id="adminLoginForm" class="space-y-6">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              <i class="fas fa-lock mr-1 text-gray-600"></i>비밀번호
            </label>
            <input 
              type="password" 
              id="password" 
              required 
              class="w-full p-4 border-2 border-gray-300 rounded-lg focus:border-gray-900 focus:outline-none"
              placeholder="관리자 비밀번호를 입력하세요"
            />
          </div>

          <button 
            type="submit" 
            class="w-full bg-gradient-to-r from-gray-800 to-gray-900 text-white py-4 rounded-lg hover:from-gray-900 hover:to-black transform hover:scale-105 transition-all duration-300 font-bold"
          >
            <i class="fas fa-sign-in-alt mr-2"></i>로그인
          </button>
        </form>

        <div class="mt-6 text-center">
          <a href="/" class="text-gray-600 hover:text-gray-900 text-sm">
            <i class="fas fa-arrow-left mr-1"></i>메인 페이지로 돌아가기
          </a>
        </div>
      </div>

      <script dangerouslySetInnerHTML={{
        __html: `
        document.getElementById('adminLoginForm').addEventListener('submit', async (e) => {
          e.preventDefault();
          const password = document.getElementById('password').value;
          
          try {
            const response = await axios.post('/api/admin/login', { password });
            if (response.data.success) {
              window.location.href = '/admin/dashboard';
            } else {
              alert(response.data.message || '로그인 실패');
            }
          } catch (error) {
            alert('로그인 중 오류가 발생했습니다.');
          }
        });
        `
      }} />
    </div>
  )
})

// 관리자 시설 관리 페이지
app.get('/admin/facilities', (c) => {
  if (!isAdmin(c)) {
    return c.redirect('/admin')
  }
  
  return c.render(
    <div class="min-h-screen bg-gray-100">
      <header class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="flex justify-between items-center h-16">
            <div class="flex items-center">
              <i class="fas fa-shield-alt text-2xl text-gray-900 mr-3"></i>
              <h1 class="text-2xl font-bold text-gray-900">케어조아 관리자</h1>
            </div>
            <div class="flex items-center gap-3">
              <a href="/admin/dashboard" class="text-gray-600 hover:text-gray-900 px-4 py-2 rounded-lg hover:bg-gray-100">
                <i class="fas fa-home mr-1"></i>대시보드
              </a>
              <a href="/admin/facilities" class="text-teal-600 bg-teal-50 px-4 py-2 rounded-lg font-semibold">
                <i class="fas fa-building mr-1"></i>시설 관리
              </a>
              <button id="logoutBtn" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700">
                <i class="fas fa-sign-out-alt mr-2"></i>로그아웃
              </button>
            </div>
          </div>
        </div>
      </header>

      <div class="max-w-7xl mx-auto px-4 py-8">
        {/* 검색 및 필터 */}
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
          <h3 class="text-xl font-bold mb-4 flex items-center">
            <i class="fas fa-search text-purple-600 mr-2"></i>
            시설 검색 및 관리
            <span class="ml-3 text-sm text-gray-500">(총 <span id="totalFacilities">0</span>개 시설)</span>
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">시/도</label>
              <select id="adminFilterSido" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500">
                <option value="">전체</option>
                <option value="서울특별시">서울특별시</option>
                <option value="부산광역시">부산광역시</option>
                <option value="대구광역시">대구광역시</option>
                <option value="인천광역시">인천광역시</option>
                <option value="광주광역시">광주광역시</option>
                <option value="대전광역시">대전광역시</option>
                <option value="울산광역시">울산광역시</option>
                <option value="세종특별자치시">세종특별자치시</option>
                <option value="경기도">경기도</option>
                <option value="강원도">강원도</option>
                <option value="충청북도">충청북도</option>
                <option value="충청남도">충청남도</option>
                <option value="전라북도">전라북도</option>
                <option value="전라남도">전라남도</option>
                <option value="경상북도">경상북도</option>
                <option value="경상남도">경상남도</option>
                <option value="제주특별자치도">제주특별자치도</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">시/군/구</label>
              <select id="adminFilterSigungu" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500">
                <option value="">전체 시/군/구</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">시설 유형</label>
              <select id="adminFilterType" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500">
                <option value="">전체</option>
                <option value="요양병원">요양병원</option>
                <option value="요양원">요양원</option>
                <option value="주야간보호">주야간보호</option>
                <option value="재가복지센터">재가복지센터</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">시설명 검색</label>
              <input type="text" id="adminSearchKeyword" placeholder="시설명 입력" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500"/>
            </div>
          </div>
          <div class="flex gap-3">
            <button id="searchFacilitiesBtn" class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
              <i class="fas fa-search mr-2"></i>검색
            </button>
            <button id="resetFacilitiesBtn" class="px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors">
              <i class="fas fa-redo mr-2"></i>초기화
            </button>
          </div>
        </div>

        {/* 시설 목록 */}
        <div class="bg-white rounded-xl shadow-lg">
          <div class="border-b px-6 py-4 flex justify-between items-center">
            <h3 class="text-xl font-bold flex items-center">
              <i class="fas fa-building text-purple-600 mr-2"></i>
              시설 목록
              <span class="ml-3 text-sm text-gray-500">(<span id="filteredCount">0</span>개 검색됨)</span>
            </h3>
            <button onclick="openAddModal()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors font-semibold">
              <i class="fas fa-plus mr-2"></i>신규 등록
            </button>
          </div>
          <div class="p-6">
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead class="bg-gray-50">
                  <tr class="border-b">
                    <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">ID</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">시설명</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">유형</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">시/도</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">시/군/구</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">전화번호</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">주소</th>
                    <th class="px-4 py-3 text-center text-sm font-semibold text-gray-600">대표시설</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">관리</th>
                  </tr>
                </thead>
                <tbody id="facilitiesList"></tbody>
              </table>
            </div>
            <div id="loadingFacilities" class="text-center py-12">
              <i class="fas fa-spinner fa-spin text-4xl text-purple-600"></i>
              <p class="text-gray-600 mt-4">시설 데이터를 불러오는 중...</p>
            </div>
          </div>
        </div>
      </div>

      {/* 시설 수정 모달 */}
      <div id="editModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
          <div class="border-b px-6 py-4 flex justify-between items-center">
            <h3 class="text-xl font-bold text-gray-900">
              <i class="fas fa-edit text-blue-600 mr-2"></i>
              시설 정보 수정
            </h3>
            <button onclick="closeEditModal()" class="text-gray-400 hover:text-gray-600 text-2xl">
              <i class="fas fa-times"></i>
            </button>
          </div>
          <div class="p-6">
            <form id="editForm" class="space-y-4">
              <input type="hidden" id="editFacilityId" />
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">시설명 *</label>
                <input type="text" id="editName" required class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500"/>
              </div>
              
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">유형 *</label>
                  <select id="editType" required class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500">
                    <option value="요양병원">요양병원</option>
                    <option value="요양원">요양원</option>
                    <option value="주야간보호">주야간보호</option>
                    <option value="재가복지센터">재가복지센터</option>
                  </select>
                </div>
                
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">전화번호</label>
                  <input type="tel" id="editPhone" placeholder="02-1234-5678" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500"/>
                </div>
              </div>
              
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">시/도 *</label>
                  <select id="editSido" required class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500">
                    <option value="서울특별시">서울특별시</option>
                    <option value="부산광역시">부산광역시</option>
                    <option value="대구광역시">대구광역시</option>
                    <option value="인천광역시">인천광역시</option>
                    <option value="광주광역시">광주광역시</option>
                    <option value="대전광역시">대전광역시</option>
                    <option value="울산광역시">울산광역시</option>
                    <option value="세종특별자치시">세종특별자치시</option>
                    <option value="경기도">경기도</option>
                    <option value="강원도">강원도</option>
                    <option value="충청북도">충청북도</option>
                    <option value="충청남도">충청남도</option>
                    <option value="전라북도">전라북도</option>
                    <option value="전라남도">전라남도</option>
                    <option value="경상북도">경상북도</option>
                    <option value="경상남도">경상남도</option>
                    <option value="제주특별자치도">제주특별자치도</option>
                  </select>
                </div>
                
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">시/군/구 *</label>
                  <select id="editSigungu" required class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500">
                    <option value="">선택하세요</option>
                  </select>
                </div>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">주소 *</label>
                <textarea id="editAddress" required rows="2" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500"></textarea>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">우편번호</label>
                <input type="text" id="editZipcode" placeholder="03001" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500"/>
              </div>
              
              <div class="flex gap-3 pt-4">
                <button type="submit" class="flex-1 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors font-semibold">
                  <i class="fas fa-save mr-2"></i>저장
                </button>
                <button type="button" onclick="closeEditModal()" class="flex-1 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600 transition-colors font-semibold">
                  <i class="fas fa-times mr-2"></i>취소
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
      <script dangerouslySetInnerHTML={{
        __html: `
        let allFacilitiesData = [];
        let filteredFacilitiesData = [];
        
        // 시도별 시군구 데이터
        const sigunguData = {
          '서울특별시': ['강남구', '강동구', '강북구', '강서구', '관악구', '광진구', '구로구', '금천구', '노원구', '도봉구', '동대문구', '동작구', '마포구', '서대문구', '서초구', '성동구', '성북구', '송파구', '양천구', '영등포구', '용산구', '은평구', '종로구', '중구', '중랑구'],
          '부산광역시': ['강서구', '금정구', '기장군', '남구', '동구', '동래구', '부산진구', '북구', '사상구', '사하구', '서구', '수영구', '연제구', '영도구', '중구', '해운대구'],
          '대구광역시': ['남구', '달서구', '달성군', '동구', '북구', '서구', '수성구', '중구'],
          '인천광역시': ['강화군', '계양구', '남동구', '동구', '미추홀구', '부평구', '서구', '연수구', '옹진군', '중구'],
          '광주광역시': ['광산구', '남구', '동구', '북구', '서구'],
          '대전광역시': ['대덕구', '동구', '서구', '유성구', '중구'],
          '울산광역시': ['남구', '동구', '북구', '울주군', '중구'],
          '세종특별자치시': ['세종시'],
          '경기도': ['가평군', '고양시', '과천시', '광명시', '광주시', '구리시', '군포시', '김포시', '남양주시', '동두천시', '부천시', '성남시', '수원시', '시흥시', '안산시', '안성시', '안양시', '양주시', '양평군', '여주시', '연천군', '오산시', '용인시', '의왕시', '의정부시', '이천시', '파주시', '평택시', '포천시', '하남시', '화성시'],
          '강원도': ['강릉시', '고성군', '동해시', '삼척시', '속초시', '양구군', '양양군', '영월군', '원주시', '인제군', '정선군', '철원군', '춘천시', '태백시', '평창군', '홍천군', '화천군', '횡성군'],
          '충청북도': ['괴산군', '단양군', '보은군', '영동군', '옥천군', '음성군', '제천시', '증평군', '진천군', '청주시', '충주시'],
          '충청남도': ['계룡시', '공주시', '금산군', '논산시', '당진시', '보령시', '부여군', '서산시', '서천군', '아산시', '예산군', '천안시', '청양군', '태안군', '홍성군'],
          '전라북도': ['고창군', '군산시', '김제시', '남원시', '무주군', '부안군', '순창군', '완주군', '익산시', '임실군', '장수군', '전주시', '정읍시', '진안군'],
          '전라남도': ['강진군', '고흥군', '곡성군', '광양시', '구례군', '나주시', '담양군', '목포시', '무안군', '보성군', '순천시', '신안군', '여수시', '영광군', '영암군', '완도군', '장성군', '장흥군', '진도군', '함평군', '해남군', '화순군'],
          '경상북도': ['경산시', '경주시', '고령군', '구미시', '군위군', '김천시', '문경시', '봉화군', '상주시', '성주군', '안동시', '영덕군', '영양군', '영주시', '영천시', '예천군', '울릉군', '울진군', '의성군', '청도군', '청송군', '칠곡군', '포항시'],
          '경상남도': ['거제시', '거창군', '고성군', '김해시', '남해군', '밀양시', '사천시', '산청군', '양산시', '의령군', '진주시', '창녕군', '창원시', '통영시', '하동군', '함안군', '함양군', '합천군'],
          '제주특별자치도': ['서귀포시', '제주시']
        };
        
        async function loadFacilities() {
          try {
            const response = await fetch('/static/facilities.json');
            allFacilitiesData = await response.json();
            filteredFacilitiesData = [...allFacilitiesData];
            
            document.getElementById('totalFacilities').textContent = allFacilitiesData.length.toLocaleString();
            document.getElementById('loadingFacilities').style.display = 'none';
            displayFacilities();
          } catch (error) {
            console.error('시설 데이터 로딩 오류:', error);
            document.getElementById('loadingFacilities').innerHTML = \`
              <i class="fas fa-exclamation-circle text-4xl text-red-600"></i>
              <p class="text-gray-600 mt-4">데이터를 불러오는데 실패했습니다</p>
            \`;
          }
        }
        
        // 시도 변경 시 시군구 업데이트
        function updateSigunguOptions() {
          const sidoSelect = document.getElementById('adminFilterSido');
          const sigunguSelect = document.getElementById('adminFilterSigungu');
          const selectedSido = sidoSelect.value;
          
          // 시군구 셀렉트 초기화
          sigunguSelect.innerHTML = '<option value="">전체 시/군/구</option>';
          
          if (selectedSido && sigunguData[selectedSido]) {
            sigunguData[selectedSido].forEach(sigungu => {
              const option = document.createElement('option');
              option.value = sigungu;
              option.textContent = sigungu;
              sigunguSelect.appendChild(option);
            });
          }
        }
        
        function displayFacilities() {
          const listEl = document.getElementById('facilitiesList');
          const countEl = document.getElementById('filteredCount');
          
          countEl.textContent = filteredFacilitiesData.length.toLocaleString();
          
          if (filteredFacilitiesData.length === 0) {
            listEl.innerHTML = '<tr><td colspan="9" class="px-4 py-8 text-center text-gray-500">검색 결과가 없습니다</td></tr>';
            return;
          }
          
          // 최대 100개만 표시
          const displayData = filteredFacilitiesData.slice(0, 100);
          
          listEl.innerHTML = displayData.map(f => {
            const phone = f.phone || '-';
            const phoneDisplay = phone === '-' ? '<span class="text-red-500">미등록</span>' : phone;
            const isRepresentative = f.isRepresentative || false;
            const repBadge = isRepresentative ? '<span class="ml-2 px-2 py-1 bg-purple-100 text-purple-700 text-xs rounded-full font-bold"><i class="fas fa-crown mr-1"></i>대표</span>' : '';
            
            return \`
            <tr class="border-t hover:bg-gray-50">
              <td class="px-4 py-3 text-sm text-gray-600">\${f.id}</td>
              <td class="px-4 py-3 font-medium text-gray-900">\${f.name}\${repBadge}</td>
              <td class="px-4 py-3 text-sm">
                <span class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs">\${f.type}</span>
              </td>
              <td class="px-4 py-3 text-sm text-gray-600">\${f.sido}</td>
              <td class="px-4 py-3 text-sm text-gray-600">\${f.sigungu}</td>
              <td class="px-4 py-3 text-sm">\${phoneDisplay}</td>
              <td class="px-4 py-3 text-sm text-gray-600 max-w-xs truncate" title="\${f.address}">\${f.address}</td>
              <td class="px-4 py-3 text-center">
                <input type="checkbox" \${isRepresentative ? 'checked' : ''} 
                  onchange="toggleRepresentative('\${f.id}', this.checked)"
                  class="w-5 h-5 text-purple-600 border-gray-300 rounded focus:ring-purple-500 cursor-pointer"
                  title="지역별 전화상담에 노출"
                />
              </td>
              <td class="px-4 py-3">
                <div class="flex gap-2">
                  <button onclick="openEditModal('\${f.id}')" class="px-3 py-1 bg-blue-500 text-white text-xs rounded hover:bg-blue-600 transition-colors">
                    <i class="fas fa-edit"></i> 수정
                  </button>
                  <button onclick="deleteFacility('\${f.id}')" class="px-3 py-1 bg-red-500 text-white text-xs rounded hover:bg-red-600 transition-colors">
                    <i class="fas fa-trash"></i> 삭제
                  </button>
                </div>
              </td>
            </tr>
            \`;
          }).join('');
          
          if (filteredFacilitiesData.length > 100) {
            listEl.innerHTML += \`
              <tr>
                <td colspan="9" class="px-4 py-4 text-center bg-yellow-50 text-yellow-800">
                  <i class="fas fa-info-circle mr-2"></i>
                  총 \${filteredFacilitiesData.length.toLocaleString()}개 중 100개만 표시됩니다. 필터를 사용해 결과를 줄여주세요.
                </td>
              </tr>
            \`;
          }
        }
        
        function searchFacilities() {
          const sido = document.getElementById('adminFilterSido').value.trim();
          const sigungu = document.getElementById('adminFilterSigungu').value.trim();
          const type = document.getElementById('adminFilterType').value.trim();
          const keyword = document.getElementById('adminSearchKeyword').value.trim().toLowerCase();
          
          filteredFacilitiesData = allFacilitiesData.filter(f => {
            if (sido && f.sido !== sido) return false;
            if (sigungu && f.sigungu !== sigungu) return false;
            if (type && f.type !== type) return false;
            if (keyword && !f.name.toLowerCase().includes(keyword)) return false;
            return true;
          });
          
          displayFacilities();
        }
        
        function resetFilters() {
          document.getElementById('adminFilterSido').value = '';
          document.getElementById('adminFilterSigungu').value = '';
          document.getElementById('adminFilterType').value = '';
          document.getElementById('adminSearchKeyword').value = '';
          
          // 시군구 옵션 초기화
          document.getElementById('adminFilterSigungu').innerHTML = '<option value="">전체 시/군/구</option>';
          
          filteredFacilitiesData = [...allFacilitiesData];
          displayFacilities();
        }
        
        // 신규 등록 모달 열기
        function openAddModal() {
          // 폼 초기화
          document.getElementById('editForm').reset();
          document.getElementById('editFacilityId').value = '';
          
          // 시군구 초기화
          document.getElementById('editSigungu').innerHTML = '<option value="">선택하세요</option>';
          
          // 모달 제목 변경
          document.querySelector('#editModal h3').innerHTML = '<i class="fas fa-plus text-green-600 mr-2"></i>신규 시설 등록';
          
          // 모달 표시
          document.getElementById('editModal').classList.remove('hidden');
        }
        
        // 수정 모달 열기
        function openEditModal(id) {
          const facility = allFacilitiesData.find(f => f.id === id);
          if (!facility) return;
          
          // 모달 제목 변경
          document.querySelector('#editModal h3').innerHTML = '<i class="fas fa-edit text-blue-600 mr-2"></i>시설 정보 수정';
          
          // 폼에 데이터 채우기
          document.getElementById('editFacilityId').value = facility.id;
          document.getElementById('editName').value = facility.name;
          document.getElementById('editType').value = facility.type;
          document.getElementById('editPhone').value = facility.phone || '';
          document.getElementById('editSido').value = facility.sido;
          document.getElementById('editAddress').value = facility.address;
          document.getElementById('editZipcode').value = facility.zipcode || '';
          
          // 시군구 업데이트
          updateEditSigunguOptions();
          document.getElementById('editSigungu').value = facility.sigungu;
          
          // 모달 표시
          document.getElementById('editModal').classList.remove('hidden');
        }
        
        // 모달 닫기
        function closeEditModal() {
          document.getElementById('editModal').classList.add('hidden');
          document.getElementById('editForm').reset();
        }
        
        // 편집 시도 변경 시 시군구 업데이트
        function updateEditSigunguOptions() {
          const sidoSelect = document.getElementById('editSido');
          const sigunguSelect = document.getElementById('editSigungu');
          const selectedSido = sidoSelect.value;
          
          sigunguSelect.innerHTML = '<option value="">선택하세요</option>';
          
          if (selectedSido && sigunguData[selectedSido]) {
            sigunguData[selectedSido].forEach(sigungu => {
              const option = document.createElement('option');
              option.value = sigungu;
              option.textContent = sigungu;
              sigunguSelect.appendChild(option);
            });
          }
        }
        
        // 대표시설 토글
        async function toggleRepresentative(id, isChecked) {
          const facility = allFacilitiesData.find(f => f.id === id);
          if (!facility) return;
          
          if (isChecked) {
            // 같은 지역의 다른 대표시설이 있는지 확인
            const existingRep = allFacilitiesData.find(f => 
              f.id !== id && 
              f.sido === facility.sido && 
              f.sigungu === facility.sigungu && 
              f.isRepresentative
            );
            
            if (existingRep) {
              if (!confirm(\`\${facility.sido} \${facility.sigungu} 지역에 이미 대표시설 "\${existingRep.name}"이(가) 지정되어 있습니다.\\n\\n기존 대표시설을 해제하고 "\${facility.name}"을(를) 새로운 대표시설로 지정하시겠습니까?\`)) {
                // 체크박스 원복
                event.target.checked = false;
                return;
              }
              // 기존 대표시설 해제
              existingRep.isRepresentative = false;
            }
          }
          
          try {
            await axios.post('/api/admin/facility/set-representative', {
              id: id,
              isRepresentative: isChecked
            });
            
            facility.isRepresentative = isChecked;
            alert(isChecked ? '대표시설로 지정되었습니다.' : '대표시설 지정이 해제되었습니다.');
            displayFacilities();
          } catch (error) {
            console.error('대표시설 설정 실패:', error);
            alert('대표시설 설정 중 오류가 발생했습니다.');
            // 체크박스 원복
            event.target.checked = !isChecked;
          }
        }
        
        // 시설 삭제
        async function deleteFacility(id) {
          const facility = allFacilitiesData.find(f => f.id === id);
          if (!facility) return;
          
          if (!confirm(\`"\${facility.name}" 시설을 삭제하시겠습니까?\\n\\n삭제된 데이터는 복구할 수 없습니다.\`)) {
            return;
          }
          
          try {
            await axios.post('/api/admin/facility/delete', { id: id });
            
            // 로컬 데이터에서 제거
            const index = allFacilitiesData.findIndex(f => f.id === id);
            if (index !== -1) {
              allFacilitiesData.splice(index, 1);
              filteredFacilitiesData = filteredFacilitiesData.filter(f => f.id !== id);
            }
            
            alert('시설이 삭제되었습니다.');
            displayFacilities();
          } catch (error) {
            console.error('삭제 실패:', error);
            alert('삭제 중 오류가 발생했습니다.');
          }
        }
        
        // 편집 폼 제출
        document.getElementById('editForm').addEventListener('submit', async (e) => {
          e.preventDefault();
          
          const id = document.getElementById('editFacilityId').value;
          const isNew = !id || id === '';
          
          const updatedData = {
            id: id,
            name: document.getElementById('editName').value,
            type: document.getElementById('editType').value,
            phone: document.getElementById('editPhone').value,
            sido: document.getElementById('editSido').value,
            sigungu: document.getElementById('editSigungu').value,
            address: document.getElementById('editAddress').value,
            zipcode: document.getElementById('editZipcode').value
          };
          
          try {
            if (isNew) {
              // 신규 등록
              await axios.post('/api/admin/facility/create', updatedData);
              
              // 로컬 데이터에 추가
              const newId = String(Math.max(...allFacilitiesData.map(f => parseInt(f.id) || 0)) + 1);
              updatedData.id = newId;
              updatedData.lat = 0.0;
              updatedData.lng = 0.0;
              updatedData.isRepresentative = false;
              
              allFacilitiesData.push(updatedData);
              filteredFacilitiesData.push(updatedData);
              
              alert('새로운 시설이 등록되었습니다.');
            } else {
              // 기존 시설 수정
              await axios.post('/api/admin/facility/update', updatedData);
              
              // 로컬 데이터 업데이트
              const facility = allFacilitiesData.find(f => f.id === id);
              if (facility) {
                Object.assign(facility, updatedData);
              }
              
              alert('시설 정보가 업데이트되었습니다.');
            }
            
            closeEditModal();
            displayFacilities();
          } catch (error) {
            console.error('저장 실패:', error);
            alert('저장 중 오류가 발생했습니다.');
          }
        });
        
        // 편집 모달의 시도 변경 이벤트
        document.getElementById('editSido').addEventListener('change', updateEditSigunguOptions);
        
        // 시도 선택 변경 시 시군구 업데이트
        document.getElementById('adminFilterSido').addEventListener('change', updateSigunguOptions);
        
        document.getElementById('searchFacilitiesBtn').addEventListener('click', searchFacilities);
        document.getElementById('resetFacilitiesBtn').addEventListener('click', resetFilters);
        document.getElementById('adminSearchKeyword').addEventListener('keypress', (e) => {
          if (e.key === 'Enter') searchFacilities();
        });
        
        document.getElementById('logoutBtn').addEventListener('click', async () => {
          try {
            await axios.post('/api/admin/logout');
            window.location.href = '/admin';
          } catch (error) {
            console.error('로그아웃 실패:', error);
          }
        });
        
        loadFacilities();
        `
      }} />
    </div>
  )
})

// 관리자 대시보드
app.get('/admin/dashboard', (c) => {
  if (!isAdmin(c)) {
    return c.redirect('/admin')
  }
  
  return c.render(
    <div class="min-h-screen bg-gray-100">
      <header class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="flex justify-between items-center h-16">
            <div class="flex items-center">
              <i class="fas fa-shield-alt text-2xl text-gray-900 mr-3"></i>
              <h1 class="text-2xl font-bold text-gray-900">케어조아 관리자</h1>
            </div>
            <div class="flex items-center gap-3">
              <a href="/" class="text-gray-600 hover:text-gray-900 px-4 py-2 rounded-lg hover:bg-gray-100">
                <i class="fas fa-home mr-1"></i>대시보드
              </a>
              <a href="/admin/facilities" class="text-gray-600 hover:text-gray-900 px-4 py-2 rounded-lg hover:bg-gray-100">
                <i class="fas fa-building mr-1"></i>시설 관리
              </a>
              <button id="logoutBtn" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700">
                <i class="fas fa-sign-out-alt mr-2"></i>로그아웃
              </button>
            </div>
          </div>
        </div>
      </header>

      <div class="max-w-7xl mx-auto px-4 py-8">
        {/* 통계 카드 */}
        <div class="grid md:grid-cols-2 gap-6 mb-8">
          <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-blue-500">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-gray-500 text-sm mb-1">파트너 신청</p>
                <p class="text-3xl font-bold text-gray-900" id="partnerCount">0</p>
              </div>
              <div class="bg-blue-100 p-4 rounded-full">
                <i class="fas fa-handshake text-3xl text-blue-600"></i>
              </div>
            </div>
          </div>

          <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-green-500">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-gray-500 text-sm mb-1">가족 간병 신청</p>
                <p class="text-3xl font-bold text-gray-900" id="familyCareCount">0</p>
              </div>
              <div class="bg-green-100 p-4 rounded-full">
                <i class="fas fa-heart text-3xl text-green-600"></i>
              </div>
            </div>
          </div>
        </div>

        {/* 파트너 신청 목록 */}
        <div class="bg-white rounded-xl shadow-lg mb-6">
          <div class="border-b px-6 py-4">
            <h3 class="text-xl font-bold flex items-center">
              <i class="fas fa-handshake text-blue-600 mr-2"></i>
              파트너 신청 목록
              <span class="ml-3 text-sm text-gray-500">(지역별 요양시설 상담센터 신청관리)</span>
            </h3>
          </div>
          <div class="p-6">
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead class="bg-gray-50">
                  <tr class="border-b">
                    <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">순번</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">시설명</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">유형</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">시설 주소</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">담당자</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">연락처</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">지역 설정</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">상태</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">신청일</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">관리</th>
                  </tr>
                </thead>
                <tbody id="partnerList"></tbody>
              </table>
            </div>
          </div>
        </div>

        {/* 가족 간병 신청 목록 */}
        <div class="bg-white rounded-xl shadow-lg">
          <div class="border-b px-6 py-4">
            <h3 class="text-xl font-bold flex items-center">
              <i class="fas fa-heart text-green-600 mr-2"></i>
              가족 간병 신청 목록
            </h3>
          </div>
          <div class="p-6">
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead class="bg-gray-50">
                  <tr class="border-b">
                    <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">보호자</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">연락처</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">환자명</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">나이</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">지역</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">요청사항</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">신청일</th>
                  </tr>
                </thead>
                <tbody id="familyCareList"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <script dangerouslySetInnerHTML={{
        __html: `
        async function loadData() {
          try {
            const response = await axios.get('/api/admin/data');
            const { partners, familyCare, quoteRequests } = response.data;
            
            document.getElementById('partnerCount').textContent = partners.length;
            document.getElementById('familyCareCount').textContent = familyCare.length;
            document.getElementById('quoteRequestCount').textContent = quoteRequests ? quoteRequests.length : 0;
            
            const partnerList = document.getElementById('partnerList');
            partnerList.innerHTML = partners.map((p, index) => {
              const status = p.approvalStatus || 'pending';
              const statusText = status === 'approved' ? '승인됨' : status === 'rejected' ? '거부됨' : '대기중';
              const statusColor = status === 'approved' ? 'bg-green-100 text-green-700' : status === 'rejected' ? 'bg-red-100 text-red-700' : 'bg-yellow-100 text-yellow-700';
              const fullAddress = [p.facilitySido, p.facilitySigungu, p.facilityDetailAddress].filter(Boolean).join(' ') || '-';
              const location = p.facilitySido && p.facilitySigungu ? \`\${p.facilitySido} \${p.facilitySigungu}\` : '-';
              const createdDate = p.createdAt ? new Date(p.createdAt).toLocaleDateString('ko-KR', { year: 'numeric', month: '2-digit', day: '2-digit' }) : '-';
              const isRepresentative = p.isRepresentative || false;
              const repBadge = isRepresentative ? '<span class="ml-2 px-2 py-1 bg-purple-100 text-purple-700 text-xs rounded-full font-bold"><i class="fas fa-crown mr-1"></i>대표샵</span>' : '';
              
              return \`
              <tr class="border-t hover:bg-gray-50">
                <td class="px-4 py-3 text-center text-gray-700">\${index + 1}</td>
                <td class="px-4 py-3 font-medium text-gray-900">\${p.facilityName}\${repBadge}</td>
                <td class="px-4 py-3 text-sm text-gray-600">\${p.facilityType}</td>
                <td class="px-4 py-3 text-sm text-gray-600">\${fullAddress}</td>
                <td class="px-4 py-3 text-gray-700">\${p.managerName}</td>
                <td class="px-4 py-3 text-gray-700">\${p.managerPhone}</td>
                <td class="px-4 py-3 text-sm text-gray-600">\${location}</td>
                <td class="px-4 py-3">
                  <span class="inline-flex px-3 py-1 rounded-full text-xs font-semibold \${statusColor}">
                    \${statusText}
                  </span>
                </td>
                <td class="px-4 py-3 text-sm text-gray-600">\${createdDate}</td>
                <td class="px-4 py-3">
                  <div class="flex gap-2 flex-wrap">
                    \${status === 'pending' ? \`
                      <button onclick="approvePartner(\${index})" class="px-3 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 transition-colors">
                        <i class="fas fa-check"></i> 승인
                      </button>
                      <button onclick="rejectPartner(\${index})" class="px-3 py-1 bg-red-500 text-white text-xs rounded hover:bg-red-600 transition-colors">
                        <i class="fas fa-times"></i> 거부
                      </button>
                    \` : ''}
                    \${status === 'approved' ? \`
                      <button onclick="setRepresentative(\${index})" class="px-3 py-1 \${isRepresentative ? 'bg-gray-400' : 'bg-purple-500'} text-white text-xs rounded hover:bg-purple-600 transition-colors" title="\${isRepresentative ? '대표샵 해제' : '지역 대표샵으로 지정'}">
                        <i class="fas fa-crown"></i> \${isRepresentative ? '대표해제' : '대표지정'}
                      </button>
                    \` : ''}
                  </div>
                </td>
              </tr>
              \`;
            }).join('') || '<tr><td colspan="10" class="px-4 py-8 text-center text-gray-500">신청 내역이 없습니다</td></tr>';
            
            const familyCareList = document.getElementById('familyCareList');
            familyCareList.innerHTML = familyCare.map(f => \`
              <tr class="border-t hover:bg-gray-50">
                <td class="px-4 py-3">\${f.guardianName}</td>
                <td class="px-4 py-3">\${f.guardianPhone}</td>
                <td class="px-4 py-3">\${f.patientName}</td>
                <td class="px-4 py-3">\${f.patientAge}세</td>
                <td class="px-4 py-3">\${f.region}</td>
                <td class="px-4 py-3">\${f.requirements || '-'}</td>
                <td class="px-4 py-3">\${new Date(f.createdAt).toLocaleDateString('ko-KR')}</td>
              </tr>
            \`).join('') || '<tr><td colspan="7" class="px-4 py-8 text-center text-gray-500">신청 내역이 없습니다</td></tr>';
          } catch (error) {
            console.error('데이터 로드 실패:', error);
          }
        }
        
        async function approvePartner(index) {
          try {
            await axios.post('/api/admin/partner/approve', { index });
            alert('승인되었습니다.');
            loadData();
          } catch (error) {
            console.error('승인 실패:', error);
            alert('승인 처리 중 오류가 발생했습니다.');
          }
        }
        
        async function rejectPartner(index) {
          const reason = prompt('거부 사유를 입력하세요:');
          if (!reason) return;
          
          try {
            await axios.post('/api/admin/partner/reject', { index, reason });
            alert('거부되었습니다.');
            loadData();
          } catch (error) {
            console.error('거부 실패:', error);
            alert('거부 처리 중 오류가 발생했습니다.');
          }
        }
        
        async function setRepresentative(index) {
          try {
            const response = await axios.get('/api/admin/data');
            const partner = response.data.partners[index];
            const isCurrentlyRep = partner.isRepresentative || false;
            
            const confirmMsg = isCurrentlyRep 
              ? \`"\${partner.facilityName}"의 대표샵 지정을 해제하시겠습니까?\`
              : \`"\${partner.facilityName}"을(를) \${partner.facilitySido} \${partner.facilitySigungu} 지역의 대표 상담센터로 지정하시겠습니까?\n\n대표샵으로 지정되면 해당 지역 전화상담 시 최우선으로 노출됩니다.\`;
            
            if (!confirm(confirmMsg)) return;
            
            await axios.post('/api/admin/partner/set-representative', { 
              index, 
              isRepresentative: !isCurrentlyRep 
            });
            
            alert(isCurrentlyRep ? '대표샵 지정이 해제되었습니다.' : '대표샵으로 지정되었습니다.');
            loadData();
          } catch (error) {
            console.error('대표샵 설정 실패:', error);
            alert('대표샵 설정 중 오류가 발생했습니다.');
          }
        }
        
        document.getElementById('logoutBtn').addEventListener('click', async () => {
          try {
            await axios.post('/api/admin/logout');
            window.location.href = '/admin';
          } catch (error) {
            console.error('로그아웃 실패:', error);
          }
        });
        
        loadData();
        setInterval(loadData, 30000);
        `
      }} />
    </div>
  )
})

// API 라우트
app.post('/api/partner', async (c) => {
  try {
    const data = await c.req.json()
    dataStore.partners.push({
      ...data,
      createdAt: new Date().toISOString()
    })
    return c.json({ success: true, message: '파트너 등록이 완료되었습니다!' })
  } catch (error) {
    return c.json({ success: false, message: '등록 실패' }, 500)
  }
})

app.post('/api/family-care', async (c) => {
  try {
    const data = await c.req.json()
    dataStore.familyCare.push({
      ...data,
      createdAt: new Date().toISOString()
    })
    return c.json({ success: true, message: '가족 간병 신청이 완료되었습니다!' })
  } catch (error) {
    return c.json({ success: false, message: '신청 실패' }, 500)
  }
})

// 견적 요청 API (기존)
app.post('/api/quote-request', async (c) => {
  try {
    const data = await c.req.json()
    
    // 견적 요청 저장
    const quoteRequest = {
      ...data,
      id: 'Q' + Date.now(),
      status: 'pending',
      createdAt: new Date().toISOString()
    }
    
    dataStore.quoteRequests.push(quoteRequest)
    
    // TODO: 여기서 선택한 지역(sido, sigungu)의 시설에게만 견적 요청 전송
    // 현재는 메모리에 저장만 하고, 실제 D1 DB 연동 시 구현 예정
    
    return c.json({ 
      success: true, 
      message: '견적 신청이 완료되었습니다!',
      quoteId: quoteRequest.id
    })
  } catch (error) {
    console.error('Quote request error:', error)
    return c.json({ success: false, message: '견적 신청 실패' }, 500)
  }
})

// 새로운 다단계 견적 신청 API
app.post('/api/quote/submit-new', async (c) => {
  try {
    const data = await c.req.json()
    
    // 견적 요청 ID 생성
    const quoteId = 'QN' + Date.now()
    
    // 견적 요청 객체 생성
    const quoteRequest = {
      id: quoteId,
      facilityType: data.facilityType,
      patientName: data.patientName,
      age: data.age,
      gender: data.gender,
      sido: data.sido,
      sigungu: data.sigungu,
      
      // 요양병원 전용 필드
      birthYear: data.birthYear || null,
      birthMonth: data.birthMonth || null,
      birthDay: data.birthDay || null,
      patientGender: data.patientGender || null,
      careLevel: data.careLevel || null,
      beneficiaryType: data.beneficiaryType || null,
      diagnosis: data.diagnosis || [],
      adl: data.adl || null,
      dementia: data.dementia || null,
      
      // 재가복지 전용 필드
      serviceType: data.serviceType || null,
      homecareLevel: data.homecareLevel || null,
      weeklyHours: data.weeklyHours || null,
      
      // 보호자 정보
      guardianAge: data.guardianAge || null,
      spouseAge: data.spouseAge || null,
      guardianPhone: data.guardianPhone || null,
      housingType: data.housingType || null,
      
      // 추가 정보
      diseases: data.diseases || [],
      personalities: data.personalities || [],
      specialNotes: data.specialNotes || '',
      
      // 메타데이터
      status: 'pending', // pending, matched, completed, cancelled
      matchedFacilities: [], // 매칭된 시설 목록
      receivedQuotes: [], // 받은 견적서 목록
      createdAt: new Date().toISOString(),
      updatedAt: new Date().toISOString()
    }
    
    // 메모리에 저장
    dataStore.quoteRequests.push(quoteRequest)
    
    // TODO: D1 Database에 영구 저장
    // await DB.prepare(\`
    //   INSERT INTO quote_requests (id, facility_type, patient_name, ...) 
    //   VALUES (?, ?, ?, ...)
    // \`).bind(...).run()
    
    // TODO: 해당 지역의 시설들에게 알림 전송
    // 1. facilities.json에서 해당 지역 시설 필터링
    // 2. 시설 대시보드에 새 견적 요청 표시
    // 3. 이메일/SMS 알림 (optional)
    
    console.log('New quote request:', quoteId, data.facilityType, data.sido, data.sigungu)
    
    return c.json({ 
      success: true, 
      message: '견적 신청이 완료되었습니다! 선택하신 지역의 시설들이 견적서를 작성하여 회신합니다.',
      quoteId: quoteId,
      estimatedResponse: '24-48시간 이내'
    })
  } catch (error) {
    console.error('Quote submission error:', error)
    return c.json({ 
      success: false, 
      message: '견적 신청 중 오류가 발생했습니다. 다시 시도해주세요.' 
    }, 500)
  }
})

app.post('/api/admin/login', async (c) => {
  try {
    const { password } = await c.req.json()
    const adminPassword = c.env.ADMIN_PASSWORD || '5874' // fallback for local dev
    
    if (password === adminPassword) {
      const sessionId = generateSessionId()
      sessions.add(sessionId)
      setCookie(c, ADMIN_CONFIG.sessionKey, sessionId, {
        httpOnly: true,
        maxAge: 3600
      })
      return c.json({ success: true })
    }
    return c.json({ success: false, message: '비밀번호가 올바르지 않습니다.' }, 401)
  } catch (error) {
    return c.json({ success: false, message: '로그인 실패' }, 500)
  }
})

app.post('/api/admin/logout', (c) => {
  const sessionId = getCookie(c, ADMIN_CONFIG.sessionKey)
  if (sessionId) {
    sessions.delete(sessionId)
  }
  setCookie(c, ADMIN_CONFIG.sessionKey, '', { maxAge: 0 })
  return c.json({ success: true })
})

// 지역별 상담센터 조회 API
app.get('/api/regional-centers', async (c) => {
  const sido = c.req.query('sido')
  const sigungu = c.req.query('sigungu')
  
  if (!sido || !sigungu) {
    return c.json({ error: 'Missing parameters' }, 400)
  }
  
  try {
    // 시설 데이터 로드 (메모리 캐시 사용)
    await loadFacilities()
    
    // 해당 지역의 대표시설만 필터링
    const representativeFacilities = dataStore.facilities
      .filter(f => 
        f.isRepresentative === true &&
        f.sido === sido && 
        f.sigungu === sigungu &&
        f.phone && f.phone !== ''  // 전화번호가 있는 시설만
      )
      .slice(0, 4) // 최대 4개
    
    // 대표시설이 있으면 그것을 반환
    if (representativeFacilities.length > 0) {
      const centers = representativeFacilities.map(f => ({
        facilityName: f.name,
        facilityType: f.type,
        facilitySido: f.sido,
        facilitySigungu: f.sigungu,
        managerName: '상담 담당자',
        managerPhone: f.phone,
        isRepresentative: true
      }))
      
      return c.json({ 
        centers: centers,
        count: centers.length
      })
    }
    
    // 대표시설이 없으면 기존 로직 (partners에서 가져오기)
    const regionalCenters = dataStore.partners
      .filter(partner => 
        partner.approvalStatus === 'approved' && 
        partner.facilitySido === sido && 
        partner.facilitySigungu === sigungu
      )
      .slice(0, 4)
    
    return c.json({ 
      centers: regionalCenters,
      count: regionalCenters.length
    })
  } catch (error) {
    console.error('대표시설 조회 오류:', error)
    return c.json({ centers: [], count: 0 })
  }
})

app.get('/api/admin/data', (c) => {
  if (!isAdmin(c)) {
    return c.json({ error: 'Unauthorized' }, 401)
  }
  return c.json(dataStore)
})

// 파트너 승인 API
app.post('/api/admin/partner/approve', async (c) => {
  if (!isAdmin(c)) {
    return c.json({ error: 'Unauthorized' }, 401)
  }
  
  try {
    const { index } = await c.req.json()
    if (dataStore.partners[index]) {
      dataStore.partners[index].approvalStatus = 'approved'
      dataStore.partners[index].approvalDate = new Date().toISOString()
    }
    return c.json({ success: true, message: '승인되었습니다.' })
  } catch (error) {
    return c.json({ success: false, message: '승인 처리 실패' }, 500)
  }
})

// 파트너 거부 API
app.post('/api/admin/partner/reject', async (c) => {
  if (!isAdmin(c)) {
    return c.json({ error: 'Unauthorized' }, 401)
  }
  
  try {
    const { index, reason } = await c.req.json()
    if (dataStore.partners[index]) {
      dataStore.partners[index].approvalStatus = 'rejected'
      dataStore.partners[index].rejectionReason = reason
      dataStore.partners[index].approvalDate = new Date().toISOString()
    }
    return c.json({ success: true, message: '거부되었습니다.' })
  } catch (error) {
    return c.json({ success: false, message: '거부 처리 실패' }, 500)
  }
})

// 파트너 대표샵 지정 API
app.post('/api/admin/partner/set-representative', async (c) => {
  if (!isAdmin(c)) {
    return c.json({ error: 'Unauthorized' }, 401)
  }
  
  try {
    const { index, isRepresentative } = await c.req.json()
    const partner = dataStore.partners[index]
    
    if (!partner) {
      return c.json({ success: false, message: '파트너를 찾을 수 없습니다.' }, 404)
    }
    
    if (partner.approvalStatus !== 'approved') {
      return c.json({ success: false, message: '승인된 파트너만 대표샵으로 지정할 수 있습니다.' }, 400)
    }
    
    // 같은 지역의 다른 대표샵 해제
    if (isRepresentative) {
      dataStore.partners.forEach((p, i) => {
        if (i !== index && 
            p.facilitySido === partner.facilitySido && 
            p.facilitySigungu === partner.facilitySigungu && 
            p.isRepresentative) {
          p.isRepresentative = false
        }
      })
    }
    
    partner.isRepresentative = isRepresentative
    partner.representativeDate = isRepresentative ? new Date().toISOString() : null
    
    return c.json({ 
      success: true, 
      message: isRepresentative ? '대표샵으로 지정되었습니다.' : '대표샵 지정이 해제되었습니다.' 
    })
  } catch (error) {
    return c.json({ success: false, message: '대표샵 설정 실패' }, 500)
  }
})

// 시설 데이터 로드 함수
async function loadFacilities() {
  if (!dataStore.facilitiesLoaded) {
    try {
      const response = await fetch('https://3000-i9rvbxi0ydi8a2ltypzm7-cbeee0f9.sandbox.novita.ai/static/facilities.json')
      dataStore.facilities = await response.json()
      dataStore.facilitiesLoaded = true
      console.log(`Loaded ${dataStore.facilities.length} facilities`)
    } catch (error) {
      console.error('Failed to load facilities:', error)
    }
  }
}

// 시설 정보 업데이트 API
app.post('/api/admin/facility/update', async (c) => {
  if (!isAdmin(c)) {
    return c.json({ error: 'Unauthorized' }, 401)
  }
  
  try {
    const data = await c.req.json()
    
    // 시설 데이터 로드
    await loadFacilities()
    
    // 시설 찾기
    const facility = dataStore.facilities.find((f: any) => f.id === data.id)
    if (!facility) {
      return c.json({ success: false, message: '시설을 찾을 수 없습니다.' }, 404)
    }
    
    // 시설 정보 업데이트 (기존 lat, lng, isRepresentative는 유지)
    facility.name = data.name
    facility.type = data.type
    facility.phone = data.phone || ''
    facility.sido = data.sido
    facility.sigungu = data.sigungu
    facility.address = data.address
    facility.zipcode = data.zipcode || ''
    
    return c.json({ 
      success: true, 
      message: '시설 정보가 업데이트되었습니다. (메모리 업데이트)',
      facility: facility,
      note: '서버 재시작 시 초기화됩니다. 영구 저장을 위해서는 D1 Database가 필요합니다.'
    })
  } catch (error) {
    console.error('시설 업데이트 오류:', error)
    return c.json({ success: false, message: '시설 정보 업데이트 실패' }, 500)
  }
})

// 시설 대표시설 지정 API
app.post('/api/admin/facility/set-representative', async (c) => {
  if (!isAdmin(c)) {
    return c.json({ error: 'Unauthorized' }, 401)
  }
  
  try {
    const { id, isRepresentative } = await c.req.json()
    
    // 시설 데이터 로드
    await loadFacilities()
    
    // 대상 시설 찾기
    const targetFacility = dataStore.facilities.find((f: any) => f.id === id)
    if (!targetFacility) {
      return c.json({ success: false, message: '시설을 찾을 수 없습니다.' }, 404)
    }
    
    // 대표시설 지정 시, 같은 지역의 다른 대표시설 해제
    if (isRepresentative) {
      dataStore.facilities.forEach((f: any) => {
        if (f.id !== id && 
            f.sido === targetFacility.sido && 
            f.sigungu === targetFacility.sigungu && 
            f.isRepresentative) {
          f.isRepresentative = false
        }
      })
    }
    
    // 대상 시설의 대표시설 상태 변경
    targetFacility.isRepresentative = isRepresentative
    
    return c.json({ 
      success: true, 
      message: isRepresentative ? '대표시설로 지정되었습니다. (메모리 업데이트)' : '대표시설 지정이 해제되었습니다. (메모리 업데이트)',
      note: '서버 재시작 시 초기화됩니다.'
    })
  } catch (error) {
    console.error('대표시설 설정 오류:', error)
    return c.json({ success: false, message: '대표시설 설정 실패' }, 500)
  }
})

// 신규 시설 등록 API
app.post('/api/admin/facility/create', async (c) => {
  if (!isAdmin(c)) {
    return c.json({ error: 'Unauthorized' }, 401)
  }
  
  try {
    const data = await c.req.json()
    
    // 시설 데이터 로드
    await loadFacilities()
    
    // 새로운 ID 생성
    const maxId = Math.max(...dataStore.facilities.map((f: any) => parseInt(f.id) || 0))
    const newId = String(maxId + 1)
    
    // 새 시설 객체 생성
    const newFacility = {
      id: newId,
      name: data.name,
      type: data.type,
      phone: data.phone || '',
      sido: data.sido,
      sigungu: data.sigungu,
      address: data.address,
      zipcode: data.zipcode || '',
      lat: 0.0,
      lng: 0.0,
      isRepresentative: false
    }
    
    // 배열에 추가
    dataStore.facilities.push(newFacility)
    
    return c.json({ 
      success: true, 
      message: '새로운 시설이 등록되었습니다. (메모리 업데이트)',
      facility: newFacility,
      note: '서버 재시작 시 초기화됩니다. 영구 저장을 위해서는 D1 Database가 필요합니다.'
    })
  } catch (error) {
    console.error('시설 등록 오류:', error)
    return c.json({ success: false, message: '시설 등록 실패' }, 500)
  }
})

// 시설 삭제 API
app.post('/api/admin/facility/delete', async (c) => {
  if (!isAdmin(c)) {
    return c.json({ error: 'Unauthorized' }, 401)
  }
  
  try {
    const { id } = await c.req.json()
    
    // 시설 데이터 로드
    await loadFacilities()
    
    // 시설 찾기
    const index = dataStore.facilities.findIndex((f: any) => f.id === id)
    if (index === -1) {
      return c.json({ success: false, message: '시설을 찾을 수 없습니다.' }, 404)
    }
    
    // 시설 제거
    const deletedFacility = dataStore.facilities.splice(index, 1)[0]
    
    return c.json({ 
      success: true, 
      message: '시설이 삭제되었습니다. (메모리 업데이트)',
      deleted: deletedFacility,
      note: '서버 재시작 시 초기화됩니다. 영구 저장을 위해서는 D1 Database가 필요합니다.'
    })
  } catch (error) {
    console.error('시설 삭제 오류:', error)
    return c.json({ success: false, message: '시설 삭제 실패' }, 500)
  }
})

// 실시간 견적 플랫폼 페이지
app.get('/quote-request', (c) => {
  return c.render(
    <div class="min-h-screen bg-gradient-to-br from-teal-50 via-white to-blue-50">
      {/* 헤더 */}
      <header class="bg-white shadow-md border-b-2 border-teal-500">
        <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="flex justify-between items-center h-16">
            <div class="flex items-center">
              <a href="/" class="flex items-center hover:opacity-80 transition">
                <img 
                  src="https://page.gensparksite.com/v1/base64_upload/b39dca8586af1dacd6d8417554313896" 
                  alt="케어조아 로고"
                  class="h-10 w-auto mr-3"
                />
                <h1 class="text-2xl font-bold text-teal-600">케어조아</h1>
              </a>
            </div>
            <a href="/" class="text-gray-600 hover:text-teal-600 transition font-medium">
              <i class="fas fa-home mr-2"></i>홈으로
            </a>
          </div>
        </div>
      </header>

      <div class="max-w-7xl mx-auto px-4 py-8">
        {/* 타이틀 */}
        <div class="text-center mb-8">
          <h2 class="text-4xl font-bold text-gray-900 mb-4">
            <i class="fas fa-calculator text-teal-600 mr-3"></i>
            실시간 요양 견적
          </h2>
          <p class="text-xl text-gray-600">
            3가지 방법으로 빠르고 정확한 견적을 받아보세요
          </p>
        </div>

        {/* 탭 네비게이션 */}
        <div class="flex justify-center mb-8 border-b border-gray-200">
          <button 
            id="tab-urgent" 
            class="tab-btn px-8 py-4 text-lg font-semibold border-b-4 border-teal-600 text-teal-600"
            onclick="switchTab('urgent')"
          >
            <i class="fas fa-bolt mr-2"></i>급한 견적 신청
          </button>
          <button 
            id="tab-calculate" 
            class="tab-btn px-8 py-4 text-lg font-semibold text-gray-500 hover:text-gray-700"
            onclick="switchTab('calculate')"
          >
            <i class="fas fa-calculator mr-2"></i>자가 견적 계산
          </button>
          <button 
            id="tab-matching" 
            class="tab-btn px-8 py-4 text-lg font-semibold text-gray-500 hover:text-gray-700"
            onclick="switchTab('matching')"
          >
            <i class="fas fa-robot mr-2"></i>AI 스마트 매칭
          </button>
        </div>

        {/* 탭 1: 급한 견적 신청 */}
        <div id="content-urgent" class="tab-content">
          <div class="bg-white rounded-xl shadow-lg p-8 max-w-4xl mx-auto">
            <div class="bg-gradient-to-r from-red-50 to-orange-50 border border-red-200 rounded-lg p-4 mb-6">
              <h3 class="text-lg font-bold text-red-800 mb-2">
                <i class="fas fa-bolt mr-2"></i>급한 견적 신청이란?
              </h3>
              <p class="text-red-700">
                간단한 정보만 입력하면 <strong>선택하신 지역의 모든 등록 시설</strong>에 자동으로 견적 요청이 전송됩니다. 
                시설들이 직접 견적서를 작성하여 회신하면 비교하실 수 있습니다.
              </p>
            </div>

            <form id="urgentForm" class="space-y-6">
              {/* 고객 정보 */}
              <div class="border-b pb-6">
                <h4 class="text-xl font-bold mb-4">
                  <i class="fas fa-user mr-2 text-teal-600"></i>고객 정보
                </h4>
                <div class="grid md:grid-cols-2 gap-4">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">보호자 성함 *</label>
                    <input type="text" name="customer_name" required
                      class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500" />
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">연락처 *</label>
                    <input type="tel" name="customer_phone" required placeholder="010-1234-5678"
                      class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500" />
                  </div>
                  <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-2">이메일 (선택)</label>
                    <input type="email" name="customer_email"
                      class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500" />
                  </div>
                </div>
              </div>

              {/* 환자 정보 */}
              <div class="border-b pb-6">
                <h4 class="text-xl font-bold mb-4">
                  <i class="fas fa-hospital-user mr-2 text-teal-600"></i>환자 정보
                </h4>
                <div class="grid md:grid-cols-2 gap-4">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">환자 성함 *</label>
                    <input type="text" name="patient_name" required
                      class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500" />
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">나이 *</label>
                    <input type="number" name="patient_age" required min="1" max="120"
                      class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500" />
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">성별</label>
                    <select name="patient_gender" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                      <option value="">선택</option>
                      <option value="남성">남성</option>
                      <option value="여성">여성</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">장기요양등급</label>
                    <select name="care_level" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                      <option value="">선택</option>
                      <option value="1등급">1등급</option>
                      <option value="2등급">2등급</option>
                      <option value="3등급">3등급</option>
                      <option value="4등급">4등급</option>
                      <option value="5등급">5등급</option>
                      <option value="인지지원등급">인지지원등급</option>
                    </select>
                  </div>
                  <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-2">환자 상태 (상세하게 작성해주세요)</label>
                    <textarea name="patient_condition" rows="3" placeholder="예: 거동 가능 여부, 주요 질환, 특이사항 등"
                      class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500"></textarea>
                  </div>
                </div>
              </div>

              {/* 희망 시설 */}
              <div class="border-b pb-6">
                <h4 class="text-xl font-bold mb-4">
                  <i class="fas fa-building mr-2 text-teal-600"></i>희망 시설 정보
                </h4>
                <div class="grid md:grid-cols-2 gap-4">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">시/도 *</label>
                    <select name="sido" id="urgent-sido" required 
                      class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                      <option value="">선택</option>
                      <option value="서울특별시">서울특별시</option>
                      <option value="경기도">경기도</option>
                      <option value="인천광역시">인천광역시</option>
                      <option value="부산광역시">부산광역시</option>
                      <option value="대구광역시">대구광역시</option>
                      <option value="대전광역시">대전광역시</option>
                      <option value="광주광역시">광주광역시</option>
                      <option value="울산광역시">울산광역시</option>
                      <option value="세종특별자치시">세종특별자치시</option>
                      <option value="강원도">강원도</option>
                      <option value="충청북도">충청북도</option>
                      <option value="충청남도">충청남도</option>
                      <option value="전라북도">전라북도</option>
                      <option value="전라남도">전라남도</option>
                      <option value="경상북도">경상북도</option>
                      <option value="경상남도">경상남도</option>
                      <option value="제주특별자치도">제주특별자치도</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">시/군/구 *</label>
                    <select name="sigungu" id="urgent-sigungu" required
                      class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                      <option value="">시/도를 먼저 선택해주세요</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">시설 유형 *</label>
                    <select name="facility_type" required
                      class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                      <option value="">선택</option>
                      <option value="요양병원">요양병원</option>
                      <option value="요양원">요양원</option>
                      <option value="주야간보호">주야간보호</option>
                      <option value="재가복지센터">재가복지센터</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">희망 병실</label>
                    <select name="room_type" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                      <option value="">선택</option>
                      <option value="1인실">1인실</option>
                      <option value="2인실">2인실</option>
                      <option value="3인실">3인실</option>
                      <option value="4인실이상">4인실 이상</option>
                    </select>
                  </div>
                </div>
              </div>

              {/* 예산 */}
              <div class="border-b pb-6">
                <h4 class="text-xl font-bold mb-4">
                  <i class="fas fa-won-sign mr-2 text-teal-600"></i>예산 (선택)
                </h4>
                <div class="grid md:grid-cols-2 gap-4">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">최소 예산 (월)</label>
                    <input type="number" name="budget_min" placeholder="1000000" step="100000"
                      class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500" />
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">최대 예산 (월)</label>
                    <input type="number" name="budget_max" placeholder="3000000" step="100000"
                      class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500" />
                  </div>
                </div>
              </div>

              {/* 기타 요구사항 */}
              <div>
                <h4 class="text-xl font-bold mb-4">
                  <i class="fas fa-clipboard-list mr-2 text-teal-600"></i>기타 요구사항
                </h4>
                <textarea name="special_requirements" rows="4" 
                  placeholder="특별히 원하시는 사항이나 문의사항을 자유롭게 작성해주세요"
                  class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500"></textarea>
              </div>

              {/* 제출 버튼 */}
              <div class="flex justify-center pt-6">
                <button type="submit" 
                  class="bg-gradient-to-r from-teal-500 to-teal-600 text-white px-12 py-4 rounded-xl text-lg font-bold hover:from-teal-600 hover:to-teal-700 shadow-lg transform hover:scale-105 transition-all">
                  <i class="fas fa-paper-plane mr-2"></i>
                  모든 시설에 견적 요청하기
                </button>
              </div>
            </form>
          </div>
        </div>

        {/* 탭 2: 자가 견적 계산 */}
        <div id="content-calculate" class="tab-content hidden">
          <div class="bg-white rounded-xl shadow-lg p-8 max-w-4xl mx-auto">
            <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-4 mb-6">
              <h3 class="text-lg font-bold text-blue-800 mb-2">
                <i class="fas fa-calculator mr-2"></i>자가 견적 계산이란?
              </h3>
              <p class="text-blue-700">
                조건을 입력하시면 <strong>예상 비용을 즉시 계산</strong>해드립니다. 
                대략적인 비용을 먼저 확인하신 후 정식 견적을 요청하실 수 있습니다.
              </p>
            </div>

            {/* 계산기 폼 */}
            <form id="calculateForm" class="space-y-6">
              <div class="grid md:grid-cols-2 gap-6">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">장기요양등급 *</label>
                  <select name="care_level" id="calc-care-level" required
                    class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                    <option value="">선택</option>
                    <option value="1">1등급</option>
                    <option value="2">2등급</option>
                    <option value="3">3등급</option>
                    <option value="4">4등급</option>
                    <option value="5">5등급</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">시설 유형 *</label>
                  <select name="facility_type" id="calc-facility-type" required
                    class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                    <option value="">선택</option>
                    <option value="요양병원">요양병원</option>
                    <option value="요양원">요양원</option>
                    <option value="주야간보호">주야간보호</option>
                    <option value="재가복지센터">재가복지센터</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">병실 유형 *</label>
                  <select name="room_type" id="calc-room-type" required
                    class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                    <option value="">선택</option>
                    <option value="1인실">1인실</option>
                    <option value="2인실">2인실</option>
                    <option value="3인실">3인실</option>
                    <option value="4인실이상">4인실 이상</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">지역 *</label>
                  <select name="region" id="calc-region" required
                    class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                    <option value="">선택</option>
                    <option value="서울">서울</option>
                    <option value="경기">경기</option>
                    <option value="인천">인천</option>
                    <option value="기타">기타 지역</option>
                  </select>
                </div>
              </div>

              <div class="flex justify-center">
                <button type="submit" 
                  class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-10 py-3 rounded-xl text-lg font-bold hover:from-blue-600 hover:to-blue-700 shadow-lg">
                  <i class="fas fa-calculator mr-2"></i>
                  예상 비용 계산하기
                </button>
              </div>
            </form>

            {/* 계산 결과 */}
            <div id="calculateResult" class="hidden mt-8 p-6 bg-gradient-to-r from-green-50 to-teal-50 rounded-xl border-2 border-green-200">
              <h3 class="text-2xl font-bold text-green-800 mb-4">
                <i class="fas fa-check-circle mr-2"></i>예상 비용 계산 완료
              </h3>
              <div class="space-y-3">
                <div class="flex justify-between text-lg">
                  <span class="font-medium">기본 비용 (월):</span>
                  <span id="result-basic" class="font-bold text-blue-600"></span>
                </div>
                <div class="flex justify-between text-lg">
                  <span class="font-medium">식사비 (월):</span>
                  <span id="result-meal" class="font-bold text-blue-600"></span>
                </div>
                <div class="flex justify-between text-lg">
                  <span class="font-medium">간호비 (월):</span>
                  <span id="result-nursing" class="font-bold text-blue-600"></span>
                </div>
                <div class="flex justify-between text-lg border-t-2 border-green-300 pt-3">
                  <span class="font-bold text-xl">예상 총액 (월):</span>
                  <span id="result-total" class="font-bold text-2xl text-green-700"></span>
                </div>
              </div>
              <div class="mt-6 bg-white p-4 rounded-lg">
                <p class="text-sm text-gray-600 mb-3">
                  <i class="fas fa-info-circle text-blue-500 mr-1"></i>
                  이 비용은 평균적인 예상 금액이며, 실제 시설마다 차이가 있을 수 있습니다.
                </p>
                <button onclick="requestQuoteFromCalculator()" 
                  class="w-full bg-teal-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-teal-700">
                  정확한 견적 요청하기
                </button>
              </div>
            </div>
          </div>
        </div>

        {/* 탭 3: AI 매칭 */}
        <div id="content-matching" class="tab-content hidden">
          <div class="bg-white rounded-xl shadow-lg p-8 max-w-4xl mx-auto">
            <div class="bg-gradient-to-r from-purple-50 to-pink-50 border border-purple-200 rounded-lg p-4 mb-6">
              <h3 class="text-lg font-bold text-purple-800 mb-2">
                <i class="fas fa-robot mr-2"></i>AI 스마트 매칭이란?
              </h3>
              <p class="text-purple-700">
                입력하신 조건을 AI가 분석하여 <strong>가장 적합한 시설 TOP 10</strong>을 추천해드립니다. 
                추천된 시설에만 선택적으로 견적을 요청하실 수 있습니다.
              </p>
            </div>

            {/* AI 매칭 폼 */}
            <form id="matchingForm" class="space-y-6">
              {/* 기본 정보 */}
              <div class="grid md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">장기요양등급 *</label>
                  <select name="care_level" required
                    class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500">
                    <option value="">선택</option>
                    <option value="1">1등급</option>
                    <option value="2">2등급</option>
                    <option value="3">3등급</option>
                    <option value="4">4등급</option>
                    <option value="5">5등급</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">환자 나이 *</label>
                  <input type="number" name="patient_age" required min="1" max="120"
                    class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500" />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">시/도 *</label>
                  <select name="sido" id="matching-sido" required
                    class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500">
                      <option value="">선택</option>
                      <option value="서울특별시">서울특별시</option>
                      <option value="경기도">경기도</option>
                      <option value="인천광역시">인천광역시</option>
                    </select>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">시/군/구 *</label>
                  <select name="sigungu" id="matching-sigungu" required
                    class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500">
                    <option value="">시/도를 먼저 선택해주세요</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">월 예산 *</label>
                  <input type="number" name="budget" required placeholder="2000000" step="100000"
                    class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500" />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">병실 선호</label>
                  <select name="room_type"
                    class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500">
                    <option value="">상관없음</option>
                    <option value="1인실">1인실</option>
                    <option value="2인실">2인실</option>
                    <option value="3인실">3인실</option>
                    <option value="4인실이상">4인실 이상</option>
                  </select>
                </div>
              </div>

              {/* 중요 요소 선택 */}
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">중요하게 생각하는 요소 (복수 선택 가능)</label>
                <div class="grid md:grid-cols-3 gap-3">
                  <label class="flex items-center p-3 border rounded-lg hover:bg-purple-50 cursor-pointer">
                    <input type="checkbox" name="priorities[]" value="거리" class="mr-2" />
                    <span>집과의 거리</span>
                  </label>
                  <label class="flex items-center p-3 border rounded-lg hover:bg-purple-50 cursor-pointer">
                    <input type="checkbox" name="priorities[]" value="비용" class="mr-2" />
                    <span>저렴한 비용</span>
                  </label>
                  <label class="flex items-center p-3 border rounded-lg hover:bg-purple-50 cursor-pointer">
                    <input type="checkbox" name="priorities[]" value="시설" class="mr-2" />
                    <span>시설 설비</span>
                  </label>
                  <label class="flex items-center p-3 border rounded-lg hover:bg-purple-50 cursor-pointer">
                    <input type="checkbox" name="priorities[]" value="의료" class="mr-2" />
                    <span>의료 서비스</span>
                  </label>
                  <label class="flex items-center p-3 border rounded-lg hover:bg-purple-50 cursor-pointer">
                    <input type="checkbox" name="priorities[]" value="평판" class="mr-2" />
                    <span>평판/후기</span>
                  </label>
                  <label class="flex items-center p-3 border rounded-lg hover:bg-purple-50 cursor-pointer">
                    <input type="checkbox" name="priorities[]" value="규모" class="mr-2" />
                    <span>시설 규모</span>
                  </label>
                </div>
              </div>

              <div class="flex justify-center">
                <button type="submit" 
                  class="bg-gradient-to-r from-purple-500 to-pink-600 text-white px-10 py-3 rounded-xl text-lg font-bold hover:from-purple-600 hover:to-pink-700 shadow-lg">
                  <i class="fas fa-magic mr-2"></i>
                  AI 추천 받기
                </button>
              </div>
            </form>

            {/* AI 매칭 결과 */}
            <div id="matchingResult" class="hidden mt-8">
              <h3 class="text-2xl font-bold text-purple-800 mb-6 flex items-center">
                <i class="fas fa-star mr-3 text-yellow-500"></i>
                맞춤 추천 시설 TOP 10
              </h3>
              <div id="matchingList" class="space-y-4">
                {/* 동적으로 채워짐 */}
              </div>
              <div class="mt-6 text-center">
                <button onclick="requestQuoteFromMatching()" 
                  class="bg-teal-600 text-white px-10 py-3 rounded-xl font-bold hover:bg-teal-700">
                  선택한 시설에 견적 요청하기
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* JavaScript */}
      <script dangerouslySetInnerHTML={{__html: `
        // 탭 전환
        function switchTab(tabName) {
          // 모든 탭 버튼 비활성화
          document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.classList.remove('border-teal-600', 'text-teal-600');
            btn.classList.add('text-gray-500', 'border-transparent');
          });
          
          // 선택된 탭 활성화
          document.getElementById('tab-' + tabName).classList.add('border-teal-600', 'text-teal-600');
          document.getElementById('tab-' + tabName).classList.remove('text-gray-500', 'border-transparent');
          
          // 모든 콘텐츠 숨기기
          document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.add('hidden');
          });
          
          // 선택된 콘텐츠 표시
          document.getElementById('content-' + tabName).classList.remove('hidden');
        }

        // 시군구 데이터
        const sigunguData = {
          "서울특별시": ["강남구", "강동구", "강북구", "강서구", "관악구", "광진구", "구로구", "금천구", "노원구", "도봉구", "동대문구", "동작구", "마포구", "서대문구", "서초구", "성동구", "성북구", "송파구", "양천구", "영등포구", "용산구", "은평구", "종로구", "중구", "중랑구"],
          "경기도": ["고양시", "과천시", "광명시", "광주시", "구리시", "군포시", "김포시", "남양주시", "동두천시", "부천시", "성남시", "수원시", "시흥시", "안산시", "안성시", "안양시", "양주시", "여주시", "오산시", "용인시", "의왕시", "의정부시", "이천시", "파주시", "평택시", "포천시", "하남시", "화성시"],
          "인천광역시": ["강화군", "계양구", "남동구", "동구", "미추홀구", "부평구", "서구", "연수구", "옹진군", "중구"]
        };

        // 시도 선택 시 시군구 업데이트
        document.getElementById('urgent-sido').addEventListener('change', function() {
          updateSigungu('urgent-sigungu', this.value);
        });

        document.getElementById('matching-sido').addEventListener('change', function() {
          updateSigungu('matching-sigungu', this.value);
        });

        function updateSigungu(selectId, sido) {
          const sigunguSelect = document.getElementById(selectId);
          sigunguSelect.innerHTML = '<option value="">선택</option>';
          
          if (sigunguData[sido]) {
            sigunguData[sido].forEach(sigungu => {
              const option = document.createElement('option');
              option.value = sigungu;
              option.textContent = sigungu;
              sigunguSelect.appendChild(option);
            });
          }
        }

        // 폼 제출 처리
        document.getElementById('urgentForm').addEventListener('submit', async function(e) {
          e.preventDefault();
          
          const formData = new FormData(this);
          const data = Object.fromEntries(formData.entries());
          data.request_type = 'urgent';
          
          try {
            const response = await axios.post('/api/quote-request', data);
            if (response.data.success) {
              alert('견적 요청이 완료되었습니다! 해당 지역 ' + response.data.sent_count + '개 시설에 전송되었습니다.');
              this.reset();
            }
          } catch (error) {
            console.error('요청 실패:', error);
            alert('견적 요청에 실패했습니다. 다시 시도해주세요.');
          }
        });

        document.getElementById('calculateForm').addEventListener('submit', async function(e) {
          e.preventDefault();
          
          const formData = new FormData(this);
          const data = Object.fromEntries(formData.entries());
          
          try {
            const response = await axios.post('/api/calculate-cost', data);
            if (response.data.success) {
              document.getElementById('result-basic').textContent = response.data.basic.toLocaleString() + '원';
              document.getElementById('result-meal').textContent = response.data.meal.toLocaleString() + '원';
              document.getElementById('result-nursing').textContent = response.data.nursing.toLocaleString() + '원';
              document.getElementById('result-total').textContent = response.data.total.toLocaleString() + '원';
              document.getElementById('calculateResult').classList.remove('hidden');
            }
          } catch (error) {
            console.error('계산 실패:', error);
            alert('계산에 실패했습니다. 다시 시도해주세요.');
          }
        });

        document.getElementById('matchingForm').addEventListener('submit', async function(e) {
          e.preventDefault();
          
          const formData = new FormData(this);
          const data = Object.fromEntries(formData.entries());
          data.request_type = 'ai_matching';
          
          // 우선순위 배열 처리
          const priorities = [];
          document.querySelectorAll('input[name="priorities[]"]:checked').forEach(el => {
            priorities.push(el.value);
          });
          data.priorities = JSON.stringify(priorities);
          
          try {
            const response = await axios.post('/api/ai-matching', data);
            if (response.data.success) {
              displayMatchingResults(response.data.facilities);
              document.getElementById('matchingResult').classList.remove('hidden');
            }
          } catch (error) {
            console.error('매칭 실패:', error);
            alert('AI 매칭에 실패했습니다. 다시 시도해주세요.');
          }
        });

        function displayMatchingResults(facilities) {
          const listEl = document.getElementById('matchingList');
          listEl.innerHTML = facilities.map((facility, index) => \`
            <div class="border-2 border-purple-200 rounded-lg p-4 hover:shadow-lg transition-shadow">
              <div class="flex items-center justify-between mb-2">
                <div class="flex items-center">
                  <span class="bg-gradient-to-r from-yellow-400 to-orange-500 text-white font-bold text-lg w-10 h-10 rounded-full flex items-center justify-center mr-3">
                    \${index + 1}
                  </span>
                  <div>
                    <h4 class="text-lg font-bold">\${facility.name}</h4>
                    <p class="text-sm text-gray-600">\${facility.address}</p>
                  </div>
                </div>
                <div class="text-right">
                  <p class="text-sm text-gray-600">매칭 점수</p>
                  <p class="text-2xl font-bold text-purple-600">\${facility.score}%</p>
                </div>
              </div>
              <div class="flex gap-2 mb-2">
                <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">\${facility.type}</span>
                <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">예상: \${facility.estimated_cost.toLocaleString()}원/월</span>
              </div>
              <label class="flex items-center mt-3">
                <input type="checkbox" class="facility-select mr-2" value="\${facility.id}" checked />
                <span class="text-sm">이 시설에 견적 요청</span>
              </label>
            </div>
          \`).join('');
        }

        function requestQuoteFromCalculator() {
          // 계산 결과에서 견적 요청으로 전환
          switchTab('urgent');
          window.scrollTo(0, 0);
        }

        function requestQuoteFromMatching() {
          const selectedFacilities = [];
          document.querySelectorAll('.facility-select:checked').forEach(el => {
            selectedFacilities.push(el.value);
          });
          
          if (selectedFacilities.length === 0) {
            alert('최소 1개 이상의 시설을 선택해주세요.');
            return;
          }
          
          alert(selectedFacilities.length + '개 시설에 견적 요청이 완료되었습니다!');
        }
      `}} />
    </div>
  )
})

// 자가 견적 계산 API
app.post('/api/calculate-cost', async (c) => {
  try {
    const data = await c.req.json()
    
    // 간단한 견적 계산 로직
    const careLevel = parseInt(data.care_level)
    const facilityType = data.facility_type
    const roomType = data.room_type
    const region = data.region
    
    // 기본료 (등급별)
    const basicCost = {
      1: 1800000,
      2: 1600000,
      3: 1400000,
      4: 1200000,
      5: 1000000
    }[careLevel] || 1000000
    
    // 시설 유형별 추가
    const facilityExtra = {
      '요양병원': 500000,
      '요양원': 200000,
      '주야간보호': -300000,
      '재가복지센터': -400000
    }[facilityType] || 0
    
    // 병실 유형별 추가
    const roomExtra = {
      '1인실': 500000,
      '2인실': 200000,
      '3인실': 0,
      '4인실이상': -100000
    }[roomType] || 0
    
    // 지역별 추가
    const regionExtra = {
      '서울': 300000,
      '경기': 100000,
      '인천': 50000,
      '기타': 0
    }[region] || 0
    
    const basic = basicCost + facilityExtra + roomExtra + regionExtra
    const meal = 300000
    const nursing = 200000
    const total = basic + meal + nursing
    
    return c.json({
      success: true,
      basic,
      meal,
      nursing,
      total
    })
  } catch (error) {
    return c.json({ success: false, message: '계산 실패' }, 500)
  }
})

// AI 매칭 API
app.post('/api/ai-matching', async (c) => {
  try {
    const data = await c.req.json()
    
    // TODO: 실제 AI 매칭 로직 구현
    // 임시로 더미 데이터 반환
    const dummyFacilities = [
      {
        id: 1,
        name: '서울 요양병원',
        address: '서울특별시 강남구',
        type: '요양병원',
        score: 95,
        estimated_cost: 2500000
      },
      {
        id: 2,
        name: '행복 요양원',
        address: '서울특별시 서초구',
        type: '요양원',
        score: 92,
        estimated_cost: 2200000
      },
      {
        id: 3,
        name: '사랑 재가복지센터',
        address: '서울특별시 송파구',
        type: '재가복지센터',
        score: 88,
        estimated_cost: 1800000
      }
    ]
    
    return c.json({
      success: true,
      facilities: dummyFacilities
    })
  } catch (error) {
    return c.json({ success: false, message: '매칭 실패' }, 500)
  }
})

// 간편견적 페이지
app.get('/quote-simple', (c) => {
  return c.render(
    <div class="min-h-screen bg-gray-50">
      <header class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 py-4">
          <div class="flex justify-between items-center">
            <a href="/" class="flex items-center">
              <img 
                src="https://page.gensparksite.com/v1/base64_upload/b39dca8586af1dacd6d8417554313896" 
                alt="케어조아 로고"
                class="h-8 mr-3"
              />
              <h1 class="text-2xl font-bold text-teal-600">케어조아</h1>
            </a>
            <a href="/" class="text-gray-600 hover:text-gray-900">
              <i class="fas fa-home mr-2"></i>홈으로
            </a>
          </div>
        </div>
      </header>

      <div class="container mx-auto px-4 py-8 max-w-2xl">
        <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
          <h1 class="text-2xl font-bold text-gray-800 mb-2">
            <i class="fas fa-calculator text-blue-600 mr-2"></i>
            간편견적 신청
          </h1>
          <p class="text-gray-600">5분 이내 빠른 견적 신청 (필수 정보만 입력)</p>
          <div class="mt-4 flex gap-3">
            <a href="/quote-simple" class="px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold">
              간편견적
            </a>
            <a href="/quote-request" class="px-4 py-2 border-2 border-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-50">
              상세견적
            </a>
          </div>
        </div>

        <form id="simpleQuoteForm" class="bg-white rounded-lg shadow-sm p-6 space-y-6">
          {/* 지역 선택 */}
          <div>
            <label class="block text-sm font-bold text-gray-700 mb-2">
              <i class="fas fa-map-marker-alt text-red-500 mr-1"></i>
              지역 선택 <span class="text-red-500">*</span>
            </label>
            <div class="grid grid-cols-2 gap-4">
              <select id="sido" name="sido" required class="w-full px-4 py-2 border rounded-lg">
                <option value="">시/도 선택</option>
                <option value="서울특별시">서울특별시</option>
                <option value="부산광역시">부산광역시</option>
                <option value="대구광역시">대구광역시</option>
                <option value="인천광역시">인천광역시</option>
                <option value="광주광역시">광주광역시</option>
                <option value="대전광역시">대전광역시</option>
                <option value="울산광역시">울산광역시</option>
                <option value="세종특별자치시">세종특별자치시</option>
                <option value="경기도">경기도</option>
                <option value="강원도">강원도</option>
                <option value="충청북도">충청북도</option>
                <option value="충청남도">충청남도</option>
                <option value="전라북도">전라북도</option>
                <option value="전라남도">전라남도</option>
                <option value="경상북도">경상북도</option>
                <option value="경상남도">경상남도</option>
                <option value="제주특별자치도">제주특별자치도</option>
              </select>
              <select id="sigungu" name="sigungu" required class="w-full px-4 py-2 border rounded-lg">
                <option value="">시/군/구 선택</option>
              </select>
            </div>
          </div>

          {/* 시설 종류 */}
          <div>
            <label class="block text-sm font-bold text-gray-700 mb-2">
              <i class="fas fa-building text-blue-500 mr-1"></i>
              이용 희망 시설 <span class="text-red-500">*</span>
            </label>
            <div class="grid grid-cols-2 gap-3">
              <label class="flex items-center p-4 border-2 rounded-lg cursor-pointer hover:border-blue-500">
                <input type="radio" name="facilityType" value="요양원" required class="mr-3" />
                <div>
                  <div class="font-semibold">요양원</div>
                  <div class="text-xs text-gray-500">24시간 입소</div>
                </div>
              </label>
              <label class="flex items-center p-4 border-2 rounded-lg cursor-pointer hover:border-blue-500">
                <input type="radio" name="facilityType" value="요양병원" required class="mr-3" />
                <div>
                  <div class="font-semibold">요양병원</div>
                  <div class="text-xs text-gray-500">의료 집중</div>
                </div>
              </label>
              <label class="flex items-center p-4 border-2 rounded-lg cursor-pointer hover:border-blue-500">
                <input type="radio" name="facilityType" value="주야간보호센터" required class="mr-3" />
                <div>
                  <div class="font-semibold">주야간보호</div>
                  <div class="text-xs text-gray-500">낮/밤 단기</div>
                </div>
              </label>
              <label class="flex items-center p-4 border-2 rounded-lg cursor-pointer hover:border-blue-500">
                <input type="radio" name="facilityType" value="재가복지센터" required class="mr-3" />
                <div>
                  <div class="font-semibold">재가복지</div>
                  <div class="text-xs text-gray-500">방문 요양</div>
                </div>
              </label>
            </div>
          </div>

          {/* 신청자 정보 */}
          <div>
            <label class="block text-sm font-bold text-gray-700 mb-2">
              <i class="fas fa-user text-green-500 mr-1"></i>
              신청자 성함 <span class="text-red-500">*</span>
            </label>
            <input type="text" name="applicantName" required placeholder="홍길동"
              class="w-full px-4 py-2 border rounded-lg" />
          </div>

          <div>
            <label class="block text-sm font-bold text-gray-700 mb-2">
              <i class="fas fa-phone text-green-500 mr-1"></i>
              연락처 <span class="text-red-500">*</span>
            </label>
            <input type="tel" name="phone" required placeholder="010-0000-0000"
              class="w-full px-4 py-2 border rounded-lg" />
          </div>

          {/* 돌봄 대상자 */}
          <div>
            <label class="block text-sm font-bold text-gray-700 mb-2">
              <i class="fas fa-heart text-red-500 mr-1"></i>
              돌봄 대상자
            </label>
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-xs text-gray-600 mb-1">성별</label>
                <select name="patientGender" class="w-full px-4 py-2 border rounded-lg">
                  <option value="">선택</option>
                  <option value="남">남</option>
                  <option value="여">여</option>
                </select>
              </div>
              <div>
                <label class="block text-xs text-gray-600 mb-1">연령대</label>
                <select name="patientAge" class="w-full px-4 py-2 border rounded-lg">
                  <option value="">선택</option>
                  <option value="60대">60대</option>
                  <option value="70대">70대</option>
                  <option value="80대">80대</option>
                  <option value="90대 이상">90대 이상</option>
                </select>
              </div>
            </div>
          </div>

          {/* 장기요양등급 */}
          <div>
            <label class="block text-sm font-bold text-gray-700 mb-2">
              <i class="fas fa-certificate text-purple-500 mr-1"></i>
              장기요양등급
            </label>
            <select name="careGrade" class="w-full px-4 py-2 border rounded-lg">
              <option value="">등급 선택 (선택사항)</option>
              <option value="1등급">1등급 (95점 이상)</option>
              <option value="2등급">2등급 (75-94점)</option>
              <option value="3등급">3등급 (60-74점)</option>
              <option value="4등급">4등급 (51-59점)</option>
              <option value="5등급">5등급 (45-50점)</option>
              <option value="인지지원등급">인지지원등급</option>
              <option value="등급신청예정">등급신청예정</option>
            </select>
          </div>

          {/* 간단한 요청사항 */}
          <div>
            <label class="block text-sm font-bold text-gray-700 mb-2">
              <i class="fas fa-comment text-yellow-500 mr-1"></i>
              간단한 요청사항
            </label>
            <textarea name="additionalNotes" rows="3"
              placeholder="예: 치매 증상 있음, 식사 보조 필요 등"
              class="w-full px-4 py-2 border rounded-lg resize-none"></textarea>
          </div>

          {/* 개인정보 동의 */}
          <div>
            <label class="flex items-start">
              <input type="checkbox" name="privacyAgree" required class="mt-1 mr-2" />
              <span class="text-sm text-gray-600">
                개인정보 수집 및 이용에 동의합니다. (필수)
              </span>
            </label>
          </div>

          {/* 제출 버튼 */}
          <div class="flex gap-3">
            <button type="submit"
              class="flex-1 bg-blue-600 text-white py-4 rounded-lg font-bold hover:bg-blue-700">
              <i class="fas fa-paper-plane mr-2"></i>
              견적 신청하기
            </button>
          </div>
        </form>

        <div class="mt-6 bg-blue-50 border-l-4 border-blue-500 p-4 rounded">
          <p class="text-sm text-blue-700">
            <i class="fas fa-info-circle mr-2"></i>
            <strong>견적 신청 후</strong> 선택하신 지역의 등록된 시설에서 견적서를 받으실 수 있습니다.
          </p>
        </div>
      </div>

      <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
      <script dangerouslySetInnerHTML={{
        __html: `
        const sigunguData = {
          '서울특별시': ['강남구', '강동구', '강북구', '강서구', '관악구', '광진구', '구로구', '금천구', '노원구', '도봉구', '동대문구', '동작구', '마포구', '서대문구', '서초구', '성동구', '성북구', '송파구', '양천구', '영등포구', '용산구', '은평구', '종로구', '중구', '중랑구'],
          '부산광역시': ['강서구', '금정구', '기장군', '남구', '동구', '동래구', '부산진구', '북구', '사상구', '사하구', '서구', '수영구', '연제구', '영도구', '중구', '해운대구'],
          '대구광역시': ['남구', '달서구', '달성군', '동구', '북구', '서구', '수성구', '중구'],
          '인천광역시': ['강화군', '계양구', '남동구', '동구', '미추홀구', '부평구', '서구', '연수구', '옹진군', '중구'],
          '광주광역시': ['광산구', '남구', '동구', '북구', '서구'],
          '대전광역시': ['대덕구', '동구', '서구', '유성구', '중구'],
          '울산광역시': ['남구', '동구', '북구', '울주군', '중구'],
          '세종특별자치시': ['세종시'],
          '경기도': ['가평군', '고양시', '과천시', '광명시', '광주시', '구리시', '군포시', '김포시', '남양주시', '동두천시', '부천시', '성남시', '수원시', '시흥시', '안산시', '안성시', '안양시', '양주시', '양평군', '여주시', '연천군', '오산시', '용인시', '의왕시', '의정부시', '이천시', '파주시', '평택시', '포천시', '하남시', '화성시'],
          '강원도': ['강릉시', '고성군', '동해시', '삼척시', '속초시', '양구군', '양양군', '영월군', '원주시', '인제군', '정선군', '철원군', '춘천시', '태백시', '평창군', '홍천군', '화천군', '횡성군'],
          '충청북도': ['괴산군', '단양군', '보은군', '영동군', '옥천군', '음성군', '제천시', '증평군', '진천군', '청주시', '충주시'],
          '충청남도': ['계룡시', '공주시', '금산군', '논산시', '당진시', '보령시', '부여군', '서산시', '서천군', '아산시', '예산군', '천안시', '청양군', '태안군', '홍성군'],
          '전라북도': ['고창군', '군산시', '김제시', '남원시', '무주군', '부안군', '순창군', '완주군', '익산시', '임실군', '장수군', '전주시', '정읍시', '진안군'],
          '전라남도': ['강진군', '고흥군', '곡성군', '광양시', '구례군', '나주시', '담양군', '목포시', '무안군', '보성군', '순천시', '신안군', '여수시', '영광군', '영암군', '완도군', '장성군', '장흥군', '진도군', '함평군', '해남군', '화순군'],
          '경상북도': ['경산시', '경주시', '고령군', '구미시', '군위군', '김천시', '문경시', '봉화군', '상주시', '성주군', '안동시', '영덕군', '영양군', '영주시', '영천시', '예천군', '울릉군', '울진군', '의성군', '청도군', '청송군', '칠곡군', '포항시'],
          '경상남도': ['거제시', '거창군', '고성군', '김해시', '남해군', '밀양시', '사천시', '산청군', '양산시', '의령군', '진주시', '창녕군', '창원시', '통영시', '하동군', '함안군', '함양군', '합천군'],
          '제주특별자치도': ['서귀포시', '제주시']
        };

        document.getElementById('sido').addEventListener('change', function() {
          const sido = this.value;
          const sigunguSelect = document.getElementById('sigungu');
          sigunguSelect.innerHTML = '<option value="">시/군/구 선택</option>';
          if (sido && sigunguData[sido]) {
            sigunguData[sido].forEach(sigungu => {
              const option = document.createElement('option');
              option.value = sigungu;
              option.textContent = sigungu;
              sigunguSelect.appendChild(option);
            });
          }
        });

        document.getElementById('simpleQuoteForm').addEventListener('submit', async function(e) {
          e.preventDefault();
          const formData = new FormData(this);
          const data = Object.fromEntries(formData.entries());
          
          try {
            const response = await axios.post('/api/quote-request', {
              ...data,
              quoteType: 'simple',
              createdAt: new Date().toISOString()
            });
            
            if (response.data.success) {
              alert('✅ 견적 신청이 완료되었습니다!\\n\\n선택하신 지역의 시설에서 곧 연락드릴 예정입니다.');
              window.location.href = '/';
            }
          } catch (error) {
            console.error('Error:', error);
            alert('❌ 견적 신청 중 오류가 발생했습니다. 다시 시도해주세요.');
          }
        });
        `
      }} />
    </div>
  )
})

// 새로운 다단계 견적 신청 페이지
app.get('/quote-new', (c) => {
  return c.render(
    <div class="min-h-screen bg-gray-50">
      {/* 헤더 */}
      <header class="bg-white shadow-sm border-b">
        <div class="max-w-4xl mx-auto px-4 py-4">
          <div class="flex justify-between items-center">
            <div class="flex items-center">
              <img 
                src="https://page.gensparksite.com/v1/base64_upload/b39dca8586af1dacd6d8417554313896" 
                alt="케어조아 로고"
                class="h-8 w-auto mr-3"
              />
              <h1 class="text-xl font-bold text-teal-600">케어조아</h1>
            </div>
            <a href="/" class="text-sm text-gray-600 hover:text-gray-900">
              <i class="fas fa-times"></i>
            </a>
          </div>
        </div>
      </header>

      {/* 프로그레스 바 */}
      <div class="bg-white border-b">
        <div class="max-w-4xl mx-auto px-4 py-4">
          <div class="flex items-center justify-between mb-2">
            <div class="flex-1">
              <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
                <div id="progressBar" class="h-full bg-teal-500 transition-all duration-300" style="width: 14%"></div>
              </div>
            </div>
          </div>
          <div class="flex justify-between text-xs text-gray-600">
            <span id="stepIndicator">1/7 단계</span>
            <span id="stepTitle">견적서 전체 선택</span>
          </div>
        </div>
      </div>

      {/* 메인 컨텐츠 */}
      <div class="max-w-4xl mx-auto px-4 py-8">
        <div class="bg-white rounded-xl shadow-lg p-6 md:p-8">
          
          {/* Step 1: 견적서 전체 선택 */}
          <div id="step1" class="step-content">
            <h2 class="text-2xl font-bold text-gray-900 mb-2">견적서 전체 선택</h2>
            <p class="text-sm text-gray-600 mb-6">
              계속 진행할 견적서를 선택하세요<br/>
              견적을 진행한 시설은 내시설목록에서 삭제되지 않습니다
            </p>
            
            <div class="space-y-3">
              <button type="button" onclick="selectFacilityType('nursing_hospital')" 
                class="w-full p-4 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-left transition-all">
                <div class="flex items-center">
                  <div class="w-6 h-6 rounded-full border-2 border-gray-400 mr-3 facility-radio" data-type="nursing_hospital"></div>
                  <span class="font-medium text-gray-900">요양병원</span>
                </div>
              </button>
              
              <button type="button" onclick="selectFacilityType('home_care')" 
                class="w-full p-4 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-left transition-all">
                <div class="flex items-center">
                  <div class="w-6 h-6 rounded-full border-2 border-gray-400 mr-3 facility-radio" data-type="home_care"></div>
                  <span class="font-medium text-gray-900">재가복지 (방문요양/주야간보호)</span>
                </div>
              </button>
            </div>
          </div>

          {/* Step 2: 신청 정보 입력 */}
          <div id="step2" class="step-content hidden">
            <h2 class="text-2xl font-bold text-gray-900 mb-2">신청 정보 입력</h2>
            <p class="text-sm text-gray-600 mb-6">신청자의 기본 정보를 입력해주세요</p>
            
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">1. 성함 (어르신 성함)</label>
                <input type="text" id="patientName" required
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500" />
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">2. 연령대</label>
                <div class="grid grid-cols-3 gap-3">
                  <button type="button" onclick="selectAge('60대 이상')" 
                    class="age-btn px-4 py-3 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 transition-all">
                    60대 이상
                  </button>
                  <button type="button" onclick="selectAge('70대 이상')" 
                    class="age-btn px-4 py-3 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 transition-all">
                    70대 이상
                  </button>
                  <button type="button" onclick="selectAge('80대 이상')" 
                    class="age-btn px-4 py-3 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 transition-all">
                    80대 이상
                  </button>
                </div>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">3. 성별</label>
                <div class="grid grid-cols-2 gap-3">
                  <button type="button" onclick="selectGender('남성')" 
                    class="gender-btn px-4 py-3 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 transition-all">
                    남성
                  </button>
                  <button type="button" onclick="selectGender('여성')" 
                    class="gender-btn px-4 py-3 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 transition-all">
                    여성
                  </button>
                </div>
              </div>
            </div>
          </div>

          {/* Step 3: 지역 선택 */}
          <div id="step3" class="step-content hidden">
            <h2 class="text-2xl font-bold text-gray-900 mb-2">지역 선택</h2>
            <p class="text-sm text-gray-600 mb-6">희망하시는 시설의 지역을 선택해주세요</p>
            
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">시/도 *</label>
                <select id="quoteNewSido" onchange="updateQuoteNewSigungu()" required
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500">
                  <option value="">선택하세요</option>
                  <option value="서울특별시">서울특별시</option>
                  <option value="경기도">경기도</option>
                  <option value="인천광역시">인천광역시</option>
                  <option value="부산광역시">부산광역시</option>
                  <option value="대구광역시">대구광역시</option>
                  <option value="대전광역시">대전광역시</option>
                  <option value="광주광역시">광주광역시</option>
                  <option value="울산광역시">울산광역시</option>
                  <option value="세종특별자치시">세종특별자치시</option>
                  <option value="강원도">강원도</option>
                  <option value="충청북도">충청북도</option>
                  <option value="충청남도">충청남도</option>
                  <option value="전라북도">전라북도</option>
                  <option value="전라남도">전라남도</option>
                  <option value="경상북도">경상북도</option>
                  <option value="경상남도">경상남도</option>
                  <option value="제주특별자치도">제주특별자치도</option>
                </select>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">시/군/구 *</label>
                <select id="quoteNewSigungu" required
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500">
                  <option value="">먼저 시/도를 선택하세요</option>
                </select>
              </div>
            </div>
          </div>

          {/* Step 4: 환자 정보 상세 (요양병원) */}
          <div id="step4-hospital" class="step-content hidden">
            <h2 class="text-2xl font-bold text-gray-900 mb-2">환자 정보 입력</h2>
            <p class="text-sm text-gray-600 mb-6">환자분의 상세 정보를 입력해주세요</p>
            
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">1. 환자의 생년월일을 알려주세요</label>
                <div class="grid grid-cols-3 gap-3">
                  <input type="number" id="birthYear" placeholder="년도 (예: 1945)" min="1900" max="2024"
                    class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500" />
                  <input type="number" id="birthMonth" placeholder="월 (1-12)" min="1" max="12"
                    class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500" />
                  <input type="number" id="birthDay" placeholder="일 (1-31)" min="1" max="31"
                    class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500" />
                </div>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">2. 환자 성별</label>
                <div class="grid grid-cols-2 gap-3">
                  <button type="button" onclick="selectPatientGender('남성')" 
                    class="patient-gender-btn px-4 py-3 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50">
                    남성
                  </button>
                  <button type="button" onclick="selectPatientGender('여성')" 
                    class="patient-gender-btn px-4 py-3 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50">
                    여성
                  </button>
                </div>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">3. 장기요양등급 (선택사항)</label>
                <div class="grid grid-cols-3 gap-2">
                  <button type="button" onclick="selectCareLevel('1등급')" 
                    class="care-level-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    1등급
                  </button>
                  <button type="button" onclick="selectCareLevel('2등급')" 
                    class="care-level-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    2등급
                  </button>
                  <button type="button" onclick="selectCareLevel('3등급')" 
                    class="care-level-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    3등급
                  </button>
                  <button type="button" onclick="selectCareLevel('4등급')" 
                    class="care-level-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    4등급
                  </button>
                  <button type="button" onclick="selectCareLevel('5등급')" 
                    class="care-level-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    5등급
                  </button>
                  <button type="button" onclick="selectCareLevel('등급없음')" 
                    class="care-level-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    등급없음
                  </button>
                </div>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">4. 수급자 유형 *</label>
                <div class="space-y-2">
                  <button type="button" onclick="selectBeneficiaryType('기초수급자')" 
                    class="w-full beneficiary-type-btn px-4 py-3 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-left">
                    기초수급자
                  </button>
                  <button type="button" onclick="selectBeneficiaryType('차상위계층')" 
                    class="w-full beneficiary-type-btn px-4 py-3 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-left">
                    차상위계층
                  </button>
                  <button type="button" onclick="selectBeneficiaryType('건강보험')" 
                    class="w-full beneficiary-type-btn px-4 py-3 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-left">
                    건강보험
                  </button>
                  <button type="button" onclick="selectBeneficiaryType('일반')" 
                    class="w-full beneficiary-type-btn px-4 py-3 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-left">
                    일반
                  </button>
                </div>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">5. 진단명 (중복선택 가능)</label>
                <div class="grid grid-cols-2 gap-2">
                  <button type="button" onclick="toggleDiagnosis('치매')" 
                    class="diagnosis-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    치매
                  </button>
                  <button type="button" onclick="toggleDiagnosis('중풍')" 
                    class="diagnosis-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    중풍
                  </button>
                  <button type="button" onclick="toggleDiagnosis('암환자')" 
                    class="diagnosis-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    암환자
                  </button>
                  <button type="button" onclick="toggleDiagnosis('당뇨')" 
                    class="diagnosis-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    당뇨
                  </button>
                  <button type="button" onclick="toggleDiagnosis('고혈압')" 
                    class="diagnosis-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    고혈압
                  </button>
                  <button type="button" onclick="toggleDiagnosis('기타')" 
                    class="diagnosis-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    기타
                  </button>
                </div>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">6. ADL (일상생활수행능력)</label>
                <div class="grid grid-cols-3 gap-2">
                  <button type="button" onclick="selectADL('상')" 
                    class="adl-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    상
                  </button>
                  <button type="button" onclick="selectADL('중')" 
                    class="adl-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    중
                  </button>
                  <button type="button" onclick="selectADL('하')" 
                    class="adl-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    하
                  </button>
                </div>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">7. 치매 (인지상태)</label>
                <div class="grid grid-cols-3 gap-2">
                  <button type="button" onclick="selectDementia('경증')" 
                    class="dementia-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    경증
                  </button>
                  <button type="button" onclick="selectDementia('중등도')" 
                    class="dementia-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    중등도
                  </button>
                  <button type="button" onclick="selectDementia('중증')" 
                    class="dementia-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    중증
                  </button>
                </div>
              </div>
            </div>
          </div>

          {/* Step 4: 환자 정보 상세 (재가복지) */}
          <div id="step4-homecare" class="step-content hidden">
            <h2 class="text-2xl font-bold text-gray-900 mb-2">서비스 정보 입력</h2>
            <p class="text-sm text-gray-600 mb-6">필요하신 서비스 정보를 입력해주세요</p>
            
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">1. 서비스 유형 *</label>
                <div class="space-y-2">
                  <button type="button" onclick="selectServiceType('방문요양')" 
                    class="w-full service-type-btn px-4 py-3 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-left">
                    방문요양
                  </button>
                  <button type="button" onclick="selectServiceType('방문목욕')" 
                    class="w-full service-type-btn px-4 py-3 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-left">
                    방문목욕
                  </button>
                  <button type="button" onclick="selectServiceType('주야간보호')" 
                    class="w-full service-type-btn px-4 py-3 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-left">
                    주야간보호
                  </button>
                  <button type="button" onclick="selectServiceType('단기보호')" 
                    class="w-full service-type-btn px-4 py-3 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-left">
                    단기보호
                  </button>
                </div>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">2. 장기요양등급 *</label>
                <div class="grid grid-cols-3 gap-2">
                  <button type="button" onclick="selectHomeCareLevel('1등급')" 
                    class="homecare-level-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    1등급
                  </button>
                  <button type="button" onclick="selectHomeCareLevel('2등급')" 
                    class="homecare-level-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    2등급
                  </button>
                  <button type="button" onclick="selectHomeCareLevel('3등급')" 
                    class="homecare-level-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    3등급
                  </button>
                  <button type="button" onclick="selectHomeCareLevel('4등급')" 
                    class="homecare-level-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    4등급
                  </button>
                  <button type="button" onclick="selectHomeCareLevel('5등급')" 
                    class="homecare-level-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    5등급
                  </button>
                  <button type="button" onclick="selectHomeCareLevel('인지지원등급')" 
                    class="homecare-level-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    인지지원등급
                  </button>
                </div>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">3. 주간 이용 시간</label>
                <select id="weeklyHours" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500">
                  <option value="">선택하세요</option>
                  <option value="주 1회">주 1회</option>
                  <option value="주 2회">주 2회</option>
                  <option value="주 3회">주 3회</option>
                  <option value="주 4회">주 4회</option>
                  <option value="주 5회">주 5회</option>
                  <option value="매일">매일</option>
                </select>
              </div>
            </div>
          </div>

          {/* Step 5: 본인/배우자 정보 */}
          <div id="step5" class="step-content hidden">
            <h2 class="text-2xl font-bold text-gray-900 mb-2">본인/배우자 정보</h2>
            <p class="text-sm text-gray-600 mb-6">보호자의 정보를 입력해주세요</p>
            
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">1. 본인 나이를 선택하세요</label>
                <div class="grid grid-cols-4 gap-2">
                  <button type="button" onclick="selectGuardianAge('30대')" 
                    class="guardian-age-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    30대
                  </button>
                  <button type="button" onclick="selectGuardianAge('40대')" 
                    class="guardian-age-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    40대
                  </button>
                  <button type="button" onclick="selectGuardianAge('50대')" 
                    class="guardian-age-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    50대
                  </button>
                  <button type="button" onclick="selectGuardianAge('60대 이상')" 
                    class="guardian-age-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    60대+
                  </button>
                </div>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">2. 배우자 나이를 선택하세요</label>
                <div class="grid grid-cols-4 gap-2">
                  <button type="button" onclick="selectSpouseAge('30대')" 
                    class="spouse-age-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    30대
                  </button>
                  <button type="button" onclick="selectSpouseAge('40대')" 
                    class="spouse-age-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    40대
                  </button>
                  <button type="button" onclick="selectSpouseAge('50대')" 
                    class="spouse-age-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    50대
                  </button>
                  <button type="button" onclick="selectSpouseAge('60대 이상')" 
                    class="spouse-age-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    60대+
                  </button>
                </div>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">3. 연락처 (선택)</label>
                <input type="tel" id="guardianPhone" placeholder="010-0000-0000"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500" />
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">4. 주거형태</label>
                <div class="grid grid-cols-2 gap-2">
                  <button type="button" onclick="selectHousingType('자가')" 
                    class="housing-type-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    자가
                  </button>
                  <button type="button" onclick="selectHousingType('전세')" 
                    class="housing-type-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    전세
                  </button>
                  <button type="button" onclick="selectHousingType('월세')" 
                    class="housing-type-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    월세
                  </button>
                  <button type="button" onclick="selectHousingType('기타')" 
                    class="housing-type-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    기타
                  </button>
                </div>
              </div>
            </div>
          </div>

          {/* Step 6: 질환/선호사항 */}
          <div id="step6" class="step-content hidden">
            <h2 class="text-2xl font-bold text-gray-900 mb-2">질환/선호사항</h2>
            <p class="text-sm text-gray-600 mb-6">추가 정보를 입력해주세요</p>
            
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">1. 질병 (중복선택 가능)</label>
                <div class="grid grid-cols-2 gap-2">
                  <button type="button" onclick="toggleDisease('고혈압')" 
                    class="disease-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    고혈압
                  </button>
                  <button type="button" onclick="toggleDisease('당뇨')" 
                    class="disease-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    당뇨
                  </button>
                  <button type="button" onclick="toggleDisease('심혈관질환')" 
                    class="disease-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    심혈관질환
                  </button>
                  <button type="button" onclick="toggleDisease('호흡기질환')" 
                    class="disease-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    호흡기질환
                  </button>
                </div>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">2. 성향 (중복선택 가능)</label>
                <div class="grid grid-cols-2 gap-2">
                  <button type="button" onclick="togglePersonality('온순함')" 
                    class="personality-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    온순함
                  </button>
                  <button type="button" onclick="togglePersonality('급함')" 
                    class="personality-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    급함
                  </button>
                  <button type="button" onclick="togglePersonality('활발함')" 
                    class="personality-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    활발함
                  </button>
                  <button type="button" onclick="togglePersonality('조용함')" 
                    class="personality-btn px-3 py-2 border-2 border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 text-sm">
                    조용함
                  </button>
                </div>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">3. 특이사항 (자유롭게 작성)</label>
                <textarea id="specialNotes" rows="4" placeholder="시설에 전달하고 싶은 특이사항을 입력해주세요"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500"></textarea>
              </div>
            </div>
          </div>

          {/* Step 7: 최종 확인 */}
          <div id="step7" class="step-content hidden">
            <h2 class="text-2xl font-bold text-gray-900 mb-4">견적 신청 완료</h2>
            <p class="text-sm text-gray-600 mb-6">입력하신 정보를 확인해주세요</p>
            
            <div class="space-y-4 mb-8">
              <div class="bg-gray-50 rounded-lg p-4">
                <h3 class="font-bold text-gray-900 mb-2">기본 정보</h3>
                <div class="text-sm text-gray-700 space-y-1">
                  <p><strong>시설 유형:</strong> <span id="summary-facility-type"></span></p>
                  <p><strong>신청자:</strong> <span id="summary-patient-name"></span></p>
                  <p><strong>지역:</strong> <span id="summary-region"></span></p>
                </div>
              </div>
              
              <div class="bg-gray-50 rounded-lg p-4">
                <h3 class="font-bold text-gray-900 mb-2">환자 정보</h3>
                <div class="text-sm text-gray-700 space-y-1" id="summary-patient-info">
                </div>
              </div>
              
              <div class="bg-gray-50 rounded-lg p-4">
                <h3 class="font-bold text-gray-900 mb-2">보호자 정보</h3>
                <div class="text-sm text-gray-700 space-y-1" id="summary-guardian-info">
                </div>
              </div>
            </div>
            
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
              <p class="text-sm text-blue-800">
                <i class="fas fa-info-circle mr-2"></i>
                <strong>신청 완료 후</strong> 선택하신 지역의 시설들이 견적서를 작성하여 회신합니다. 
                마이페이지에서 받은 견적서를 확인하실 수 있습니다.
              </p>
            </div>
          </div>

          {/* 네비게이션 버튼 */}
          <div class="flex justify-between mt-8 pt-6 border-t">
            <button type="button" id="prevBtn" onclick="prevStep()" 
              class="px-6 py-3 border-2 border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors hidden">
              <i class="fas fa-chevron-left mr-2"></i>이전
            </button>
            <button type="button" id="nextBtn" onclick="nextStep()" 
              class="ml-auto px-8 py-3 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed"
              disabled>
              다음<i class="fas fa-chevron-right ml-2"></i>
            </button>
            <button type="button" id="submitBtn" onclick="submitQuote()" 
              class="ml-auto px-8 py-3 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors hidden">
              견적 신청하기<i class="fas fa-paper-plane ml-2"></i>
            </button>
          </div>
        </div>
      </div>

      {/* JavaScript */}
      <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
      <script dangerouslySetInnerHTML={{__html: `
        let currentStep = 1;
        const totalSteps = 7;
        const quoteData = {
          facilityType: '',
          patientName: '',
          age: '',
          gender: '',
          sido: '',
          sigungu: '',
          
          // 요양병원 전용
          birthYear: '',
          birthMonth: '',
          birthDay: '',
          patientGender: '',
          careLevel: '',
          beneficiaryType: '',
          diagnosis: [],
          adl: '',
          dementia: '',
          
          // 재가복지 전용
          serviceType: '',
          homecareLevel: '',
          weeklyHours: '',
          
          // 보호자 정보
          guardianAge: '',
          spouseAge: '',
          guardianPhone: '',
          housingType: '',
          
          // 추가 정보
          diseases: [],
          personalities: [],
          specialNotes: ''
        };

        const sigunguData = {
          '서울특별시': ['강남구', '강동구', '강북구', '강서구', '관악구', '광진구', '구로구', '금천구', '노원구', '도봉구', '동대문구', '동작구', '마포구', '서대문구', '서초구', '성동구', '성북구', '송파구', '양천구', '영등포구', '용산구', '은평구', '종로구', '중구', '중랑구'],
          '경기도': ['가평군', '고양시', '과천시', '광명시', '광주시', '구리시', '군포시', '김포시', '남양주시', '동두천시', '부천시', '성남시', '수원시', '시흥시', '안산시', '안성시', '안양시', '양주시', '양평군', '여주시', '연천군', '오산시', '용인시', '의왕시', '의정부시', '이천시', '파주시', '평택시', '포천시', '하남시', '화성시']
        };

        function updateQuoteNewSigungu() {
          const sidoSelect = document.getElementById('quoteNewSido');
          const sigunguSelect = document.getElementById('quoteNewSigungu');
          const selectedSido = sidoSelect.value;

          sigunguSelect.innerHTML = '<option value="">선택하세요</option>';

          if (selectedSido && sigunguData[selectedSido]) {
            sigunguData[selectedSido].forEach(sigungu => {
              const option = document.createElement('option');
              option.value = sigungu;
              option.textContent = sigungu;
              sigunguSelect.appendChild(option);
            });
          }
        }

        function selectFacilityType(type) {
          quoteData.facilityType = type;
          document.querySelectorAll('.facility-radio').forEach(el => {
            el.classList.remove('bg-teal-600', 'border-teal-600');
            el.classList.add('border-gray-400');
          });
          const selected = document.querySelector(\`[data-type="\${type}"]\`);
          selected.classList.remove('border-gray-400');
          selected.classList.add('bg-teal-600', 'border-teal-600');
          
          document.getElementById('nextBtn').disabled = false;
        }

        function selectAge(age) {
          quoteData.age = age;
          document.querySelectorAll('.age-btn').forEach(btn => {
            btn.classList.remove('border-teal-500', 'bg-teal-50', 'text-teal-700', 'font-bold');
          });
          event.target.classList.add('border-teal-500', 'bg-teal-50', 'text-teal-700', 'font-bold');
          checkStep2Valid();
        }

        function selectGender(gender) {
          quoteData.gender = gender;
          document.querySelectorAll('.gender-btn').forEach(btn => {
            btn.classList.remove('border-teal-500', 'bg-teal-50', 'text-teal-700', 'font-bold');
          });
          event.target.classList.add('border-teal-500', 'bg-teal-50', 'text-teal-700', 'font-bold');
          checkStep2Valid();
        }

        function checkStep2Valid() {
          const name = document.getElementById('patientName').value;
          const age = quoteData.age;
          const gender = quoteData.gender;
          
          document.getElementById('nextBtn').disabled = !(name && age && gender);
        }

        document.getElementById('patientName').addEventListener('input', checkStep2Valid);

        function selectPatientGender(gender) {
          quoteData.patientGender = gender;
          document.querySelectorAll('.patient-gender-btn').forEach(btn => {
            btn.classList.remove('border-teal-500', 'bg-teal-50', 'text-teal-700', 'font-bold');
          });
          event.target.classList.add('border-teal-500', 'bg-teal-50', 'text-teal-700', 'font-bold');
        }

        function selectCareLevel(level) {
          quoteData.careLevel = level;
          document.querySelectorAll('.care-level-btn').forEach(btn => {
            btn.classList.remove('border-teal-500', 'bg-teal-50', 'text-teal-700', 'font-bold');
          });
          event.target.classList.add('border-teal-500', 'bg-teal-50', 'text-teal-700', 'font-bold');
        }

        function selectBeneficiaryType(type) {
          quoteData.beneficiaryType = type;
          document.querySelectorAll('.beneficiary-type-btn').forEach(btn => {
            btn.classList.remove('border-teal-500', 'bg-teal-50', 'text-teal-700', 'font-bold');
          });
          event.target.classList.add('border-teal-500', 'bg-teal-50', 'text-teal-700', 'font-bold');
        }

        function toggleDiagnosis(diagnosis) {
          const btn = event.target;
          const index = quoteData.diagnosis.indexOf(diagnosis);
          
          if (index > -1) {
            quoteData.diagnosis.splice(index, 1);
            btn.classList.remove('border-teal-500', 'bg-teal-50', 'text-teal-700', 'font-bold');
          } else {
            quoteData.diagnosis.push(diagnosis);
            btn.classList.add('border-teal-500', 'bg-teal-50', 'text-teal-700', 'font-bold');
          }
        }

        function selectADL(level) {
          quoteData.adl = level;
          document.querySelectorAll('.adl-btn').forEach(btn => {
            btn.classList.remove('border-teal-500', 'bg-teal-50', 'text-teal-700', 'font-bold');
          });
          event.target.classList.add('border-teal-500', 'bg-teal-50', 'text-teal-700', 'font-bold');
        }

        function selectDementia(level) {
          quoteData.dementia = level;
          document.querySelectorAll('.dementia-btn').forEach(btn => {
            btn.classList.remove('border-teal-500', 'bg-teal-50', 'text-teal-700', 'font-bold');
          });
          event.target.classList.add('border-teal-500', 'bg-teal-50', 'text-teal-700', 'font-bold');
        }

        function selectServiceType(type) {
          quoteData.serviceType = type;
          document.querySelectorAll('.service-type-btn').forEach(btn => {
            btn.classList.remove('border-teal-500', 'bg-teal-50', 'text-teal-700', 'font-bold');
          });
          event.target.classList.add('border-teal-500', 'bg-teal-50', 'text-teal-700', 'font-bold');
        }

        function selectHomeCareLevel(level) {
          quoteData.homecareLevel = level;
          document.querySelectorAll('.homecare-level-btn').forEach(btn => {
            btn.classList.remove('border-teal-500', 'bg-teal-50', 'text-teal-700', 'font-bold');
          });
          event.target.classList.add('border-teal-500', 'bg-teal-50', 'text-teal-700', 'font-bold');
        }

        function selectGuardianAge(age) {
          quoteData.guardianAge = age;
          document.querySelectorAll('.guardian-age-btn').forEach(btn => {
            btn.classList.remove('border-teal-500', 'bg-teal-50', 'text-teal-700', 'font-bold');
          });
          event.target.classList.add('border-teal-500', 'bg-teal-50', 'text-teal-700', 'font-bold');
        }

        function selectSpouseAge(age) {
          quoteData.spouseAge = age;
          document.querySelectorAll('.spouse-age-btn').forEach(btn => {
            btn.classList.remove('border-teal-500', 'bg-teal-50', 'text-teal-700', 'font-bold');
          });
          event.target.classList.add('border-teal-500', 'bg-teal-50', 'text-teal-700', 'font-bold');
        }

        function selectHousingType(type) {
          quoteData.housingType = type;
          document.querySelectorAll('.housing-type-btn').forEach(btn => {
            btn.classList.remove('border-teal-500', 'bg-teal-50', 'text-teal-700', 'font-bold');
          });
          event.target.classList.add('border-teal-500', 'bg-teal-50', 'text-teal-700', 'font-bold');
        }

        function toggleDisease(disease) {
          const btn = event.target;
          const index = quoteData.diseases.indexOf(disease);
          
          if (index > -1) {
            quoteData.diseases.splice(index, 1);
            btn.classList.remove('border-teal-500', 'bg-teal-50', 'text-teal-700', 'font-bold');
          } else {
            quoteData.diseases.push(disease);
            btn.classList.add('border-teal-500', 'bg-teal-50', 'text-teal-700', 'font-bold');
          }
        }

        function togglePersonality(personality) {
          const btn = event.target;
          const index = quoteData.personalities.indexOf(personality);
          
          if (index > -1) {
            quoteData.personalities.splice(index, 1);
            btn.classList.remove('border-teal-500', 'bg-teal-50', 'text-teal-700', 'font-bold');
          } else {
            quoteData.personalities.push(personality);
            btn.classList.add('border-teal-500', 'bg-teal-50', 'text-teal-700', 'font-bold');
          }
        }

        function updateStepUI() {
          // Hide all steps
          document.querySelectorAll('.step-content').forEach(el => el.classList.add('hidden'));
          
          // Show current step
          if (currentStep === 4) {
            if (quoteData.facilityType === 'nursing_hospital') {
              document.getElementById('step4-hospital').classList.remove('hidden');
            } else {
              document.getElementById('step4-homecare').classList.remove('hidden');
            }
          } else {
            const currentStepEl = document.getElementById(\`step\${currentStep}\`);
            if (currentStepEl) currentStepEl.classList.remove('hidden');
          }

          // Update progress bar
          const progress = (currentStep / totalSteps) * 100;
          document.getElementById('progressBar').style.width = progress + '%';
          document.getElementById('stepIndicator').textContent = \`\${currentStep}/\${totalSteps} 단계\`;

          // Update step title
          const titles = [
            '견적서 전체 선택',
            '신청 정보 입력',
            '지역 선택',
            quoteData.facilityType === 'nursing_hospital' ? '환자 정보 입력' : '서비스 정보 입력',
            '본인/배우자 정보',
            '질환/선호사항',
            '최종 확인'
          ];
          document.getElementById('stepTitle').textContent = titles[currentStep - 1];

          // Update buttons
          document.getElementById('prevBtn').classList.toggle('hidden', currentStep === 1);
          document.getElementById('nextBtn').classList.toggle('hidden', currentStep === totalSteps);
          document.getElementById('submitBtn').classList.toggle('hidden', currentStep !== totalSteps);
        }

        function nextStep() {
          if (currentStep < totalSteps) {
            // Collect data from current step
            if (currentStep === 2) {
              quoteData.patientName = document.getElementById('patientName').value;
            } else if (currentStep === 3) {
              quoteData.sido = document.getElementById('quoteNewSido').value;
              quoteData.sigungu = document.getElementById('quoteNewSigungu').value;
              if (!quoteData.sido || !quoteData.sigungu) {
                alert('지역을 선택해주세요');
                return;
              }
            } else if (currentStep === 4 && quoteData.facilityType === 'nursing_hospital') {
              quoteData.birthYear = document.getElementById('birthYear').value;
              quoteData.birthMonth = document.getElementById('birthMonth').value;
              quoteData.birthDay = document.getElementById('birthDay').value;
            } else if (currentStep === 5) {
              quoteData.guardianPhone = document.getElementById('guardianPhone').value;
            } else if (currentStep === 6) {
              quoteData.specialNotes = document.getElementById('specialNotes').value;
            }

            currentStep++;
            updateStepUI();
            
            if (currentStep === totalSteps) {
              showSummary();
            }
            
            // Reset next button state
            document.getElementById('nextBtn').disabled = false;
          }
        }

        function prevStep() {
          if (currentStep > 1) {
            currentStep--;
            updateStepUI();
          }
        }

        function showSummary() {
          document.getElementById('summary-facility-type').textContent = 
            quoteData.facilityType === 'nursing_hospital' ? '요양병원' : '재가복지';
          document.getElementById('summary-patient-name').textContent = quoteData.patientName;
          document.getElementById('summary-region').textContent = \`\${quoteData.sido} \${quoteData.sigungu}\`;

          let patientInfo = '';
          if (quoteData.facilityType === 'nursing_hospital') {
            patientInfo = \`
              <p><strong>생년월일:</strong> \${quoteData.birthYear}년 \${quoteData.birthMonth}월 \${quoteData.birthDay}일</p>
              <p><strong>성별:</strong> \${quoteData.patientGender}</p>
              <p><strong>장기요양등급:</strong> \${quoteData.careLevel || '선택안함'}</p>
              <p><strong>수급자 유형:</strong> \${quoteData.beneficiaryType}</p>
              <p><strong>진단명:</strong> \${quoteData.diagnosis.join(', ') || '없음'}</p>
              <p><strong>ADL:</strong> \${quoteData.adl || '선택안함'}</p>
              <p><strong>치매:</strong> \${quoteData.dementia || '선택안함'}</p>
            \`;
          } else {
            patientInfo = \`
              <p><strong>서비스 유형:</strong> \${quoteData.serviceType}</p>
              <p><strong>장기요양등급:</strong> \${quoteData.homecareLevel}</p>
              <p><strong>주간 이용 시간:</strong> \${quoteData.weeklyHours || '선택안함'}</p>
            \`;
          }
          document.getElementById('summary-patient-info').innerHTML = patientInfo;

          document.getElementById('summary-guardian-info').innerHTML = \`
            <p><strong>본인 나이:</strong> \${quoteData.guardianAge || '선택안함'}</p>
            <p><strong>배우자 나이:</strong> \${quoteData.spouseAge || '선택안함'}</p>
            <p><strong>연락처:</strong> \${quoteData.guardianPhone || '미입력'}</p>
            <p><strong>주거형태:</strong> \${quoteData.housingType || '선택안함'}</p>
          \`;
        }

        async function submitQuote() {
          try {
            const response = await axios.post('/api/quote/submit-new', quoteData);
            
            if (response.data.success) {
              alert('견적 신청이 완료되었습니다! 시설들의 견적서를 기다려주세요.');
              window.location.href = '/';
            } else {
              alert('견적 신청 중 오류가 발생했습니다: ' + response.data.message);
            }
          } catch (error) {
            console.error('Submit error:', error);
            alert('견적 신청 중 오류가 발생했습니다. 다시 시도해주세요.');
          }
        }

        // Initialize
        updateStepUI();
      `}}></script>
    </div>
  )
})

export default app
