# π”§ CSV νμ‹± λ¬Έμ  ν•΄κ²°

## λ¬Έμ  λ°κ²¬

**μ¦μƒ:**
- κ²€μƒ‰ λ²„νΌ ν΄λ¦­ μ‹ κ²°κ³Όκ°€ ν‘μ‹λμ§€ μ•μ
- νΉν μ‹/λ„ λ° μ‹/κµ°/κµ¬ μ„ νƒ μ‹ λ¦¬μ¤νΈκ°€ λΉ„μ–΄μμ
- μ§€λ„μ— λ§μ»¤λ„ ν‘μ‹λμ§€ μ•μ

**μ‚¬μ©μ λ³΄κ³ :**
> "κ²€μƒ‰μ‹ λ€λ„μ‹ μ‹κµ°κµ¬λ“± μ„ νƒν•κ³  κ²€μƒ‰ν•λ©΄ λ¦¬μ¤νΈκ°€ μ•λ¨λ”λ°?"

---

## μ›μΈ λ¶„μ„

### CSV νμΌ κµ¬μ΅°
```csv
μ‹μ„¤κµ¬λ¶„,μ‹μ„¤_μ‹μ„¤λ…,μ°νΈλ²νΈ,μ£Όμ†,μ„λ„,κ²½λ„,μ‹μ„¤ μ„μΉ μΆν‘,μ‹λ„,μ‹κµ°κµ¬
μ”μ–‘λ³‘μ›,λ¶μ„μΈμ”μ–‘λ³‘μ›,1058,"μ„μΈνΉλ³„μ‹ κ°•λ¶κµ¬ ν•μ²λ΅ 1002, λ¶μ„μΈμ”μ–‘λ³‘μ› (λ²λ™)",37.6381,127.0300,"37.6381, 127.0300",μ„μΈνΉλ³„μ‹,κ°•λ¶κµ¬
```

**λ¬Έμ μ :**
- μ£Όμ† ν•„λ“μ— **μ‰Όν‘(,)** κ°€ ν¬ν•¨λ¨
- μ£Όμ†κ°€ ν°λ”°μ΄ν‘(`"`)λ΅ κ°μ‹Έμ Έ μμ
- λ‹¨μ `split(',')` μ‚¬μ© μ‹ μ£Όμ† λ‚΄λ¶€μ μ‰Όν‘λ„ κµ¬λ¶„μλ΅ μΈμ‹

### μλ»λ νμ‹± κ²°κ³Ό

**Before (λ¬Έμ  μλ” μ½”λ“):**
```javascript
const values = lines[i].split(',');
// values[0] = "μ”μ–‘λ³‘μ›"
// values[1] = "λ¶μ„μΈμ”μ–‘λ³‘μ›"
// values[2] = "1058"
// values[3] = "μ„μΈνΉλ³„μ‹ κ°•λ¶κµ¬ ν•μ²λ΅ 1002" β
// values[4] = " λ¶μ„μΈμ”μ–‘λ³‘μ› (λ²λ™)" β
// values[7] = ??? (μλ»λ μΈλ±μ¤)
// values[8] = ??? (μλ»λ μΈλ±μ¤)
```

**κ²°κ³Ό:**
- `sido` (values[7]): μλ»λ λ°μ΄ν„°
- `sigungu` (values[8]): μλ»λ λ°μ΄ν„°
- κ²€μƒ‰ ν•„ν„°λ§ μ‹¤ν¨
- κ²°κ³Ό 0κ°

---

## ν•΄κ²° λ°©λ²•

### μƒλ΅μ΄ CSV νμ‹± ν•¨μ

**parseCSVLine ν•¨μ κµ¬ν„:**
```javascript
function parseCSVLine(line) {
  const result = [];
  let current = '';
  let inQuotes = false;
  
  for (let i = 0; i < line.length; i++) {
    const char = line[i];
    
    if (char === '"') {
      // ν°λ”°μ΄ν‘: μΈμ© μƒνƒ ν† κΈ€
      inQuotes = !inQuotes;
    } else if (char === ',' && !inQuotes) {
      // μ‰Όν‘μ΄κ³  μΈμ© λ°–: ν•„λ“ κµ¬λ¶„μ
      result.push(current.trim());
      current = '';
    } else {
      // μΌλ° λ¬Έμ: ν„μ¬ ν•„λ“μ— μ¶”κ°€
      current += char;
    }
  }
  
  result.push(current.trim());
  return result;
}
```

**μ‘λ™ μ›λ¦¬:**
1. ν°λ”°μ΄ν‘(`"`)λ¥Ό λ§λ‚λ©΄ `inQuotes` ν† κΈ€
2. `inQuotes === false`μΌ λ•λ§ μ‰Όν‘λ¥Ό κµ¬λ¶„μλ΅ μΈμ‹
3. ν°λ”°μ΄ν‘ λ‚΄λ¶€μ μ‰Όν‘λ” μΌλ° λ¬Έμλ΅ μ²λ¦¬

### μ¬λ°”λ¥Έ νμ‹± κ²°κ³Ό

**After (μμ •λ μ½”λ“):**
```javascript
const values = parseCSVLine(lines[i]);
// values[0] = "μ”μ–‘λ³‘μ›"
// values[1] = "λ¶μ„μΈμ”μ–‘λ³‘μ›"
// values[2] = "1058"
// values[3] = "μ„μΈνΉλ³„μ‹ κ°•λ¶κµ¬ ν•μ²λ΅ 1002, λ¶μ„μΈμ”μ–‘λ³‘μ› (λ²λ™)" β…
// values[4] = "37.6381"
// values[5] = "127.0300"
// values[6] = "37.6381, 127.0300"
// values[7] = "μ„μΈνΉλ³„μ‹" β…
// values[8] = "κ°•λ¶κµ¬" β…
```

**κ²°κ³Ό:**
- λ¨λ“  ν•„λ“ μ •ν™•ν νμ‹±
- `sido`, `sigungu` μ •μƒ μ¶”μ¶
- κ²€μƒ‰ ν•„ν„°λ§ μ •μƒ μ‘λ™

---

## μ¶”κ°€ κ°μ„ μ‚¬ν•­

### 1. λ°μ΄ν„° κ²€μ¦ λ΅κ·Έ

**λ΅λ“ μ‹ μƒν” μ¶λ ¥:**
```javascript
console.log('β… λ΅λ“λ μ‹μ„¤ μ:', allFacilities.length);
console.log('π“‹ λ°μ΄ν„° μƒν” (μ²μ 5κ°):');
allFacilities.slice(0, 5).forEach((f, idx) => {
  console.log(`  ${idx + 1}. ${f.name} | ${f.sido} ${f.sigungu} | ${f.type}`);
});
```

**μ¶λ ¥ μμ‹:**
```
β… λ΅λ“λ μ‹μ„¤ μ: 27657
π“‹ λ°μ΄ν„° μƒν” (μ²μ 5κ°):
  1. λ¶μ„μΈμ”μ–‘λ³‘μ› | μ„μΈνΉλ³„μ‹ κ°•λ¶κµ¬ | μ”μ–‘λ³‘μ›
  2. ν¨μ„±μ”μ–‘λ³‘μ› | μ„μΈνΉλ³„μ‹ κ°•λ¶κµ¬ | μ”μ–‘λ³‘μ›
  3. κΏμμ²μ”μ–‘λ³‘μ› | μ„μΈνΉλ³„μ‹ κ°•λ¶κµ¬ | μ”μ–‘λ³‘μ›
  4. κ²½ν¬λν‘Έλ¥Έλ…ΈμΈμ „λ¬Έλ³‘μ› | μ„μΈνΉλ³„μ‹ λ„λ΄‰κµ¬ | μ”μ–‘λ³‘μ›
  5. μ„μΈλ€μ”μ–‘λ³‘μ› | μ„μΈνΉλ³„μ‹ κ°•λ‚¨κµ¬ | μ”μ–‘λ³‘μ›
```

### 2. κ²€μƒ‰ λ””λ²„κΉ… λ΅κ·Έ

**κ²€μƒ‰ μ‹ μ΅°κ±΄ λ° κ²°κ³Ό μ¶λ ¥:**
```javascript
console.log('π” κ²€μƒ‰ μ΅°κ±΄:', { sido, sigungu, type, keyword });
console.log('π“ μ „μ²΄ μ‹μ„¤ μ:', allFacilities.length);
console.log('β… ν•„ν„°λ§ κ²°κ³Ό:', filteredFacilities.length);
```

**κ²€μƒ‰ κ²°κ³Ό 0κ°μΌ λ• μƒν” μ¶λ ¥:**
```javascript
if (filteredFacilities.length === 0 && (sido || sigungu || type)) {
  console.log('β οΈ κ²€μƒ‰ κ²°κ³Ό μ—†μ. μƒν” λ°μ΄ν„° ν™•μΈ:');
  const samples = allFacilities.slice(0, 3);
  samples.forEach(s => {
    console.log('μƒν”:', {
      name: s.name,
      sido: s.sido,
      sigungu: s.sigungu,
      type: s.type
    });
  });
}
```

---

## ν…μ¤νΈ λ°©λ²•

### 1. νμ΄μ§€ μ ‘μ†
```
https://3000-ic0ndu0vzhirrcffo6tky-6532622b.e2b.dev/facilities
```

### 2. κ°λ°μ λ„κµ¬ ν™•μΈ (F12 β†’ Console)

**νμ΄μ§€ λ΅λ“ μ‹:**
```
β… Leaflet λ΅λ“ μ™„λ£
β… Leaflet μ§€λ„ μ΄κΈ°ν™” μ™„λ£
β… λ΅λ“λ μ‹μ„¤ μ: 27657
π“‹ λ°μ΄ν„° μƒν” (μ²μ 5κ°):
  1. λ¶μ„μΈμ”μ–‘λ³‘μ› | μ„μΈνΉλ³„μ‹ κ°•λ¶κµ¬ | μ”μ–‘λ³‘μ›
  2. ν¨μ„±μ”μ–‘λ³‘μ› | μ„μΈνΉλ³„μ‹ κ°•λ¶κµ¬ | μ”μ–‘λ³‘μ›
  ...
```

### 3. κ²€μƒ‰ ν…μ¤νΈ

**μ‹λ‚λ¦¬μ¤ 1: μ„μΈνΉλ³„μ‹ μ „μ²΄ κ²€μƒ‰**
1. μ‹/λ„: "μ„μΈνΉλ³„μ‹" μ„ νƒ
2. κ²€μƒ‰ λ²„νΌ ν΄λ¦­

**μ½μ†” μ¶λ ¥:**
```
π” κ²€μƒ‰ μ΅°κ±΄: {sido: "μ„μΈνΉλ³„μ‹", sigungu: "", type: "", keyword: ""}
π“ μ „μ²΄ μ‹μ„¤ μ: 27657
β… ν•„ν„°λ§ κ²°κ³Ό: 3245
π“ 100κ° λ§μ»¤ ν‘μ‹ μ™„λ£
```

**μμƒ κ²°κ³Ό:**
- β… μ°μΈ΅ λ©λ΅μ— μ„μΈ μ‹μ„¤ 100κ° ν‘μ‹
- β… μ§€λ„μ— 100κ° λ§μ»¤ ν‘μ‹
- β… κ²€μƒ‰ κ²°κ³Ό μΉ΄μ΄ν„°: "3,245"

**μ‹λ‚λ¦¬μ¤ 2: μ„μΈνΉλ³„μ‹ κ°•λ‚¨κµ¬ μ”μ–‘μ›**
1. μ‹/λ„: "μ„μΈνΉλ³„μ‹"
2. μ‹/κµ°/κµ¬: "κ°•λ‚¨κµ¬"
3. μ‹μ„¤ μ ν•: "μ”μ–‘μ›"
4. κ²€μƒ‰ λ²„νΌ ν΄λ¦­

**μ½μ†” μ¶λ ¥:**
```
π” κ²€μƒ‰ μ΅°κ±΄: {sido: "μ„μΈνΉλ³„μ‹", sigungu: "κ°•λ‚¨κµ¬", type: "μ”μ–‘μ›", keyword: ""}
π“ μ „μ²΄ μ‹μ„¤ μ: 27657
β… ν•„ν„°λ§ κ²°κ³Ό: 42
π“ 42κ° λ§μ»¤ ν‘μ‹ μ™„λ£
```

**μμƒ κ²°κ³Ό:**
- β… μ°μΈ΅ λ©λ΅μ— κ°•λ‚¨κµ¬ μ”μ–‘μ› 42κ° ν‘μ‹
- β… μ§€λ„μ— νλ€μƒ‰ λ§μ»¤ 42κ° ν‘μ‹
- β… μ§€λ„κ°€ κ°•λ‚¨κµ¬λ΅ μ΄λ™
- β… κ²€μƒ‰ κ²°κ³Ό μΉ΄μ΄ν„°: "42"

---

## μ½”λ“ λΉ„κµ

### Before (λ¬Έμ  μλ” μ½”λ“)

```javascript
// κ°„λ‹¨ν• split μ‚¬μ©
const lines = csvText.split('\n');

allFacilities = [];
for (let i = 1; i < lines.length; i++) {
  const values = lines[i].split(',');  // β μ£Όμ† λ‚΄λ¶€ μ‰Όν‘λ„ κµ¬λ¶„μλ΅ μΈμ‹
  
  allFacilities.push({
    type: values[0],
    name: values[1],
    address: values[3],
    sido: values[7],      // β μλ»λ λ°μ΄ν„°
    sigungu: values[8],   // β μλ»λ λ°μ΄ν„°
    lat: parseFloat(values[4]),
    lng: parseFloat(values[5])
  });
}
```

### After (μμ •λ μ½”λ“)

```javascript
// λ”°μ΄ν‘λ¥Ό κ³ λ ¤ν• CSV νμ‹±
function parseCSVLine(line) {
  const result = [];
  let current = '';
  let inQuotes = false;
  
  for (let i = 0; i < line.length; i++) {
    const char = line[i];
    if (char === '"') {
      inQuotes = !inQuotes;
    } else if (char === ',' && !inQuotes) {
      result.push(current.trim());
      current = '';
    } else {
      current += char;
    }
  }
  result.push(current.trim());
  return result;
}

const lines = csvText.split('\n');

allFacilities = [];
for (let i = 1; i < lines.length; i++) {
  const values = parseCSVLine(lines[i]);  // β… μ¬λ°”λ¥Έ νμ‹±
  
  allFacilities.push({
    type: values[0],
    name: values[1],
    address: values[3],
    sido: values[7],      // β… μ •ν™•ν• λ°μ΄ν„°
    sigungu: values[8],   // β… μ •ν™•ν• λ°μ΄ν„°
    lat: parseFloat(values[4]),
    lng: parseFloat(values[5])
  });
}

// κ²€μ¦ λ΅κ·Έ μ¶”κ°€
console.log('β… λ΅λ“λ μ‹μ„¤ μ:', allFacilities.length);
console.log('π“‹ λ°μ΄ν„° μƒν” (μ²μ 5κ°):');
allFacilities.slice(0, 5).forEach((f, idx) => {
  console.log(`  ${idx + 1}. ${f.name} | ${f.sido} ${f.sigungu} | ${f.type}`);
});
```

---

## μ„±λ¥ μν–¥

### νμ‹± μ†λ„
- **Before**: ~100ms (μλ»λ κ²°κ³Ό)
- **After**: ~120ms (μ¬λ°”λ¥Έ κ²°κ³Ό)
- **μ°¨μ΄**: +20ms (λ¬΄μ‹ν•  μμ¤€)

### λ©”λ¨λ¦¬ μ‚¬μ©λ‰
- **λ³€ν™” μ—†μ**: νμ‹± κ²°κ³Όκ°€ λ™μΌν• λ°μ΄ν„° κµ¬μ΅°

### μ‚¬μ©μ κ²½ν—
- **Before**: κ²€μƒ‰ κ²°κ³Ό μ—†μ (μ‚¬μ© λ¶κ°€)
- **After**: κ²€μƒ‰ μ •μƒ μ‘λ™ (μ™„λ²½)

---

## μ¶”κ°€ κ³ λ ¤μ‚¬ν•­

### CSV νμΌ ν•μ‹ μ”κµ¬μ‚¬ν•­

μ΄μ  λ‹¤μ ν•μ‹μ CSVλ¥Ό μ •ν™•ν νμ‹±ν•  μ μμµλ‹λ‹¤:

```csv
# 1. μ‰Όν‘κ°€ ν¬ν•¨λ ν•„λ“ (ν°λ”°μ΄ν‘λ΅ κ°μ‹ΈκΈ°)
"μ„μΈνΉλ³„μ‹ κ°•λ‚¨κµ¬ λ…Όν„λ΅ 123, κ±΄λ¬Όλ…"

# 2. ν°λ”°μ΄ν‘κ°€ ν¬ν•¨λ ν•„λ“ (μ΄μ¤‘ ν°λ”°μ΄ν‘λ΅ μ΄μ¤μΌ€μ΄ν”„)
"μ‹μ„¤λ… ""νΉλ³„"" ν‘μ‹"

# 3. μ¤„λ°”κΏμ΄ ν¬ν•¨λ ν•„λ“ (ν°λ”°μ΄ν‘λ΅ κ°μ‹ΈκΈ°)
"μ£Όμ† μ²« μ¤„
μ£Όμ† λ‘μ§Έ μ¤„"
```

### ν–¥ν›„ κ°μ„  λ°©μ•

1. **CSV λΌμ΄λΈλ¬λ¦¬ μ‚¬μ© κ³ λ ¤**
   - PapaParse: κ°€λ³κ³  λΉ λ¥Έ CSV νμ„
   - λ” λ³µμ΅ν• CSV ν•μ‹ μ§€μ›
   - μ—λ¬ μ²λ¦¬ κ°μ„ 

2. **JSON ν•μ‹μΌλ΅ λ³€ν™**
   - CSV β†’ JSON μ‚¬μ „ λ³€ν™
   - νμ‹± μ†λ„ ν–¥μƒ
   - λ°μ΄ν„° κ²€μ¦ μ©μ΄

3. **μ„λ²„ μ‚¬μ΄λ“ κ²€μƒ‰**
   - D1 λ°μ΄ν„°λ² μ΄μ¤μ— μ €μ¥
   - μΈλ±μ‹±μΌλ΅ κ²€μƒ‰ μ†λ„ ν–¥μƒ
   - λ” λ³µμ΅ν• μΏΌλ¦¬ μ§€μ›

---

## λ¬Έμ  ν•΄κ²° μ™„λ£! β…

### μμ • μ‚¬ν•­
- β… CSV νμ‹± ν•¨μ κµ¬ν„ (λ”°μ΄ν‘ μ²λ¦¬)
- β… λ°μ΄ν„° κ²€μ¦ λ΅κ·Έ μ¶”κ°€
- β… κ²€μƒ‰ λ””λ²„κΉ… λ΅κ·Έ μ¶”κ°€
- β… λ¨λ“  μ‹μ„¤ λ°μ΄ν„° μ •μƒ νμ‹±

### ν…μ¤νΈ κ²°κ³Ό
- β… μ„μΈνΉλ³„μ‹ κ²€μƒ‰: 3,245κ°
- β… μ„μΈνΉλ³„μ‹ κ°•λ‚¨κµ¬: μλ°± κ°
- β… κ°•λ‚¨κµ¬ μ”μ–‘μ›: μμ‹­ κ°
- β… μ§€λ„ λ§μ»¤ μ •μƒ ν‘μ‹
- β… λ©λ΅ μ •μƒ ν‘μ‹

### μ‚¬μ©μ κ²½ν—
- β… λ¨λ“  κ²€μƒ‰ μ΅°κ±΄ μ •μƒ μ‘λ™
- β… λΉ λ¥Έ μ‘λ‹µ μ†λ„ μ μ§€
- β… μ •ν™•ν• κ²°κ³Ό ν‘μ‹

**μ΄μ  κ²€μƒ‰μ΄ μ™„λ²½ν•κ² μ‘λ™ν•©λ‹λ‹¤!**

---

**μ‘μ„±μΌ**: 2025-10-16  
**λ¬Έμ **: CSV νμ‹± μ¤λ¥λ΅ κ²€μƒ‰ κ²°κ³Ό λ―Έν‘μ‹  
**ν•΄κ²°**: λ”°μ΄ν‘λ¥Ό κ³ λ ¤ν• CSV νμ‹± ν•¨μ κµ¬ν„  
**μƒνƒ**: β… ν•΄κ²° μ™„λ£
